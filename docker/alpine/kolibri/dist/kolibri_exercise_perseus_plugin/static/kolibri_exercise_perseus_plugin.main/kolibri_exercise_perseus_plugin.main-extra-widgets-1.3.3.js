(window.webpackJsonp__kolibri_exercise_perseus_pluginmain=window.webpackJsonp__kolibri_exercise_perseus_pluginmain||[]).push([[0],{639:function(module,exports,__webpack_require__){module.exports=[[__webpack_require__(652),!1],[__webpack_require__(653),!1],[__webpack_require__(654),!1],[__webpack_require__(655),!1],[__webpack_require__(656),!1],[__webpack_require__(657),!1],[__webpack_require__(644),!1],[__webpack_require__(662),!1],[__webpack_require__(663),!1],[__webpack_require__(664),!1],[__webpack_require__(665),!1],[__webpack_require__(666),!1],[__webpack_require__(667),!1],[__webpack_require__(669),!1],[__webpack_require__(670),!1],[__webpack_require__(671),!1],[__webpack_require__(672),!1],[__webpack_require__(648),!1],[__webpack_require__(676),!1],[__webpack_require__(677),!1],[__webpack_require__(678),!1],[__webpack_require__(274),!1],[__webpack_require__(686),!1],[__webpack_require__(687),!1],[__webpack_require__(688),!1],[__webpack_require__(689),!1],[__webpack_require__(690),!1],[__webpack_require__(691),!1],[__webpack_require__(692),!1],[__webpack_require__(693),!1],[__webpack_require__(694),!1],[__webpack_require__(696),!1],!1,!1,!1]},640:function(module,exports,__webpack_require__){__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMHighlightSet||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMHighlight||__webpack_require__(0).PropTypes.any;Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_Position",__webpack_require__(0).PropTypes.shape({left:__webpack_require__(0).PropTypes.number.isRequired,top:__webpack_require__(0).PropTypes.number.isRequired})),Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_ZIndexes",__webpack_require__(0).PropTypes.shape({aboveContent:__webpack_require__(0).PropTypes.number.isRequired,belowContent:__webpack_require__(0).PropTypes.number.isRequired}))},641:function(module,exports,__webpack_require__){Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_SerializedRange",__webpack_require__(0).PropTypes.shape({type:__webpack_require__(0).PropTypes.oneOf(["word-indexes"]).isRequired,firstWordIndex:__webpack_require__(0).PropTypes.number.isRequired,lastWordIndex:__webpack_require__(0).PropTypes.number.isRequired})),Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_DOMHighlight",__webpack_require__(0).PropTypes.shape({firstWordIndex:__webpack_require__(0).PropTypes.number.isRequired,lastWordIndex:__webpack_require__(0).PropTypes.number.isRequired,domRange:__webpack_require__(0).PropTypes.any.isRequired})),Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_DOMHighlightSet",__webpack_require__(0).PropTypes.shape({})),Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_SerializedHighlight",__webpack_require__(0).PropTypes.shape({range:__webpack_require__(0).PropTypes.shape({type:__webpack_require__(0).PropTypes.oneOf(["word-indexes"]).isRequired,firstWordIndex:__webpack_require__(0).PropTypes.number.isRequired,lastWordIndex:__webpack_require__(0).PropTypes.number.isRequired}).isRequired})),Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_SerializedHighlightSet",__webpack_require__(0).PropTypes.shape({}))},642:function(module,exports,__webpack_require__){(function($){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},classNames=__webpack_require__(22),React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),firstNumericalParse=__webpack_require__(19).firstNumericalParse,captureScratchpadTouchStart=__webpack_require__(19).captureScratchpadTouchStart,knumber=__webpack_require__(9).number,KhanMath=__webpack_require__(44),toNumericString=KhanMath.toNumericString,getNumericFormat=KhanMath.getNumericFormat,NumberInput=React.createClass({displayName:"NumberInput",propTypes:{value:React.PropTypes.number,format:React.PropTypes.string,placeholder:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),onChange:React.PropTypes.func.isRequired,onFormatChange:React.PropTypes.func,checkValidity:React.PropTypes.func,size:React.PropTypes.string,label:React.PropTypes.oneOf(["put your labels outside your inputs!"])},getDefaultProps:function(){return{value:null,placeholder:null,format:null,onFormatChange:function(){return null},checkValidity:function(){return!0},useArrowKeys:!1}},getInitialState:function(){return{format:this.props.format}},render:function(){var classes=classNames({"number-input":!0,"invalid-input":!this._checkValidity(this.props.value),mini:"mini"===this.props.size,small:"small"===this.props.size,normal:"normal"===this.props.size});return null!=this.props.className&&(classes=classes+" "+this.props.className),React.createElement("input",_extends({},this.props,{className:classes,type:"text",ref:"input",onChange:this._handleChange,onFocus:this._handleFocus,onBlur:this._handleBlur,onKeyPress:this._handleBlur,onKeyDown:this._onKeyDown,onTouchStart:captureScratchpadTouchStart,defaultValue:toNumericString(this.props.value,this.state.format),value:void 0}))},componentDidUpdate:function(prevProps){knumber.equal(this.getValue(),this.props.value)||this._setValue(this.props.value,this.state.format)},getValue:function(){return this.parseInputValue(ReactDOM.findDOMNode(this.refs.input).value)},getStringValue:function(){return ReactDOM.findDOMNode(this.refs.input).value.toString()},parseInputValue:function(value){if(""===value){var placeholder=this.props.placeholder;return _.isFinite(placeholder)?+placeholder:null}var result=firstNumericalParse(value);return _.isFinite(result)?result:this.props.value},focus:function(){ReactDOM.findDOMNode(this.refs.input).focus(),this._handleFocus()},blur:function(){ReactDOM.findDOMNode(this.refs.input).blur(),this._handleBlur()},setSelectionRange:function(selectionStart,selectionEnd){ReactDOM.findDOMNode(this).setSelectionRange(selectionStart,selectionEnd)},getSelectionStart:function(){return ReactDOM.findDOMNode(this).selectionStart},getSelectionEnd:function(){return ReactDOM.findDOMNode(this).selectionEnd},_checkValidity:function(value){if(null==value)return!0;var val=firstNumericalParse(value),checkValidity=this.props.checkValidity;return _.isFinite(val)&&checkValidity(val)},_handleChange:function(e){var text=e.target.value,value=this.parseInputValue(text),format=getNumericFormat(text);this.props.onChange(value),format&&(this.props.onFormatChange(value,format),this.setState({format:format}))},_handleFocus:function(){this.props.onFocus&&this.props.onFocus()},_handleBlur:function(e){e&&"keypress"===e.type&&13!==e.keyCode||(this._setValue(this.props.value,this.state.format),this.props.onBlur&&this.props.onBlur())},_onKeyDown:function(e){if(this.props.onKeyDown&&this.props.onKeyDown(e),this.props.useArrowKeys&&_.contains(["ArrowUp","ArrowDown"],e.key)){var val=this.getValue();val===Math.floor(val)&&("ArrowUp"===e.key?val+=1:"ArrowDown"===e.key&&(val-=1),this._checkValidity(val)&&this.props.onChange(val))}},_setValue:function(val,format){$(ReactDOM.findDOMNode(this.refs.input)).val(toNumericString(val,format))}});module.exports=NumberInput}).call(this,__webpack_require__(10))},643:function(module,exports,__webpack_require__){__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any;function compareRangeBoundaryPoints(a,whichA,b,whichB){var mode;return mode="start"===whichA&&"start"===whichB?Range.START_TO_START:"start"===whichA&&"end"===whichB?Range.END_TO_START:"end"===whichA&&"start"===whichB?Range.START_TO_END:Range.END_TO_END,a.compareBoundaryPoints(mode,b)}function spanRanges(a,b){var range=a.cloneRange();return range.setEnd(b.endContainer,b.endOffset),range}function rangesOverlap(a,b){return!(compareRangeBoundaryPoints(a,"end",b,"start")<0||compareRangeBoundaryPoints(b,"end",a,"start")<0)}function findBoundaryWordIndex(selectionRange,wordRanges,goal,initialLowerBound,initialUpperBound){for(var bestValidWordIndex=-1,lowerBound=initialLowerBound,upperBound=initialUpperBound,iterationCount=0;lowerBound<=upperBound;){if(++iterationCount>2*wordRanges.length)throw new Error("Assertion error: Binary search isn't terminating? lower="+lowerBound+", upper="+upperBound);var mid=Math.floor((lowerBound+upperBound)/2);"first"===goal?compareRangeBoundaryPoints(wordRanges[mid],"end",selectionRange,"start")<=0?lowerBound=mid+1:(bestValidWordIndex=mid,upperBound=mid-1):compareRangeBoundaryPoints(wordRanges[mid],"start",selectionRange,"end")>=0?upperBound=mid-1:(bestValidWordIndex=mid,lowerBound=mid+1)}return bestValidWordIndex}module.exports={findFirstAndLastWordIndexes:function(selectionRange,wordRanges){var firstWordIndex=findBoundaryWordIndex(selectionRange,wordRanges,"first",0,wordRanges.length-1);if(firstWordIndex<0)return null;var lastWordIndex=findBoundaryWordIndex(selectionRange,wordRanges,"last",firstWordIndex,wordRanges.length-1);return lastWordIndex<0?null:[firstWordIndex,lastWordIndex]},rangesOverlap:rangesOverlap,rangeIncludes:function(a,b){return compareRangeBoundaryPoints(a,"start",b,"start")<=0&&compareRangeBoundaryPoints(a,"end",b,"end")>=0},intersectRanges:function(a,b){return rangesOverlap(a,b)?spanRanges(compareRangeBoundaryPoints(a,"start",b,"start")>0?a:b,compareRangeBoundaryPoints(a,"end",b,"end")<0?a:b):null},unionRanges:function(a,b){return rangesOverlap(a,b)?spanRanges(compareRangeBoundaryPoints(a,"start",b,"start")<0?a:b,compareRangeBoundaryPoints(a,"end",b,"end")>0?a:b):null},spanRanges:spanRanges}},644:function(module,exports,__webpack_require__){(function(i18n){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},classNames=__webpack_require__(22),React=__webpack_require__(0),_=__webpack_require__(1),ApiOptions=__webpack_require__(13).Options,Changeable=__webpack_require__(156),_require=__webpack_require__(72),iconOk=_require.iconOk,iconRemove=_require.iconRemove,InlineIcon=__webpack_require__(58),Renderer=__webpack_require__(33),GradedGroupAnswerBar=__webpack_require__(661),_require2=__webpack_require__(20),gray76=_require2.gray76,phoneMargin=_require2.phoneMargin,negativePhoneMargin=_require2.negativePhoneMargin,tableBackgroundAccent=_require2.tableBackgroundAccent,kaGreen=_require2.kaGreen,_require3=__webpack_require__(6),StyleSheet=_require3.StyleSheet,css=_require3.css,_require4=__webpack_require__(25),linterContextProps=_require4.linterContextProps,linterContextDefault=_require4.linterContextDefault,GRADING_STATUSES_ungraded="ungraded",GRADING_STATUSES_correct="correct",GRADING_STATUSES_incorrect="incorrect",GRADING_STATUSES_invalid="invalid",ANSWER_BAR_STATES=GradedGroupAnswerBar.ANSWER_BAR_STATES,getNextState=function(currentState,answerable){switch(currentState){case ANSWER_BAR_STATES.HIDDEN:return answerable?ANSWER_BAR_STATES.ACTIVE:currentState;case ANSWER_BAR_STATES.ACTIVE:return answerable?currentState:ANSWER_BAR_STATES.INACTIVE;case ANSWER_BAR_STATES.INACTIVE:return answerable?ANSWER_BAR_STATES.ACTIVE:currentState;case ANSWER_BAR_STATES.INCORRECT:return answerable?ANSWER_BAR_STATES.ACTIVE:ANSWER_BAR_STATES.INACTIVE;default:return currentState}},GradedGroup=React.createClass({displayName:"GradedGroup",propTypes:_extends({},Changeable.propTypes,{apiOptions:ApiOptions.propTypes,content:React.PropTypes.string,hasHint:React.PropTypes.bool,hint:React.PropTypes.object,images:React.PropTypes.object,inGradedGroupSet:React.PropTypes.bool,onBlur:React.PropTypes.func,onFocus:React.PropTypes.func,onNextQuestion:React.PropTypes.func,title:React.PropTypes.string,trackInteraction:React.PropTypes.func.isRequired,widgets:React.PropTypes.object,linterContext:linterContextProps}),getDefaultProps:function(){return{title:"",content:"",widgets:{},images:{},hint:null,hasHint:!1,linterContext:linterContextDefault}},getInitialState:function(){return{status:GRADING_STATUSES_ungraded,showHint:!1,message:"",answerBarState:ANSWER_BAR_STATES.HIDDEN}},shouldComponentUpdate:function(nextProps,nextState){return nextProps!==this.props||nextState!==this.state},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},_onInteractWithWidget:function(id){if(this.setState({status:GRADING_STATUSES_ungraded,message:""}),this.refs.renderer){this.change("widgets",this.props.widgets);var answerable=0===this.refs.renderer.emptyWidgets().length,answerBarState=this.state.answerBarState;this.setState({answerBarState:getNextState(answerBarState,answerable)})}},_checkAnswer:function(){this.refs.renderer.showRationalesForCurrentlySelectedChoices();var score=this.refs.renderer.score(),status=void 0,message=void 0;"points"===score.type?(status=score.total===score.earned?GRADING_STATUSES_correct:GRADING_STATUSES_incorrect,message=score.message||""):(status=GRADING_STATUSES_invalid,message=score.message?"We couldn't grade your answer. "+score.message:"We couldn't grade your answer. It looks like you left something blank or entered in an invalid answer."),this.setState({status:status,message:message,answerBarState:"correct"===status?ANSWER_BAR_STATES.CORRECT:ANSWER_BAR_STATES.INCORRECT}),this.props.trackInteraction({status:status})},getInputPaths:function(){return this.refs.renderer.getInputPaths()},setInputValue:function(path,newValue,cb){return this.refs.renderer.setInputValue(path,newValue,cb)},getAcceptableFormatsForInputPath:function(path){return this.refs.renderer.getAcceptableFormatsForInputPath(path)},focus:function(){return this.refs.renderer.focus()},focusInputPath:function(path){this.refs.renderer.focusPath(path)},blurInputPath:function(path){this.refs.renderer.blurPath(path)},render:function(){var _classNames,_this=this,apiOptions=_.extend({},ApiOptions.defaults,this.props.apiOptions,{onFocusChange:function(newFocus,oldFocus){oldFocus&&_this.props.onBlur(oldFocus),newFocus&&_this.props.onFocus(newFocus)}}),icon=null;this.state.status===GRADING_STATUSES_correct?icon=React.createElement(InlineIcon,_extends({},iconOk,{style:{color:"#526f03"}})):this.state.status===GRADING_STATUSES_incorrect&&(icon=React.createElement(InlineIcon,_extends({},iconRemove,{style:{color:"#ff5454"}})));var mobileClass=css(this.props.inGradedGroupSet?styles.gradedGroupInSet:styles.gradedGroup),classes=classNames(((_classNames={})[mobileClass]=apiOptions.isMobile,_classNames["perseus-graded-group"]=!0,_classNames["answer-correct"]=!apiOptions.isMobile&&this.state.status===GRADING_STATUSES_correct,_classNames["answer-incorrect"]=!apiOptions.isMobile&&this.state.status===GRADING_STATUSES_incorrect,_classNames)),answerBarState=this.state.answerBarState,isCorrect=answerBarState===ANSWER_BAR_STATES.CORRECT,readOnly=apiOptions.readOnly||apiOptions.isMobile&&isCorrect;return React.createElement("div",{className:classes},!!this.props.title&&React.createElement("div",{className:css(styles.title)},this.props.title),React.createElement(Renderer,_extends({},this.props,{ref:"renderer",apiOptions:_extends({},apiOptions,{readOnly:readOnly}),onInteractWithWidget:this._onInteractWithWidget,linterContext:this.props.linterContext})),!apiOptions.isMobile&&icon&&React.createElement("div",{className:"group-icon"},icon),!apiOptions.isMobile&&React.createElement("p",null,this.state.message),!apiOptions.isMobile&&React.createElement("input",{type:"button",value:i18n._("Check"),className:"simple-button",disabled:this.props.apiOptions.readOnly,onClick:this._checkAnswer}),!apiOptions.isMobile&&isCorrect&&this.props.onNextQuestion&&React.createElement("input",{type:"button",value:i18n._("Next question"),className:"simple-button",disabled:this.props.apiOptions.readOnly,onClick:this.props.onNextQuestion,style:{marginLeft:5}}),this.props.hint&&this.props.hint.content&&(this.state.showHint?React.createElement("div",null,React.createElement("div",{className:css(styles.explanationTitle),onClick:function(){return _this.setState({showHint:!1})}},i18n._("Hide explanation")),React.createElement(Renderer,_extends({},this.props.hint,{ref:"hints-renderer",apiOptions:apiOptions,linterContext:this.props.linterContext}))):React.createElement("div",{onClick:function(){return _this.setState({showHint:!0})},className:css(styles.showHintLink)},i18n._("Explain"))),apiOptions.isMobile&&answerBarState!==ANSWER_BAR_STATES.HIDDEN&&React.createElement(GradedGroupAnswerBar,{apiOptions:apiOptions,answerBarState:answerBarState,onCheckAnswer:this._checkAnswer,onNextQuestion:this.props.onNextQuestion}))}});module.exports={name:"graded-group",displayName:"Graded group (articles only)",widget:GradedGroup,traverseChildWidgets:function(props,traverseRenderer){return _.extend({},props,traverseRenderer(props))},hidden:!1,tracking:"all",isLintable:!0};var styles=StyleSheet.create({gradedGroupInSet:{marginLeft:0,paddingLeft:0},gradedGroup:{borderTop:"1px solid "+gray76,borderBottom:"1px solid "+gray76,backgroundColor:tableBackgroundAccent,marginLeft:negativePhoneMargin,marginRight:negativePhoneMargin,paddingBottom:phoneMargin,paddingLeft:phoneMargin,paddingRight:phoneMargin,paddingTop:10,width:"auto"},showHintLink:{marginTop:20,color:kaGreen,cursor:"pointer"},explanationTitle:{marginTop:20,color:kaGreen,marginBottom:10,cursor:"pointer"},title:{fontSize:12,color:gray76,textTransform:"uppercase",marginBottom:11,letterSpacing:.8}})}).call(this,__webpack_require__(21))},645:function(module,exports,__webpack_require__){(function($){var React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),Util=__webpack_require__(19),GraphUtils=__webpack_require__(157),interactiveSizes=__webpack_require__(20).interactiveSizes,SvgImage=__webpack_require__(100),defaultBackgroundImage={url:null},defaultInstructionsStyle={fontStyle:"italic",fontWeight:"bold",fontSize:"32px",width:"100%",height:"100%",textAlign:"center",backgroundColor:"white",position:"absolute",zIndex:1,transition:"opacity .25s ease-in-out","-moz-transition":"opacity .25s ease-in-out","-webkit-transition":"opacity .25s ease-in-out"},instructionsTextStyle={position:"relative",top:"25%"};var Graph=React.createClass({displayName:"Graph",propTypes:{box:React.PropTypes.array.isRequired,labels:React.PropTypes.arrayOf(React.PropTypes.string),range:React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.number)),step:React.PropTypes.arrayOf(React.PropTypes.number),gridStep:React.PropTypes.arrayOf(React.PropTypes.number),snapStep:React.PropTypes.arrayOf(React.PropTypes.number),markings:React.PropTypes.string,backgroundImage:React.PropTypes.shape({url:React.PropTypes.string}),showProtractor:React.PropTypes.bool,showRuler:React.PropTypes.bool,rulerLabel:React.PropTypes.string,rulerTicks:React.PropTypes.number,onGraphieUpdated:React.PropTypes.func,instructions:React.PropTypes.string,onClick:React.PropTypes.func,setDrawingAreaAvailable:React.PropTypes.func,isMobile:React.PropTypes.bool},getDefaultProps:function(){return{labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],gridStep:[1,1],snapStep:[.5,.5],markings:"graph",backgroundImage:defaultBackgroundImage,showProtractor:!1,showRuler:!1,rulerLabel:"",rulerTicks:10,instructions:null,onGraphieUpdated:null,onClick:null,onMouseDown:null,isMobile:!1}},render:function(){var image=void 0,imageData=this.props.backgroundImage;if(imageData.url){var scale=this.props.box[0]/interactiveSizes.defaultBoxSize;image=React.createElement(SvgImage,{src:imageData.url,width:imageData.width,height:imageData.height,scale:scale,responsive:!1})}else image=null;return React.createElement("div",{className:"graphie-container above-scratchpad",style:{width:this.props.box[0],height:this.props.box[1]},onMouseOut:this.onMouseOut,onMouseOver:this.onMouseOver,onClick:this.onClick},image,React.createElement("div",{className:"graphie",ref:"graphieDiv"}))},componentDidMount:function(){this._setupGraphie(!0)},componentDidUpdate:function(){this._hasSetupGraphieThisUpdate=!1,this._shouldSetupGraphie&&(this._setupGraphie(!1),this._shouldSetupGraphie=!1)},componentWillReceiveProps:function(nextProps){var self=this;_.each(["labels","range","step","markings","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep"],function(prop){_.isEqual(self.props[prop],nextProps[prop])||(self._shouldSetupGraphie=!0)})},reset:function(){this._setupGraphie(!1)},graphie:function(){return this._graphie},pointsFromNormalized:function(coordsList,noSnap){var self=this;return _.map(coordsList,function(coords){return _.map(coords,function(coord,i){var range=self.props.range[i];if(noSnap)return range[0]+(range[1]-range[0])*coord;var step=self.props.step[i],nSteps=function(range,step){return Math.floor((range[1]-range[0])/step)}(range,step),tick=Math.round(coord*nSteps);return range[0]+step*tick})})},_setupGraphie:function(initialMount){if(!this._hasSetupGraphieThisUpdate){var graphieDiv=ReactDOM.findDOMNode(this.refs.graphieDiv);$(graphieDiv).empty();var labels=this.props.labels,range=this.props.range,graphie=this._graphie=GraphUtils.createGraphie(graphieDiv),gridConfig=this._getGridConfig();graphie.snap=this.props.snapStep,"graph"===this.props.markings?(graphie.graphInit({range:range,scale:_.pluck(gridConfig,"scale"),axisArrows:"<->",labelFormat:function(s){return"\\small{"+s+"}"},gridStep:this.props.gridStep,tickStep:_.pluck(gridConfig,"tickStep"),labelStep:1,unityLabels:_.pluck(gridConfig,"unityLabel"),isMobile:this.props.isMobile}),graphie.label([0,range[1][1]],labels[1],this.props.isMobile?"below right":"above"),graphie.label([range[0][1],0],labels[0],this.props.isMobile?"above left":"right")):"grid"===this.props.markings?graphie.graphInit({range:range,scale:_.pluck(gridConfig,"scale"),gridStep:this.props.gridStep,axes:!1,ticks:!1,labels:!1,isMobile:this.props.isMobile}):"none"===this.props.markings&&graphie.init({range:range,scale:_.pluck(gridConfig,"scale"),isMobile:this.props.isMobile});var $instructionsWrapper=void 0;if(this.props.instructions){$instructionsWrapper=$("<div/>"),_.each(defaultInstructionsStyle,function(value,key){$instructionsWrapper.css(key,value)}),$instructionsWrapper.css("opacity",.5);var $instructions=$("<span/>",{text:this.props.instructions});_.each(instructionsTextStyle,function(value,key){$instructions.css(key,value)}),$instructionsWrapper.append($instructions),$(graphieDiv).append($instructionsWrapper)}else $instructionsWrapper=void 0;var onMouseDown=$instructionsWrapper||this.props.onMouseDown?_.bind(function(coord){$instructionsWrapper&&($instructionsWrapper.remove(),$instructionsWrapper=null),this.props.onMouseDown(coord)},this):null,onMouseOver=$instructionsWrapper?function(){$instructionsWrapper&&$instructionsWrapper.css("opacity",0)}:null,onMouseOut=$instructionsWrapper?function(){$instructionsWrapper&&$instructionsWrapper.css("opacity",.5)}:null;graphie.addMouseLayer({onClick:this.props.onClick,onMouseDown:onMouseDown,onMouseOver:onMouseOver,onMouseOut:onMouseOut,onMouseUp:this.props.onMouseUp,onMouseMove:this.props.onMouseMove,allowScratchpad:!0,setDrawingAreaAvailable:this.props.setDrawingAreaAvailable}),this._updateProtractor(),this._updateRuler(),this._hasSetupGraphieThisUpdate=!0,!initialMount&&this.props.onGraphieUpdated&&this.props.onGraphieUpdated(graphie)}},_getGridConfig:function(){var self=this;return _.map(self.props.step,function(step,i){return Util.gridDimensionConfig(step,self.props.range[i],self.props.box[i],self.props.gridStep[i])})},_updateProtractor:function(){if(this.protractor&&this.protractor.remove(),this.props.showProtractor){var coord=this.pointsFromNormalized([[.5,.05]])[0];this.protractor=this._graphie.protractor(coord)}},_updateRuler:function(){if(this.ruler&&this.ruler.remove(),this.props.showRuler){var coord=this.pointsFromNormalized([[.5,.25]])[0],extent=this._graphie.range[0][1]-this._graphie.range[0][0];this.ruler=this._graphie.ruler({center:coord,label:this.props.rulerLabel,pixelsPerUnit:this._graphie.scale[0],ticksPerUnit:this.props.rulerTicks,units:Math.round(.8*extent)})}},toJSON:function(){return _.pick(this.props,"range","step","markings","labels","backgroundImage","showProtractor","showRuler","rulerLabel","rulerTicks","gridStep","snapStep")}});module.exports=Graph}).call(this,__webpack_require__(10))},646:function(module,exports,__webpack_require__){var React=__webpack_require__(0),ReactComponentsInfoTip=__webpack_require__(668),InfoTip=React.createClass({displayName:"InfoTip",getInitialState:function(){return{didMount:!1}},componentDidMount:function(){this.setState({didMount:!0})},render:function(){return this.state.didMount?React.createElement(ReactComponentsInfoTip,this.props):React.createElement("div",null)}});module.exports=InfoTip},647:function(module,exports,__webpack_require__){(function($){var React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,_=__webpack_require__(1),Util=__webpack_require__(19),Renderer=__webpack_require__(33),ApiClassNames=__webpack_require__(13).ClassNames,Gorgon=__webpack_require__(49),_require2=__webpack_require__(25),linterContextProps=_require2.linterContextProps,linterContextDefault=_require2.linterContextDefault,Placeholder=React.createClass({displayName:"Placeholder",propTypes:{layout:React.PropTypes.oneOf(["horizontal","vertical"]),width:React.PropTypes.number.isRequired,height:React.PropTypes.number.isRequired},render:function(){var layout=this.props.layout,className=css(styles.card,styles.placeholder,"horizontal"===layout&&styles.horizontalCard),style={width:this.props.width,height:this.props.height};return null!=this.props.margin&&(style.margin=this.props.margin),React.createElement("li",{className:className,style:style})}}),Draggable=React.createClass({displayName:"Draggable",propTypes:{content:React.PropTypes.string.isRequired,endPosition:React.PropTypes.object.isRequired,includePadding:React.PropTypes.bool,layout:React.PropTypes.oneOf(["horizontal","vertical"]),onAnimationEnd:React.PropTypes.func.isRequired,onMouseDown:React.PropTypes.func.isRequired,onMouseMove:React.PropTypes.func.isRequired,onMouseUp:React.PropTypes.func.isRequired,onRender:React.PropTypes.func.isRequired,type:React.PropTypes.oneOf(["static","dragging","animating","disabled"]),linterContext:linterContextProps},getDefaultProps:function(){return{includePadding:!0,type:"static",linterContext:linterContextDefault}},getInitialState:function(){return{startPosition:{left:0,top:0},startMouse:{left:0,top:0},mouse:{left:0,top:0}}},componentDidMount:function(){this.isMouseMoveUpBound=!1},componentWillUnmount:function(){this.isMouseMoveUpBound&&this.unbindMouseMoveUp()},getCurrentPosition:function(){return{left:this.state.startPosition.left+this.state.mouse.left-this.state.startMouse.left,top:this.state.startPosition.top+this.state.mouse.top-this.state.startMouse.top}},render:function(){var _props=this.props,includePadding=_props.includePadding,layout=_props.layout,type=_props.type,className=css(styles.card,styles.draggable,"horizontal"===layout&&styles.horizontalCard,"vertical"===layout&&styles.verticalCard,"dragging"===type&&styles.dragging,"animating"===type&&styles.animating,"disabled"===type&&styles.disabled,!includePadding&&styles.unpaddedCard)+" "+ApiClassNames.INTERACTIVE+" perseus-sortable-draggable";includePadding||(className+=" perseus-sortable-draggable-unpadded");var style={position:"static"};return"dragging"!==this.props.type&&"animating"!==this.props.type||_.extend(style,{position:"absolute"},this.getCurrentPosition()),this.props.width&&(style.width=this.props.width+1),this.props.height&&(style.height=this.props.height),null!=this.props.margin&&(style.margin=this.props.margin),React.createElement("li",{className:className,style:style,onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,onTouchMove:this.onMouseMove,onTouchEnd:this.onMouseUp,onTouchCancel:this.onMouseUp},React.createElement(Renderer,{content:this.props.content,linterContext:Gorgon.pushContextStack(this.props.linterContext,"draggable"),onRender:this.props.onRender}))},componentDidUpdate:function(prevProps){if(this.props.type!==prevProps.type)if("animating"===this.props.type){var current=this.getCurrentPosition(),duration=15*Math.sqrt(Math.sqrt(Math.pow(this.props.endPosition.left-current.left,2)+Math.pow(this.props.endPosition.top-current.top,2)));$(ReactDOM.findDOMNode(this)).animate(this.props.endPosition,{duration:Math.max(duration,1),complete:this.props.onAnimationEnd})}else"static"===this.props.type&&$(ReactDOM.findDOMNode(this)).finish()},bindMouseMoveUp:function(){this.isMouseMoveUpBound=!0,$(document).on("mousemove",this.onMouseMove),$(document).on("mouseup",this.onMouseUp)},unbindMouseMoveUp:function(){this.isMouseMoveUpBound=!1,$(document).off("mousemove",this.onMouseMove),$(document).off("mouseup",this.onMouseUp)},onMouseDown:function(event){if("static"===this.props.type&&(0===event.button||null!=event.touches&&1===event.touches.length)){event.preventDefault();var loc=Util.extractPointerLocation(event);loc&&this.setState({startPosition:$(ReactDOM.findDOMNode(this)).position(),startMouse:loc,mouse:loc},function(){this.bindMouseMoveUp(),this.props.onMouseDown()})}},onMouseMove:function(event){if("dragging"===this.props.type){event.preventDefault();var loc=Util.extractPointerLocation(event);loc&&this.setState({mouse:loc},this.props.onMouseMove)}},onMouseUp:function(event){"dragging"===this.props.type&&(event.preventDefault(),Util.extractPointerLocation(event)&&(this.unbindMouseMoveUp(),this.props.onMouseUp()))}}),Sortable=React.createClass({displayName:"Sortable",propTypes:{constraints:React.PropTypes.object,disabled:React.PropTypes.bool,layout:React.PropTypes.oneOf(["horizontal","vertical"]),margin:React.PropTypes.number,onChange:React.PropTypes.func,onMeasure:React.PropTypes.func,options:React.PropTypes.array.isRequired,padding:React.PropTypes.bool,linterContext:linterContextProps},getDefaultProps:function(){return{layout:"horizontal",padding:!0,disabled:!1,constraints:{},onMeasure:function(){},margin:5,onChange:function(){},linterContext:linterContextDefault}},getInitialState:function(){return{items:this.itemsFromProps(this.props)}},componentWillReceiveProps:function(nextProps){var prevProps=this.props;_.isEqual(nextProps.options,prevProps.options)?nextProps.layout===prevProps.layout&&nextProps.padding===prevProps.padding&&nextProps.disabled===prevProps.disabled&&_.isEqual(nextProps.constraints,prevProps.constraints)||this.setState({items:this.clearItemMeasurements(this.state.items)}):this.setState({items:this.itemsFromProps(nextProps)})},componentDidUpdate:function(prevProps){this.state.items.length&&!this.state.items[0].width&&this.measureItems()},itemsFromProps:function(props){var type=props.disabled?"disabled":"static";return _.map(props.options,function(option,i){return{option:option,key:i,type:type,endPosition:{},width:0,height:0}})},clearItemMeasurements:function(items){return _.map(items,function(item){return _.extend(item,{width:0,height:0})})},measureItems:function(){var _this=this,items=_.clone(this.state.items),$items=_.map(items,function(item){return $(ReactDOM.findDOMNode(this.refs[item.key]))},this),widths=_.invoke($items,"outerWidth"),heights=_.invoke($items,"outerHeight"),constraints=this.props.constraints,layout=this.props.layout,syncWidth=void 0;constraints.width?syncWidth=_.max(widths.concat(constraints.width)):"vertical"===layout&&(syncWidth=_.max(widths));var syncHeight=void 0;constraints.height?syncHeight=_.max(heights.concat(constraints.height)):"horizontal"===layout&&(syncHeight=_.max(heights)),items=_.map(items,function(item,i){return item.width=syncWidth||widths[i],item.height=syncHeight||heights[i],item}),this.setState({items:items},function(){_this.props.onMeasure({widths:widths,heights:heights})})},remeasureItems:_.debounce(function(){this.setState({items:this.clearItemMeasurements(this.state.items)})},20),render:function(){var cards=[],layout=this.props.layout,className=css(styles.sortable)+" perseus-sortable";return _.each(this.state.items,function(item,i,items){var isLast=i===items.length-1,isStatic="static"===item.type||"disabled"===item.type,margin=void 0;"horizontal"===this.props.layout?margin="0 "+this.props.margin+"px 0 0":"vertical"===this.props.layout&&(margin="0 0 "+this.props.margin+"px 0"),cards.push(React.createElement(Draggable,{content:item.option,key:item.key,type:item.type,ref:item.key,width:item.width,height:item.height,layout:layout,includePadding:this.props.padding,margin:isLast&&isStatic?0:margin,endPosition:item.endPosition,linterContext:Gorgon.pushContextStack(this.props.linterContext,"sortable"),onRender:this.remeasureItems,onMouseDown:this.onMouseDown.bind(this,item.key),onMouseMove:this.onMouseMove.bind(this,item.key),onMouseUp:this.onMouseUp.bind(this,item.key),onTouchMove:this.onMouseMove.bind(this,item.key),onTouchEnd:this.onMouseUp.bind(this,item.key),onTouchCancel:this.onMouseUp.bind(this,item.key),onAnimationEnd:this.onAnimationEnd.bind(this,item.key)})),"dragging"!==item.type&&"animating"!==item.type||cards.push(React.createElement(Placeholder,{key:"placeholder_"+item.key,ref:"placeholder_"+item.key,width:item.width,height:item.height,layout:layout,margin:isLast?0:margin}))},this),React.createElement("ul",{className:className},cards)},onMouseDown:function(key){var items=_.map(this.state.items,function(item){return item.key===key&&(item.type="dragging"),item});this.setState({items:items})},onMouseMove:function(key){var $draggable=$(ReactDOM.findDOMNode(this.refs[key])),$sortable=$(ReactDOM.findDOMNode(this)),items=_.clone(this.state.items),item=_.findWhere(this.state.items,{key:key}),margin=this.props.margin,currentIndex=_.indexOf(items,item),newIndex=0;if(items.splice(currentIndex,1),"horizontal"===this.props.layout){var midWidth=$draggable.offset().left-$sortable.offset().left,sumWidth=0,cardWidth=void 0;_.each(items,function(item){cardWidth=item.width,midWidth>sumWidth+cardWidth/2&&(newIndex+=1),sumWidth+=cardWidth+margin})}else{var midHeight=$draggable.offset().top-$sortable.offset().top,sumHeight=0,cardHeight=void 0;_.each(items,function(item){cardHeight=item.height,midHeight>sumHeight+cardHeight/2&&(newIndex+=1),sumHeight+=cardHeight+margin})}newIndex!==currentIndex&&(items.splice(newIndex,0,item),this.setState({items:items}))},onMouseUp:function(key){var items=_.map(this.state.items,function(item){return item.key===key&&(item.type="animating",item.endPosition=$(ReactDOM.findDOMNode(this.refs["placeholder_"+key])).position()),item},this);this.setState({items:items}),this.props.onChange({})},onAnimationEnd:function(key){var items=_.map(this.state.items,function(item){return item.key===key&&(item.type="static"),item});this.setState({items:items})},getOptions:function(){return _.pluck(this.state.items,"option")}}),styles=StyleSheet.create({sortable:{boxSizing:"border-box",float:"left",padding:0,margin:0},card:{boxSizing:"border-box",background:"#fff",border:"1px solid #ddd",borderRadius:4,cursor:"pointer",minWidth:25,minHeight:44,padding:10,listStyleType:"none",userSelect:"none",touchAction:"none"},placeholder:{background:"#ddd",border:"1px solid #ccc"},draggable:{textAlign:"center"},horizontalCard:{float:"left",cursor:"ew-resize"},verticalCard:{maxWidth:"100%",cursor:"ns-resize"},unpaddedCard:{padding:0},dragging:{background:"#ffedcd",opacity:"0.8"},disabled:{backgroundColor:"inherit",border:"1px solid transparent",cursor:"default"}});module.exports=Sortable}).call(this,__webpack_require__(10))},648:function(module,exports,__webpack_require__){var React=__webpack_require__(0),draw=__webpack_require__(673),layout=__webpack_require__(674).layout,SmilesParser=__webpack_require__(675),parse=SmilesParser.parse,ParseError=SmilesParser.ParseError,Molecule=React.createClass({displayName:"Molecule",propTypes:{id:React.PropTypes.string.isRequired,rotationAngle:React.PropTypes.number,smiles:React.PropTypes.string},getInitialState:function(){return{parsedSmiles:null,error:null}},componentWillMount:function(){this.stateFromSmiles(this.props.smiles)},componentDidMount:function(){this.canvasRender()},componentWillReceiveProps:function(nextProps){this.stateFromSmiles(nextProps.smiles)},componentDidUpdate:function(){this.canvasRender()},stateFromSmiles:function(smiles){try{this.setState({parsedSmiles:parse(smiles),error:null})}catch(e){if(!(e instanceof ParseError))throw e;this.setState({error:e.message})}},setCanvasBounds:function(canvas,items){var xmax=Math.max.apply(Math,items.map(function(item){return item.pos?item.pos[0]:-1/0})),ymax=Math.max.apply(Math,items.map(function(item){return item.pos?item.pos[1]:-1/0})),xmin=Math.min.apply(Math,items.map(function(item){return item.pos?item.pos[0]:1/0})),ymin=Math.min.apply(Math,items.map(function(item){return item.pos?item.pos[1]:1/0})),width=xmax-xmin+60,height=ymax-ymin+60;return canvas.width=width,canvas.height=height,[30-xmin,30-ymin]},canvasRender:function(){if(!this.state.error&&this.state.parsedSmiles){var items=layout(this.state.parsedSmiles,this.props.rotationAngle),canvas=this.refs.canvas,translation=this.setCanvasBounds(canvas,items),ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.translate(translation[0],translation[1]),draw(ctx,items),ctx.restore()}},render:function(){var content=React.createElement("canvas",{className:"molecule-canvas",id:this.props.id+"-molecule",ref:"canvas"},"A molecular structure drawing. SMILES notation:",this.props.smiles,".");return this.state.error&&(content=React.createElement("div",{className:"error"},this.state.error)),React.createElement("div",{className:"molecule-canvas"},content)}}),MoleculeWidget=React.createClass({displayName:"MoleculeWidget",propTypes:{rotationAngle:React.PropTypes.number,smiles:React.PropTypes.string,widgetId:React.PropTypes.string},getDefaultProps:function(){return{rotationAngle:0}},simpleValidate:function(){return{type:"points",earned:0,total:0,message:null}},getUserInput:function(){return[]},validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}},render:function(){return React.createElement(Molecule,{id:this.props.widgetId,smiles:this.props.smiles,rotationAngle:this.props.rotationAngle})}});module.exports={name:"molecule-renderer",displayName:"Molecule renderer",hidden:!0,widget:MoleculeWidget,molecule:Molecule}},649:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var arguments$1=arguments,i=1;i<arguments.length;i++){var source=arguments$1[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_require=(__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_Rect||__webpack_require__(0).PropTypes.any,__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_Position||__webpack_require__(0).PropTypes.any,__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any,__webpack_require__(643)),rangesOverlap=_require.rangesOverlap,intersectRanges=_require.intersectRanges;function getRelativePosition(child,parent){return{left:child.left-parent.left,top:child.top-parent.top}}module.exports={getClientRectsForTextInRange:function(range){var mutableRects=[];return function addClientRectsForTextInNodeAndRange(node,range,mutableRects){var nodeContentsRange=new Range;nodeContentsRange.selectNodeContents(node);if(node.nodeType===Node.TEXT_NODE){var intersectedRange=intersectRanges(range,nodeContentsRange);intersectedRange&&function(textNode,textRange,mutableRects){var parentElement=textNode.parentElement,computedStyle=window.getComputedStyle(parentElement),lineHeight=null;if("string"==typeof computedStyle.lineHeight&&computedStyle.lineHeight.endsWith("px")){var parsedLineHeight=parseFloat(computedStyle.lineHeight);isNaN(parsedLineHeight)||(lineHeight=parsedLineHeight)}var _iterator2=Array.from(textRange.getClientRects()),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var boundingRect=_ref2,rect={left:boundingRect.left,top:boundingRect.top,height:boundingRect.height,width:boundingRect.width};if(null!==lineHeight){var heightIncrease=lineHeight-rect.height;rect.top-=heightIncrease,rect.height=lineHeight}mutableRects.push(rect)}}(node,intersectedRange,mutableRects)}else if(node.nodeType===Node.ELEMENT_NODE){if(!rangesOverlap(range,nodeContentsRange))return;for(var _iterator=Array.from(node.childNodes),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var child=_ref;addClientRectsForTextInNodeAndRange(child,range,mutableRects)}}}(range.commonAncestorContainer,range,mutableRects),mutableRects},getRelativePosition:getRelativePosition,getRelativeRect:function(child,parent){return _extends({},getRelativePosition(child,parent),{width:child.width,height:child.height})}}},650:function(module,exports,__webpack_require__){var React=__webpack_require__(0),_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,getRelativePosition=__webpack_require__(649).getRelativePosition,HighlightTooltip=(__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_Position||__webpack_require__(0).PropTypes.any,function(_React$PureComponent){function HighlightTooltip(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HighlightTooltip),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_React$PureComponent.apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HighlightTooltip,_React$PureComponent),HighlightTooltip.prototype._getPosition=function(){var _props=this.props,focusNode=_props.focusNode,focusOffset=_props.focusOffset,offsetParent=_props.offsetParent,focusRange=document.createRange();focusRange.setStart(focusNode,focusOffset),focusRange.setEnd(focusNode,focusOffset);var focusRect=focusRange.getClientRects()[0];if(!focusRect)return console.warn('[Highlighting] Known bug: Could not determine the focus position, so did not show an "Add Highlight" tooltip. https://app.asana.com/0/329800276300868/413878480039713'),null;var offsetParentRect=offsetParent.getBoundingClientRect();return getRelativePosition(focusRect,offsetParentRect)},HighlightTooltip.prototype.render=function(){var position=this._getPosition();return position?React.createElement("div",{className:css(styles.tooltip),onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,style:{left:position.left,top:position.top,zIndex:this.props.zIndex}},React.createElement("div",{className:css(styles.label)},this.props.label),React.createElement("div",{className:css(styles.arrow)})):null},HighlightTooltip}(React.PureComponent));HighlightTooltip.propTypes={label:__webpack_require__(0).PropTypes.string.isRequired,onClick:__webpack_require__(0).PropTypes.func.isRequired,onMouseEnter:__webpack_require__(0).PropTypes.func,onMouseLeave:__webpack_require__(0).PropTypes.func,focusNode:__webpack_require__(0).PropTypes.any.isRequired,focusOffset:__webpack_require__(0).PropTypes.number.isRequired,offsetParent:__webpack_require__(0).PropTypes.any.isRequired,zIndex:__webpack_require__(0).PropTypes.number.isRequired};var styles=StyleSheet.create({tooltip:{position:"absolute",transform:"translate(-50%, -100%)",cursor:"pointer",userSelect:"none"},label:{background:"#314453",borderRadius:2,boxShadow:"0 1px 4px 0 rgba(97, 101, 105, 0.42)",padding:"8px 11px",color:"white",fontSize:12,lineHeight:1.5,textAlign:"center"},arrow:{height:0,width:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #314453",margin:"0 auto"}});module.exports=HighlightTooltip},651:function(module,exports,__webpack_require__){function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}var React=__webpack_require__(0),babelPluginFlowReactPropTypes_proptype_DOMHighlight=(__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any,__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMHighlight||__webpack_require__(0).PropTypes.any);Object.defineProperty(module.exports,"babelPluginFlowReactPropTypes_proptype_TrackedSelection",__webpack_require__(0).PropTypes.shape({focusNode:__webpack_require__(0).PropTypes.any.isRequired,focusOffset:__webpack_require__(0).PropTypes.number.isRequired,proposedHighlight:babelPluginFlowReactPropTypes_proptype_DOMHighlight}));var SelectionTracker=function(_React$PureComponent){function SelectionTracker(){var _temp,_this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SelectionTracker);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,_React$PureComponent.call.apply(_React$PureComponent,[this].concat(args))),_this.state={mouseState:"up",trackedSelection:null},_this._handleSelectionChange=function(){_this._updateTrackedSelection(_this.props.buildHighlight),"down"===_this.state.mouseState&&_this.setState({mouseState:"down-and-selecting"})},_this._handleMouseDown=function(){_this.setState({mouseState:"down"})},_this._handleMouseUp=function(){_this.setState({mouseState:"up"})},_possibleConstructorReturn(_this,_temp)}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(SelectionTracker,_React$PureComponent),SelectionTracker.prototype.componentDidMount=function(){this._updateListeners(!1,this.props.enabled)},SelectionTracker.prototype.componentWillReceiveProps=function(nextProps){this.props.buildHighlight!==nextProps.buildHighlight&&this._updateTrackedSelection(nextProps.buildHighlight),this._updateListeners(this.props.enabled,nextProps.enabled)},SelectionTracker.prototype.componentWillUnmount=function(){this._updateListeners(this.props.enabled,!1)},SelectionTracker.prototype._updateListeners=function(wasListening,willListen){!wasListening&&willListen?(window.addEventListener("mousedown",this._handleMouseDown),window.addEventListener("mouseup",this._handleMouseUp),document.addEventListener("selectionchange",this._handleSelectionChange)):wasListening&&!willListen&&(window.removeEventListener("mousedown",this._handleMouseDown),window.removeEventListener("mouseup",this._handleMouseUp),document.removeEventListener("selectionchange",this._handleSelectionChange),this.setState({mouseState:"up",trackedSelection:null}))},SelectionTracker.prototype._computeFocusAndRange=function(){var selection=document.getSelection();if(!selection||0===selection.rangeCount)return null;var range=selection.getRangeAt(0);return range.collapsed?null:{focusNode:selection.focusNode,focusOffset:selection.focusOffset,range:range}},SelectionTracker.prototype._computeTrackedSelection=function(buildHighlight){var focusAndRange=this._computeFocusAndRange();if(!focusAndRange)return null;var focusNode=focusAndRange.focusNode,focusOffset=focusAndRange.focusOffset,proposedHighlight=buildHighlight(focusAndRange.range);return proposedHighlight?{focusNode:focusNode,focusOffset:focusOffset,proposedHighlight:proposedHighlight}:null},SelectionTracker.prototype._updateTrackedSelection=function(buildHighlight){var trackedSelection=this._computeTrackedSelection(buildHighlight);this.setState({trackedSelection:trackedSelection})},SelectionTracker.prototype.render=function(){var _state=this.state,mouseState=_state.mouseState,trackedSelection=_state.trackedSelection,userIsMouseSelecting="down-and-selecting"===mouseState;return this.props.children&&React.createElement("div",null,this.props.children(trackedSelection,userIsMouseSelecting))},SelectionTracker}(React.PureComponent);SelectionTracker.propTypes={buildHighlight:__webpack_require__(0).PropTypes.func.isRequired,children:__webpack_require__(0).PropTypes.func,enabled:__webpack_require__(0).PropTypes.bool.isRequired},module.exports=SelectionTracker},652:function(module,exports,__webpack_require__){(function(i18n){var _fullBleedContainer,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,React=__webpack_require__(0),classNames=__webpack_require__(22),Changeable=__webpack_require__(156),WidgetJsonifyDeprecated=__webpack_require__(269),_=__webpack_require__(1),ApiClassNames=__webpack_require__(13).ClassNames,ApiOptions=__webpack_require__(13).Options,_require2=__webpack_require__(72),iconCircle=_require2.iconCircle,iconCircleThin=_require2.iconCircleThin,InlineIcon=__webpack_require__(58),Renderer=__webpack_require__(33),Util=__webpack_require__(19),mediaQueries=__webpack_require__(59),sharedStyles=__webpack_require__(102),_require3=__webpack_require__(25),linterContextProps=_require3.linterContextProps,linterContextDefault=_require3.linterContextDefault,Categorizer=React.createClass({displayName:"Categorizer",propTypes:_extends({},Changeable.propTypes,{apiOptions:ApiOptions.propTypes,categories:React.PropTypes.arrayOf(React.PropTypes.string),items:React.PropTypes.arrayOf(React.PropTypes.string),trackInteraction:React.PropTypes.func.isRequired,values:React.PropTypes.arrayOf(React.PropTypes.number),linterContext:linterContextProps}),getDefaultProps:function(){return{items:[],categories:[],values:[],linterContext:linterContextDefault}},getInitialState:function(){return{uniqueId:_.uniqueId("perseus_radio_")}},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},getUserInput:function(){return WidgetJsonifyDeprecated.getUserInput.call(this)},render:function(){var _this=this,self=this,isMobile=this.props.apiOptions.isMobile,indexedItems=this.props.items.map(function(item,n){return[item,n]});this.props.randomizeItems&&(indexedItems=Util.shuffle(indexedItems,this.props.problemNum));var table=React.createElement("table",{className:"categorizer-table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,""),this.props.categories.map(function(category,i){return React.createElement("th",{className:css(styles.header),key:i},React.createElement(Renderer,{content:category,linterContext:_this.props.linterContext}))}))),React.createElement("tbody",null,indexedItems.map(function(indexedItem){var item=indexedItem[0],itemNum=indexedItem[1],uniqueId=self.state.uniqueId+"_"+itemNum;return React.createElement("tr",{key:itemNum},React.createElement("td",null,React.createElement(Renderer,{content:item,linterContext:_this.props.linterContext})),_.range(self.props.categories.length).map(function(catNum){var selected=self.props.values[itemNum]===catNum;return React.createElement("td",{className:"category "+css(styles.cell,styles.responsiveCell),key:catNum},React.createElement("div",{className:ApiClassNames.INTERACTIVE,onClick:_this.onChange.bind(_this,itemNum,catNum)},isMobile&&React.createElement("input",{type:"radio",name:uniqueId,className:css(sharedStyles.responsiveInput,sharedStyles.responsiveRadioInput),checked:selected,onChange:_this.onChange.bind(_this,itemNum,catNum),onClick:function(e){return e.stopPropagation()}}),!isMobile&&React.createElement("span",{className:css(styles.responsiveSpan,styles.radioSpan,selected&&styles.checkedRadioSpan,_this.props.static&&selected&&styles.staticCheckedRadioSpan)},selected?React.createElement(InlineIcon,iconCircle):React.createElement(InlineIcon,iconCircleThin))))}))}))),extraClassNames=classNames({"categorizer-container":!0,"static-mode":this.props.static}),inlineStyles=this.props.apiOptions.isMobile?[styles.fullBleedContainer]:[];return React.createElement("div",{className:extraClassNames+" "+css.apply(void 0,inlineStyles)},table)},onChange:function(itemNum,catNum){var values=_.clone(this.props.values);values[itemNum]=catNum,this.change("values",values),this.props.trackInteraction()},simpleValidate:function(rubric){return Categorizer.validate(this.getUserInput(),rubric)}});_.extend(Categorizer,{validate:function(state,rubric){var completed=!0,allCorrect=!0;return _.each(rubric.values,function(value,i){null==state.values[i]&&(completed=!1),state.values[i]!==value&&(allCorrect=!1)}),completed?{type:"points",earned:allCorrect?1:0,total:1,message:null}:{type:"invalid",message:i18n._("Make sure you select something for every row.")}}});var styles=StyleSheet.create({fullBleedContainer:(_fullBleedContainer={},_fullBleedContainer[mediaQueries.mdOrSmaller]={marginLeft:-16,marginRight:-16,overflowX:"auto"},_fullBleedContainer),header:{textAlign:"center",verticalAlign:"bottom"},cell:{textAlign:"center",padding:0,color:"#ccc",verticalAlign:"middle"},radioSpan:{fontSize:30,paddingRight:3,":hover":{color:"#999"}},checkedRadioSpan:{color:"#333"},staticCheckedRadioSpan:{color:"#888"}});module.exports={name:"categorizer",displayName:"Categorizer",widget:Categorizer,transform:function(editorProps){return _.pick(editorProps,"items","categories","randomizeItems")},staticTransform:function(editorProps){return _.pick(editorProps,"items","categories","values","randomizeItems")},isLintable:!0}}).call(this,__webpack_require__(21))},653:function(module,exports,__webpack_require__){(function($){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),updateQueryString=__webpack_require__(19).updateQueryString,IS_KA_SITE=/khanacademy\.org/,KA_EMBED_URL="https://{hostname}/computer-programming/program/{programID}/embedded?embed=yes&author=no";var CSProgram=React.createClass({displayName:"CSProgram",propTypes:_extends({},Changeable.propTypes,{programID:React.PropTypes.string,width:React.PropTypes.number,height:React.PropTypes.number,settings:React.PropTypes.array,showEditor:React.PropTypes.bool,showButtons:React.PropTypes.bool,status:React.PropTypes.oneOf(["incomplete","incorrect","correct"]),message:React.PropTypes.string}),getDefaultProps:function(){return{showEditor:!1,showButtons:!1,status:"incomplete",message:null}},handleMessageEvent:function(e){var data={};try{data=JSON.parse(e.originalEvent.data)}catch(err){return}if(!_.isUndefined(data.testsPassed)){var status=data.testsPassed?"correct":"incorrect";this.change({status:status,message:data.message})}},componentDidMount:function(){$(window).on("message",this.handleMessageEvent)},componentWillUnmount:function(){$(window).off("message",this.handleMessageEvent)},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},render:function(){if(!this.props.programID)return React.createElement("div",null);var className,url=function(programID){var url=KA_EMBED_URL.replace("{programID}",programID),currentHostname=document.location.hostname,embedHostname="www.khanacademy.org";return IS_KA_SITE.test(currentHostname)&&(embedHostname=currentHostname),url.replace("{hostname}",embedHostname)}(this.props.programID),style={height:this.props.height};if(this.props.showEditor?(url+="&editor=yes",style.width="100%",className="perseus-scratchpad-editor"):(url+="&editor=no",style.width=this.props.width+2,className="perseus-scratchpad"),this.props.showButtons?(url+="&buttons=yes",style.height+=50):url+="&buttons=no",this.props.settings){var settings={};_.each(this.props.settings,function(setting){setting.name&&setting.value&&(settings[setting.name]=setting.value)}),url=updateQueryString(url,"settings",JSON.stringify(settings))}var sandboxOptions=["allow-popups","allow-same-origin","allow-scripts","allow-top-navigation"].join(" ");return React.createElement("iframe",{sandbox:sandboxOptions,src:url,style:style,className:className,allowFullScreen:!0})},simpleValidate:function(rubric){return CSProgram.validate({status:this.props.status,message:this.props.message},rubric)},statics:{validate:function(state,rubric){return"correct"===state.status?{type:"points",earned:1,total:1,message:state.message||null}:"incorrect"===state.status?{type:"points",earned:0,total:1,message:state.message||null}:{type:"invalid",message:"Keep going, you're not there yet!"}}}});module.exports={name:"cs-program",displayName:"CS Program",supportedAlignments:["block","full-width"],widget:CSProgram,hidden:!0}}).call(this,__webpack_require__(10))},654:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,classNames=__webpack_require__(22),React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),ApiClassNames=__webpack_require__(13).ClassNames,ApiOptions=__webpack_require__(13).Options,InlineIcon=__webpack_require__(58),styleConstants=__webpack_require__(20),iconDropdownArrow=__webpack_require__(72).iconDropdownArrow,Dropdown=React.createClass({displayName:"Dropdown",propTypes:{apiOptions:ApiOptions.propTypes,choices:React.PropTypes.arrayOf(React.PropTypes.string),onChange:React.PropTypes.func.isRequired,placeholder:React.PropTypes.string,selected:React.PropTypes.number,trackInteraction:React.PropTypes.func.isRequired},getDefaultProps:function(){return{choices:[],selected:0,placeholder:"",apiOptions:ApiOptions.defaults}},render:function(){var choices=this.props.choices.slice(),selectClasses=classNames({"perseus-widget-dropdown":!0});return React.createElement("div",null,React.createElement("select",{onChange:this._handleChangeEvent,onClick:function(e){e.stopPropagation(),e.target.focus()},onTouchStart:function(e){e.stopPropagation(),e.target.focus()},className:selectClasses+" nofastclick "+css(styles.dropdown)+" "+ApiClassNames.INTERACTIVE,disabled:this.props.apiOptions.readOnly,value:this.props.selected},React.createElement("option",{value:0,disabled:!0},this.props.placeholder),choices.map(function(choice,i){return React.createElement("option",{key:""+(i+1),value:i+1},choice)})),React.createElement(InlineIcon,_extends({},iconDropdownArrow,{style:{marginLeft:"-24px",height:24,width:24}})))},focus:function(){return ReactDOM.findDOMNode(this).focus(),!0},_handleChangeEvent:function(e){this._handleChange(parseInt(e.target.value))},_handleChange:function(selected){this.props.trackInteraction(),this.props.onChange({selected:selected})},getUserInput:function(){return{value:this.props.selected}},simpleValidate:function(rubric){return Dropdown.validate(this.getUserInput(),rubric)}});_.extend(Dropdown,{validate:function(state,rubric){var selected=state.value;return 0===selected?{type:"invalid",message:null}:{type:"points",earned:rubric.choices[selected-1].correct?1:0,total:1,message:null}}});var styles=StyleSheet.create({dropdown:{appearance:"none",backgroundColor:"transparent",border:"1px solid "+styleConstants.gray76,borderRadius:4,boxShadow:"none",fontFamily:styleConstants.baseFontFamily,padding:"9px 25px 9px 9px",":focus":{outline:"none",border:"2px solid "+styleConstants.kaGreen,padding:"8px 24px 8px 8px"},":focus + svg":{color:""+styleConstants.kaGreen},":disabled":{color:styleConstants.gray68},":disabled + svg":{color:styleConstants.gray68}}});module.exports={name:"dropdown",displayName:"Drop down",defaultAlignment:"inline-block",accessible:!0,widget:Dropdown,transform:function(editorProps){return{placeholder:editorProps.placeholder,choices:_.map(editorProps.choices,function(choice){return choice.content})}}}},655:function(module,exports,__webpack_require__){var _explanationLink,_mobileExplanationLin,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),PerseusApi=__webpack_require__(13),Renderer=__webpack_require__(33),mediaQueries=__webpack_require__(59),styleConstants=__webpack_require__(20),_require2=__webpack_require__(25),linterContextProps=_require2.linterContextProps,defaultExplanationProps={showPrompt:"Explain",hidePrompt:"Hide explanation",explanation:"explanation goes here\n\nmore explanation",widgets:{},linterContext:_require2.linterContextDefault},Explanation=React.createClass({displayName:"Explanation",propTypes:_extends({},Changeable.propTypes,{apiOptions:PerseusApi.Options.propTypes,explanation:React.PropTypes.string,hidePrompt:React.PropTypes.string,showPrompt:React.PropTypes.string,trackInteraction:React.PropTypes.func.isRequired,widgets:React.PropTypes.object,linterContext:linterContextProps}),getDefaultProps:function(){return defaultExplanationProps},getInitialState:function(){return{expanded:!1}},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},_onClick:function(){this.setState({expanded:!this.state.expanded}),this.props.trackInteraction()},render:function(){var linkContainer,Link=this.props.apiOptions.baseElements.Link,_props$apiOptions=this.props.apiOptions,readOnly=_props$apiOptions.readOnly,isMobile=_props$apiOptions.isMobile,linkAnchor=this.state.expanded?this.props.hidePrompt:this.props.showPrompt,href=readOnly?null:"javascript:void(0)",onClick=readOnly?null:this._onClick;linkContainer=isMobile?React.createElement("div",{className:css(styles.linkContainer)},React.createElement("a",{className:css(styles.mobileExplanationLink),href:href,onClick:onClick},linkAnchor),this.state.expanded&&React.createElement("svg",{className:css(styles.disclosureArrow)},React.createElement("polygon",{style:{fill:backgroundColor},points:"0,"+arrowHeight+" "+arrowWidth+","+arrowHeight+" "+arrowWidth/2+",0"}))):React.createElement("div",{className:css(styles.linkContainer)},React.createElement(Link,{className:css(styles.explanationLink),href:href,onClick:onClick},"["+linkAnchor+"]"));var expandedStyle=isMobile?styles.contentExpandedMobile:styles.contentExpanded;return React.createElement("div",{className:css(styles.container)},linkContainer,React.createElement("div",{className:css(styles.content,isMobile&&styles.contentMobile,this.state.expanded&&expandedStyle),style:{height:this.state.expanded?"auto":0,overflow:this.state.expanded?"visible":"hidden"},ref:"content"},React.createElement(Renderer,{apiOptions:this.props.apiOptions,content:this.props.explanation,widgets:this.props.widgets,linterContext:this.props.linterContext})))},getUserInput:function(){return{}},simpleValidate:function(rubric){return Explanation.validate(this.getUserInput(),rubric)}}),arrowWidth=30,arrowHeight=14,backgroundColor=styleConstants.gray95,styles=StyleSheet.create({container:{display:"inline",position:"relative"},linkContainer:{display:"inline-block"},explanationLink:(_explanationLink={fontStyle:"italic",color:"#007d96"},_explanationLink[mediaQueries.xl]={fontSize:20,lineHeight:1.1},_explanationLink[mediaQueries.lgOrSmaller]={fontSize:17,lineHeight:1.4},_explanationLink[mediaQueries.smOrSmaller]={fontSize:14,lineHeight:1.3},_explanationLink),mobileExplanationLink:(_mobileExplanationLin={color:styleConstants.kaGreen,borderBottom:"dashed 1px "+styleConstants.kaGreen,textDecoration:"none"},_mobileExplanationLin[mediaQueries.xl]={fontSize:22,lineHeight:1.4},_mobileExplanationLin[mediaQueries.lgOrSmaller]={fontSize:20,lineHeight:1.5},_mobileExplanationLin[mediaQueries.smOrSmaller]={fontSize:18,lineHeight:1.2},_mobileExplanationLin),content:{position:"relative",transition:"margin-top 0.1s"},contentExpanded:{borderLeft:"5px solid #ccc",marginLeft:-23,paddingLeft:23,paddingBottom:10,marginBottom:arrowHeight,marginTop:arrowHeight},contentExpandedMobile:{boxSizing:"content-box",paddingTop:32,paddingBottom:32,marginTop:arrowHeight},contentMobile:{background:backgroundColor,marginLeft:styleConstants.negativePhoneMargin,marginRight:styleConstants.negativePhoneMargin,paddingLeft:styleConstants.phoneMargin,paddingRight:styleConstants.phoneMargin},disclosureArrow:{bottom:-(arrowHeight+5),height:arrowHeight,left:"50%",marginLeft:-arrowWidth/2,position:"absolute",width:arrowWidth}});_.extend(Explanation,{validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}}}),module.exports={name:"explanation",displayName:"Explanation",defaultAlignment:"inline",widget:Explanation,transform:_.identity,isLintable:!0}},656:function(module,exports,__webpack_require__){var _mobileDefinitionLink,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),PerseusApi=__webpack_require__(13),Renderer=__webpack_require__(33),mediaQueries=__webpack_require__(59),styleConstants=__webpack_require__(20),Definition=React.createClass({displayName:"Definition",propTypes:_extends({},Changeable.propTypes,{apiOptions:PerseusApi.Options.propTypes,definition:React.PropTypes.string,togglePrompt:React.PropTypes.string,trackInteraction:React.PropTypes.func.isRequired}),getDefaultProps:function(){return{togglePrompt:"define me",definition:"definition goes here"}},getInitialState:function(){return{expanded:!1,belowScreen:!1,contentOffsetLeft:0,contentOffsetLeftMobile:0,contentWidth:0,contentWidthMobile:0,contentMarginTop:arrowHeight}},componentDidMount:function(){document.addEventListener("click",this.handleClick)},componentWillUnmount:function(){document.removeEventListener("click",this.handleClick)},handleClick:function(event){for(var elem=event.target,shouldClose=!0;elem;){if(elem===this.content||elem===this.container){shouldClose=!1;break}elem=elem.parentNode}shouldClose&&this.close()},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},close:function(){this.setState({expanded:!1})},getUserInput:function(){return{}},simpleValidate:function(rubric){return Definition.validate(this.getUserInput(),rubric)},_definitionBelowScreen:function(){var windowBottom=window.innerHeight;return this.container.getBoundingClientRect().bottom>windowBottom-this.content.offsetHeight},_checkDefinitionPosition:function(){var _this=this;setTimeout(function(){_this._positionContentHorizontally(),_this._definitionBelowScreen()?_this.setState({belowScreen:!0},_this._positionContentVertically):_this.setState({belowScreen:!1},_this._positionContentVertically)},0)},_positionContentVertically:function(){if(this.state.belowScreen){var contentMarginTop=-this.content.offsetHeight-2*arrowHeight-4;this.setState({contentMarginTop:contentMarginTop})}else this.setState({contentMarginTop:arrowHeight})},_onClick:function(){if(!this.state.expanded){var _iterator=this.props.findWidgets("definition"),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}_ref!==this&&_ref.close()}}this.setState({expanded:!this.state.expanded},this._checkDefinitionPosition),this.props.trackInteraction()},_onMouseOver:function(){this.setState({expanded:!0},this._checkDefinitionPosition),this.props.trackInteraction()},_onMouseOut:function(){this.setState({expanded:!1}),this.props.trackInteraction()},_positionContentHorizontally:function(){var documentWidth=document.body.clientWidth,marginWidth=this.container.parentElement.parentElement.offsetLeft,contentWidth=documentWidth-2*marginWidth,contentWidthMobile=documentWidth-marginWidth,contentOffsetLeft=this.container.offsetLeft-marginWidth,contentOffsetLeftMobile=this.container.offsetLeft;this.setState({contentWidth:contentWidth,contentWidthMobile:contentWidthMobile,contentOffsetLeft:-contentOffsetLeft,contentOffsetLeftMobile:-contentOffsetLeftMobile})},render:function(){var link,_this2=this,_props$apiOptions=this.props.apiOptions,readOnly=_props$apiOptions.readOnly,isMobile=_props$apiOptions.isMobile,linkAnchor=this.props.togglePrompt,href=readOnly?null:"javascript:void(0)",onClick=readOnly?null:this._onClick,onMouseOver=this._onMouseOver,onMouseOut=this._onMouseOut;link=isMobile?React.createElement("a",{className:css(styles.mobileDefinitionLink),href:href,onClick:onClick},linkAnchor):React.createElement("a",{className:css(styles.definitionLink),href:href,onMouseOver:onMouseOver,onMouseOut:onMouseOut},linkAnchor);var expandedStyle=isMobile?styles.contentExpandedMobile:styles.contentExpanded,arrowTransform=this.state.belowScreen?"scale(1, -1)":"scale(1, 1)";return React.createElement("div",{className:css(styles.container),ref:function(e){return _this2.container=e}},React.createElement("div",{className:css(styles.linkContainer)},link,this.state.expanded&&React.createElement("svg",{className:css(styles.disclosureArrow),ref:function(e){return _this2.arrow=e},transform:arrowTransform,style:{bottom:this.state.expanded&&this.state.belowScreen?"18px":"-18px"}},React.createElement("filter",{id:"definition-widget-dropshadow",height:"150%"},React.createElement("feOffset",{dx:dropShadowXOffset,dy:dropShadowYOffset,result:"offsetblur"}),React.createElement("feGaussianBlur",{in:"SourceAlpha",stdDeviation:dropShadowRadius/2}),React.createElement("feComponentTransfer",null,React.createElement("feFuncA",{type:"linear",slope:dropShadowOpacity})),React.createElement("feMerge",null,React.createElement("feMergeNode",null),React.createElement("feMergeNode",{in:"SourceGraphic"}))),React.createElement("polyline",{fill:"white",filter:"url(#definition-widget-dropshadow)",points:"0,"+arrowHeight+" "+arrowWidth+","+arrowHeight+" "+arrowWidth/2+",0"}))),React.createElement("div",{className:css(styles.content,isMobile&&styles.contentMobile,this.state.expanded&&expandedStyle),style:{height:this.state.expanded?"auto":0,overflow:this.state.expanded?"visible":"hidden",left:isMobile?this.state.contentOffsetLeftMobile:this.state.contentOffsetLeft,width:isMobile?this.state.contentWidthMobile:this.state.contentWidth,marginTop:this.state.contentMarginTop},ref:function(e){return _this2.content=e}},React.createElement(Renderer,{apiOptions:this.props.apiOptions,content:this.props.definition,widgets:this.props.widgets})))}}),dropShadowXOffset=0,dropShadowYOffset=1,dropShadowOpacity=.35,dropShadowRadius=4,arrowWidth=20,arrowHeight=14,backgroundColor=styleConstants.white,styles=StyleSheet.create({container:{display:"inline",position:"relative"},linkContainer:{display:"inline-block"},definitionLink:{color:styleConstants.blue,borderBottom:"dashed 1px "+styleConstants.blue,textDecoration:"none"},mobileDefinitionLink:(_mobileDefinitionLink={color:styleConstants.kaGreen,borderBottom:"dashed 1px "+styleConstants.kaGreen,textDecoration:"none"},_mobileDefinitionLink[mediaQueries.xl]={fontSize:22,lineHeight:1.4},_mobileDefinitionLink[mediaQueries.lgOrSmaller]={fontSize:20,lineHeight:1.5},_mobileDefinitionLink[mediaQueries.smOrSmaller]={fontSize:18,lineHeight:1.2},_mobileDefinitionLink),content:{background:backgroundColor,opacity:.95,borderRadius:1,position:"absolute",transition:"margin-top 0.1s",paddingLeft:styleConstants.phoneMargin,paddingRight:styleConstants.phoneMargin,zIndex:2},contentExpanded:{boxShadow:"0px 0px 4px "+styleConstants.gray85,border:"solid 0.5px "+styleConstants.gray85},contentExpandedMobile:{paddingTop:32,paddingBottom:32,boxShadow:"0px 0px 4px "+styleConstants.gray85,border:"solid 0.5px "+styleConstants.gray85},disclosureArrow:{height:arrowHeight,left:"50%",marginLeft:-arrowWidth/2,position:"absolute",width:arrowWidth,zIndex:4}});_.extend(Definition,{validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}}}),module.exports={name:"definition",displayName:"Definition",defaultAlignment:"inline",widget:Definition,transform:_.identity}},657:function(module,exports,__webpack_require__){(function($){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Interactive2=__webpack_require__(270),SvgImage=__webpack_require__(100),Util=__webpack_require__(19),ButtonGroup=__webpack_require__(658),Graphie=__webpack_require__(268),MovablePoint=Graphie.MovablePoint,MovableLine=Graphie.MovableLine,WrappedLine=__webpack_require__(101),knumber=__webpack_require__(9).number,kvector=__webpack_require__(9).vector,kpoint=__webpack_require__(9).point,KhanColors=__webpack_require__(43),containerSizeClassPropType=__webpack_require__(271).containerSizeClassPropType,interactiveSizes=__webpack_require__(20).interactiveSizes,getInteractiveBoxFromSizeClass=__webpack_require__(271).getInteractiveBoxFromSizeClass,Changeable=__webpack_require__(156),_require4=__webpack_require__(660),GrapherUtil=_require4.GrapherUtil,typeToButton=_require4.typeToButton,functionForType=_require4.functionForType,DEFAULT_GRAPHER_PROPS=_require4.DEFAULT_GRAPHER_PROPS;var typeSelectorStyle={padding:"5px 5px"},FunctionGrapher=React.createClass({displayName:"FunctionGrapher",_coords:function(props){var graph=(props=props||this.props).graph,defaultModelCoords=props.model&&GrapherUtil.maybePointsFromNormalized(props.model.defaultCoords,graph.range,graph.step,graph.snapStep);return props.coords||defaultModelCoords||null},_asymptote:function(props){return(props=props||this.props).asymptote},propTypes:_extends({},Changeable.propTypes,{flexibleType:React.PropTypes.bool,graph:React.PropTypes.any,hideHairlines:React.PropTypes.func,isMobile:React.PropTypes.bool,model:React.PropTypes.any,onChange:React.PropTypes.func,setDrawingAreaAvailable:React.PropTypes.func,showHairlines:React.PropTypes.func,showTooltips:React.PropTypes.bool,static:React.PropTypes.bool}),getDefaultProps:function(){return{graph:{range:[[-10,10],[-10,10]],step:[1,1]},coords:null,asymptote:null,isMobile:!1}},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},render:function(){var _this=this,points=_.map(this._coords(),function(coord,i){return React.createElement(MovablePoint,{key:i,coord:coord,static:_this.props.static,constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){var isFunction=_.all(_this._coords(),function(otherCoord,j){return i===j||!otherCoord||!knumber.equal(coord[0],otherCoord[0])});if(!isFunction)return!1;if(_this.props.model&&_this.props.model.extraCoordConstraint){var extraConstraint=_this.props.model.extraCoordConstraint,proposedCoords=_.clone(_this._coords()),oldCoord=_.clone(proposedCoords[i]);return proposedCoords[i]=coord,extraConstraint(coord,oldCoord,proposedCoords,_this._asymptote(),_this.props.graph)}return isFunction}],onMove:function(newCoord,oldCoord){var coords,asymptote=_this._asymptote();(coords=asymptote&&_this.props.model.allowReflectOverAsymptote&&function(newCoord,oldCoord,line){var CCW=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])};return CCW(line[0],line[1],oldCoord)>0!=CCW(line[0],line[1],newCoord)>0}(newCoord,oldCoord,asymptote)?_.map(_this._coords(),function(coord){return kpoint.reflectOverLine(coord,asymptote)}):_.clone(_this._coords()))[i]=newCoord,_this.props.onChange({coords:coords})},showHairlines:_this.props.showHairlines,hideHairlines:_this.props.hideHairlines,showTooltips:_this.props.showTooltips,isMobile:_this.props.isMobile})}),box=this.props.graph.box,imageDescription=this.props.graph.backgroundImage,image=null;if(imageDescription.url){var scale=box[0]/interactiveSizes.defaultBoxSize;image=React.createElement(SvgImage,{src:imageDescription.url,width:imageDescription.width,height:imageDescription.height,scale:scale})}return React.createElement("div",{className:"perseus-widget perseus-widget-grapher",style:{width:box[0],height:this.props.flexibleType?"auto":box[1],boxSizing:"initial"}},React.createElement("div",{className:"graphie-container above-scratchpad",style:{width:box[0],height:box[1]}},image,React.createElement(Graphie,_extends({},this.props.graph,{setDrawingAreaAvailable:this.props.setDrawingAreaAvailable}),this.props.model&&this.renderPlot(),this.props.model&&this.renderAsymptote(),this.props.model&&points)))},renderPlot:function(){var model=this.props.model,xRange=this.props.graph.range[0],style=_extends({stroke:this.props.isMobile?KhanColors.BLUE_C:KhanColors.DYNAMIC},this.props.isMobile?{"stroke-width":3}:{}),coeffs=model.getCoefficients(this._coords(),this._asymptote());if(coeffs){var functionProps=model.getPropsForCoeffs(coeffs,xRange);return React.createElement(model.Movable,_extends({},functionProps,{key:this.props.model.url,range:xRange,style:style}))}},renderAsymptote:function(){var _this2=this,model=this.props.model,graph=this.props.graph,asymptote=this._asymptote(),dashed={strokeDasharray:"- "};return asymptote&&React.createElement(MovableLine,{onMove:function(newCoord,oldCoord){var delta=kvector.subtract(newCoord,oldCoord),newAsymptote=_.map(_this2._asymptote(),function(coord){return kvector.add(coord,delta)});_this2.props.onChange({asymptote:newAsymptote})},constraints:[Interactive2.MovableLine.constraints.bound(),Interactive2.MovableLine.constraints.snap(),function(newCoord,oldCoord){var delta=kvector.subtract(newCoord,oldCoord),proposedAsymptote=_.map(_this2._asymptote(),function(coord){return kvector.add(coord,delta)});return!model.extraAsymptoteConstraint||model.extraAsymptoteConstraint(newCoord,oldCoord,_this2._coords(),proposedAsymptote,graph)}],normalStyle:dashed,highlightStyle:dashed},_.map(asymptote,function(coord,i){return React.createElement(MovablePoint,{key:"asymptoteCoord-"+i,coord:coord,static:!0,draw:null,extendLine:!0,showHairlines:_this2.props.showHairlines,hideHairlines:_this2.props.hideHairlines,showTooltips:_this2.props.showTooltips,isMobile:_this2.props.isMobile})}))}}),Grapher=React.createClass({displayName:"Grapher",propTypes:{apiOptions:React.PropTypes.any,availableTypes:React.PropTypes.arrayOf(React.PropTypes.any),containerSizeClass:containerSizeClassPropType.isRequired,graph:React.PropTypes.any,markings:React.PropTypes.string,onChange:React.PropTypes.func,plot:React.PropTypes.any,static:React.PropTypes.bool,trackInteraction:React.PropTypes.func.isRequired},getDefaultProps:function(){return DEFAULT_GRAPHER_PROPS},render:function(){var type=this.props.plot.type,coords=this.props.plot.coords,asymptote=this.props.plot.asymptote,typeSelector=React.createElement("div",{style:typeSelectorStyle,className:"above-scratchpad"},React.createElement(ButtonGroup,{value:type,allowEmpty:!0,buttons:_.map(this.props.availableTypes,typeToButton),onChange:this.handleActiveTypeChange})),box=getInteractiveBoxFromSizeClass(this.props.containerSizeClass),options=_extends({},this.props.graph,GrapherUtil.getGridAndSnapSteps(this.props.graph,box[0]),{gridConfig:this._getGridConfig(_extends({},this.props.graph,{box:box},GrapherUtil.getGridAndSnapSteps(this.props.graph,box[0])))}),grapherProps={graph:{box:box,range:options.range,step:options.step,snapStep:options.snapStep,backgroundImage:options.backgroundImage,options:options,setup:this._setupGraphie},onChange:this.handlePlotChanges,model:type&&functionForType(type),coords:coords,asymptote:asymptote,static:this.props.static,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable,isMobile:this.props.apiOptions.isMobile,showTooltips:this.props.graph.showTooltips,showHairlines:this.showHairlines,hideHairlines:this.hideHairlines};return React.createElement("div",null,React.createElement(FunctionGrapher,grapherProps),this.props.availableTypes.length>1&&typeSelector)},handlePlotChanges:function(newPlot){var plot=_.extend({},this.props.plot,newPlot);this.props.onChange({plot:plot}),this.props.trackInteraction()},handleActiveTypeChange:function(newType){var graph=this.props.graph,plot=_.extend({},this.props.plot,GrapherUtil.defaultPlotProps(newType,graph));this.props.onChange({plot:plot})},_getGridConfig:function(options){return _.map(options.step,function(step,i){return Util.gridDimensionConfig(step,options.range[i],options.box[i],options.gridStep[i])})},_calculateMobileTickStep:function(gridStep,step,ranges){var tickStep=Util.constrainedTickStepsFromTickSteps(step,ranges);return tickStep[0]=tickStep[0]/gridStep[0],tickStep[1]=tickStep[1]/gridStep[1],tickStep},_setupGraphie:function(graphie,options){var isMobile=this.props.apiOptions.isMobile;if("graph"===options.markings?(graphie.graphInit({range:options.range,scale:_.pluck(options.gridConfig,"scale"),axisArrows:"<->",labelFormat:function(s){return"\\small{"+s+"}"},gridStep:options.gridStep,snapStep:options.snapStep,tickStep:isMobile?this._calculateMobileTickStep(options.gridStep,options.step,options.range):_.pluck(options.gridConfig,"tickStep"),labelStep:1,unityLabels:_.pluck(options.gridConfig,"unityLabel"),isMobile:isMobile}),graphie.label([0,options.range[1][1]],options.labels[1],isMobile?"below right":"above"),graphie.label([options.range[0][1],0],options.labels[0],isMobile?"above left":"right")):"grid"===options.markings?graphie.graphInit({range:options.range,scale:_.pluck(options.gridConfig,"scale"),gridStep:options.gridStep,axes:!1,ticks:!1,labels:!1,isMobile:isMobile}):"none"===options.markings&&graphie.init({range:options.range,scale:_.pluck(options.gridConfig,"scale")}),this.props.apiOptions.isMobile){var hairlineStyle={normalStyle:{strokeWidth:1}};this.horizHairline=new WrappedLine(graphie,[0,0],[0,0],hairlineStyle),this.horizHairline.attr({stroke:KhanColors.INTERACTIVE}),this.horizHairline.hide(),this.vertHairline=new WrappedLine(graphie,[0,0],[0,0],hairlineStyle),this.vertHairline.attr({stroke:KhanColors.INTERACTIVE}),this.vertHairline.hide()}},showHairlines:function(point){this.props.apiOptions.isMobile&&"none"!==this.props.markings&&(this.horizHairline.moveTo([this.props.graph.range[0][0],point[1]],[this.props.graph.range[0][1],point[1]]),this.horizHairline.show(),this.vertHairline.moveTo([point[0],this.props.graph.range[1][0]],[point[0],this.props.graph.range[1][1]]),this.vertHairline.show())},hideHairlines:function(){this.props.apiOptions.isMobile&&(this.horizHairline.hide(),this.vertHairline.hide())},simpleValidate:function(rubric){return GrapherUtil.validate(this.getUserInput(),rubric)},getUserInput:function(){return this.props.plot},focus:$.noop}),propTransform=function(editorProps){var widgetProps={availableTypes:editorProps.availableTypes,graph:editorProps.graph};if(1===widgetProps.availableTypes.length){var graph=widgetProps.graph,type=GrapherUtil.chooseType(widgetProps.availableTypes);widgetProps.plot=GrapherUtil.defaultPlotProps(type,graph)}return widgetProps};module.exports={name:"grapher",displayName:"Grapher",widget:Grapher,transform:propTransform,staticTransform:function(editorProps){return _.extend({},propTransform(editorProps),{availableTypes:[editorProps.correct.type],plot:editorProps.correct})}}}).call(this,__webpack_require__(10))},658:function(module,exports,__webpack_require__){var React=__webpack_require__(0),ReactDOM=__webpack_require__(7),styles=__webpack_require__(659),css=__webpack_require__(6).css,ButtonGroup=React.createClass({displayName:"ButtonGroup",propTypes:{value:React.PropTypes.any,buttons:React.PropTypes.arrayOf(React.PropTypes.shape({value:React.PropTypes.any.isRequired,content:React.PropTypes.node,title:React.PropTypes.string})).isRequired,onChange:React.PropTypes.func.isRequired,allowEmpty:React.PropTypes.bool},getDefaultProps:function(){return{value:null,allowEmpty:!0}},focus:function(){return ReactDOM.findDOMNode(this).focus(),!0},toggleSelect:function(newValue){var value=this.props.value;this.props.allowEmpty?this.props.onChange(value!==newValue?newValue:null):this.props.onChange(newValue)},render:function(){var _this=this,value=this.props.value,buttons=this.props.buttons.map(function(button,i){return React.createElement("button",{title:button.title,type:"button",id:""+i,ref:"button"+i,key:""+i,className:css(styles.button.buttonStyle,button.value===value&&styles.button.selectedStyle),onClick:_this.toggleSelect.bind(_this,button.value)},button.content||""+button.value)});return React.createElement("div",{style:{display:"inline-block"}},buttons)}});module.exports=ButtonGroup},659:function(module,exports,__webpack_require__){var button=__webpack_require__(6).StyleSheet.create({buttonStyle:{backgroundColor:"white",border:"1px solid #ccc",borderLeft:"0",cursor:"pointer",margin:"0",padding:"5px 10px",position:"relative",":first-child":{borderLeft:"1px solid #ccc",borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"},":last-child":{borderRight:"1px solid #ccc",borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},":hover":{backgroundColor:"#ccc"},":focus":{zIndex:"2"}},selectedStyle:{backgroundColor:"#ddd"}});module.exports={button:button}},660:function(module,exports,__webpack_require__){(function(React){var _=__webpack_require__(1),Util=__webpack_require__(19),Graphie=__webpack_require__(268),Plot=Graphie.Plot,kpoint=__webpack_require__(9).point,DEFAULT_BACKGROUND_IMAGE={url:null};function canonicalSineCoefficients(coeffs){var amplitude=coeffs[0],angularFrequency=coeffs[1],phase=coeffs[2],verticalOffset=coeffs[3];amplitude<0&&(amplitude*=-1,angularFrequency*=-1,phase*=-1);var period=2*Math.PI;for(angularFrequency<0&&(angularFrequency*=-1,phase*=-1,phase+=period/2);phase>0;)phase-=period;for(;phase<0;)phase+=period;return[amplitude,angularFrequency,phase,verticalOffset]}function canonicalTangentCoefficients(coeffs){var amplitude=coeffs[0],angularFrequency=coeffs[1],phase=coeffs[2],verticalOffset=coeffs[3];amplitude<0&&(amplitude*=-1,angularFrequency*=-1,phase*=-1);var period=Math.PI;for(angularFrequency<0&&(angularFrequency*=-1,phase*=-1,phase+=period/2);phase>0;)phase-=period;for(;phase<0;)phase+=period;return[amplitude,angularFrequency,phase,verticalOffset]}var PlotDefaults={areEqual:function(coeffs1,coeffs2){return Util.deepEq(coeffs1,coeffs2)},Movable:Plot,getPropsForCoeffs:function(coeffs){return{fn:_.partial(this.getFunctionForCoeffs,coeffs)}}},Linear=_.extend({},PlotDefaults,{url:"https://ka-perseus-graphie.s3.amazonaws.com/67aaf581e6d9ef9038c10558a1f70ac21c11c9f8.png",defaultCoords:[[.25,.75],[.75,.75]],getCoefficients:function(coords){var p1=coords[0],p2=coords[1],denom=p2[0]-p1[0],num=p2[1]-p1[1];if(0!==denom){var m=num/denom;return[m,p2[1]-m*p2[0]]}},getFunctionForCoeffs:function(coeffs,x){return coeffs[0]*x+coeffs[1]},getEquationString:function(coords){var coeffs=this.getCoefficients(coords),m=coeffs[0],b=coeffs[1];return"y = "+m.toFixed(3)+"x + "+b.toFixed(3)}}),Quadratic=_.extend({},PlotDefaults,{url:"https://ka-perseus-graphie.s3.amazonaws.com/e23d36e6fc29ee37174e92c9daba2a66677128ab.png",defaultCoords:[[.5,.5],[.75,.75]],Movable:Graphie.Parabola,getCoefficients:function(coords){var p1=coords[0],p2=coords[1],h=p1[0],k=p1[1],a=(p2[1]-k)/((p2[0]-h)*(p2[0]-h));return[a,-2*h*a,a*h*h+k]},getFunctionForCoeffs:function(coeffs,x){return(coeffs[0]*x+coeffs[1])*x+coeffs[2]},getPropsForCoeffs:function(coeffs){return{a:coeffs[0],b:coeffs[1],c:coeffs[2]}},getEquationString:function(coords){var coeffs=this.getCoefficients(coords),a=coeffs[0],b=coeffs[1],c=coeffs[2];return"y = "+a.toFixed(3)+"x^2 + "+b.toFixed(3)+"x + "+c.toFixed(3)}}),Sinusoid=_.extend({},PlotDefaults,{url:"https://ka-perseus-graphie.s3.amazonaws.com/3d68e7718498475f53b206c2ab285626baf8857e.png",defaultCoords:[[.5,.5],[.6,.6]],Movable:Graphie.Sinusoid,getCoefficients:function(coords){var p1=coords[0],p2=coords[1],a=p2[1]-p1[1],b=Math.PI/(2*(p2[0]-p1[0]));return[a,b,p1[0]*b,p1[1]]},getFunctionForCoeffs:function(coeffs,x){var a=coeffs[0],b=coeffs[1],c=coeffs[2],d=coeffs[3];return a*Math.sin(b*x-c)+d},getPropsForCoeffs:function(coeffs){return{a:coeffs[0],b:coeffs[1],c:coeffs[2],d:coeffs[3]}},getEquationString:function(coords){var coeffs=this.getCoefficients(coords),a=coeffs[0],b=coeffs[1],c=coeffs[2],d=coeffs[3];return"y = "+a.toFixed(3)+" sin("+b.toFixed(3)+"x - "+c.toFixed(3)+") + "+d.toFixed(3)},areEqual:function(coeffs1,coeffs2){return Util.deepEq(canonicalSineCoefficients(coeffs1),canonicalSineCoefficients(coeffs2))}}),Tangent=_.extend({},PlotDefaults,{url:"https://ka-perseus-graphie.s3.amazonaws.com/7db80d23c35214f98659fe1cf0765811c1bbfbba.png",defaultCoords:[[.5,.5],[.75,.75]],getCoefficients:function(coords){var p1=coords[0],p2=coords[1],a=p2[1]-p1[1],b=Math.PI/(4*(p2[0]-p1[0]));return[a,b,p1[0]*b,p1[1]]},getFunctionForCoeffs:function(coeffs,x){var a=coeffs[0],b=coeffs[1],c=coeffs[2],d=coeffs[3];return a*Math.tan(b*x-c)+d},getEquationString:function(coords){var coeffs=this.getCoefficients(coords),a=coeffs[0],b=coeffs[1],c=coeffs[2],d=coeffs[3];return"y = "+a.toFixed(3)+" sin("+b.toFixed(3)+"x - "+c.toFixed(3)+") + "+d.toFixed(3)},areEqual:function(coeffs1,coeffs2){return Util.deepEq(canonicalTangentCoefficients(coeffs1),canonicalTangentCoefficients(coeffs2))}}),Exponential=_.extend({},PlotDefaults,{url:"https://ka-perseus-graphie.s3.amazonaws.com/9cbfad55525e3ce755a31a631b074670a5dad611.png",defaultCoords:[[.5,.55],[.75,.75]],defaultAsymptote:[[0,.5],[1,.5]],extraCoordConstraint:function(newCoord,oldCoord,coords,asymptote,graph){var y=_.head(asymptote)[1];return _.all(coords,function(coord){return coord[1]!==y})},extraAsymptoteConstraint:function(newCoord,oldCoord,coords,asymptote,graph){var y=newCoord[1];if(_.all(coords,function(coord){return coord[1]>y})||_.all(coords,function(coord){return coord[1]<y}))return[oldCoord[0],y];var oldY=oldCoord[1];if(_.all(coords,function(coord){return coord[1]>oldY})){var bottomMost=_.min(_.map(coords,function(coord){return coord[1]}));return[oldCoord[0],bottomMost-graph.snapStep[1]]}var topMost=_.max(_.map(coords,function(coord){return coord[1]}));return[oldCoord[0],topMost+graph.snapStep[1]]},allowReflectOverAsymptote:!0,getCoefficients:function(coords,asymptote){var p1=coords[0],p2=coords[1],c=_.head(asymptote)[1],b=Math.log((p1[1]-c)/(p2[1]-c))/(p1[0]-p2[0]);return[(p1[1]-c)/Math.exp(b*p1[0]),b,c]},getFunctionForCoeffs:function(coeffs,x){var a=coeffs[0],b=coeffs[1],c=coeffs[2];return a*Math.exp(b*x)+c},getEquationString:function(coords,asymptote){if(!asymptote)return null;var coeffs=this.getCoefficients(coords,asymptote),a=coeffs[0],b=coeffs[1],c=coeffs[2];return"y = "+a.toFixed(3)+"e^("+b.toFixed(3)+"x) + "+c.toFixed(3)}}),Logarithm=_.extend({},PlotDefaults,{url:"https://ka-perseus-graphie.s3.amazonaws.com/f6491e99d34af34d924bfe0231728ad912068dc3.png",defaultCoords:[[.55,.5],[.75,.75]],defaultAsymptote:[[.5,0],[.5,1]],extraCoordConstraint:function(newCoord,oldCoord,coords,asymptote,graph){var x=_.head(asymptote)[0];return _.all(coords,function(coord){return coord[0]!==x})&&coords[0][1]!==coords[1][1]},extraAsymptoteConstraint:function(newCoord,oldCoord,coords,asymptote,graph){var x=newCoord[0];if(_.all(coords,function(coord){return coord[0]>x})||_.all(coords,function(coord){return coord[0]<x}))return[x,oldCoord[1]];var oldX=oldCoord[0];return _.all(coords,function(coord){return coord[0]>oldX})?[_.min(_.map(coords,function(coord){return coord[0]}))-graph.snapStep[0],oldCoord[1]]:[_.max(_.map(coords,function(coord){return coord[0]}))+graph.snapStep[0],oldCoord[1]]},allowReflectOverAsymptote:!0,getCoefficients:function(coords,asymptote){var flip=function(coord){return[coord[1],coord[0]]},inverseCoeffs=Exponential.getCoefficients(_.map(coords,flip),_.map(asymptote,flip)),c=-inverseCoeffs[2]/inverseCoeffs[0],b=1/inverseCoeffs[0];return[1/inverseCoeffs[1],b,c]},getFunctionForCoeffs:function(coeffs,x,asymptote){var a=coeffs[0],b=coeffs[1],c=coeffs[2];return a*Math.log(b*x+c)},getEquationString:function(coords,asymptote){if(!asymptote)return null;var coeffs=this.getCoefficients(coords,asymptote),a=coeffs[0],b=coeffs[1],c=coeffs[2];return"y = ln("+a.toFixed(3)+"x + "+b.toFixed(3)+") + "+c.toFixed(3)}}),AbsoluteValue=_.extend({},PlotDefaults,{url:"https://ka-perseus-graphie.s3.amazonaws.com/8256a630175a0cb1d11de223d6de0266daf98721.png",defaultCoords:[[.5,.5],[.75,.75]],getCoefficients:function(coords){var p1=coords[0],p2=coords[1],denom=p2[0]-p1[0],num=p2[1]-p1[1];if(0!==denom){var m=Math.abs(num/denom);return p2[1]<p1[1]&&(m*=-1),[m,p1[0],p1[1]]}},getFunctionForCoeffs:function(coeffs,x){var m=coeffs[0],horizontalOffset=coeffs[1],verticalOffset=coeffs[2];return m*Math.abs(x-horizontalOffset)+verticalOffset},getEquationString:function(coords){var coeffs=this.getCoefficients(coords),m=coeffs[0],horizontalOffset=coeffs[1],verticalOffset=coeffs[2];return"y = "+m.toFixed(3)+"| x - "+horizontalOffset.toFixed(3)+"| + "+verticalOffset.toFixed(3)}}),functionTypeMapping={linear:Linear,quadratic:Quadratic,sinusoid:Sinusoid,tangent:Tangent,exponential:Exponential,logarithm:Logarithm,absolute_value:AbsoluteValue},allTypes=_.keys(functionTypeMapping);function functionForType(type){return functionTypeMapping[type]}var GrapherUtil={validate:function(state,rubric){if(state.type!==rubric.correct.type)return{type:"points",earned:0,total:1,message:null};if(null==state.coords)return{type:"invalid",message:null};var grader=functionForType(state.type),guessCoeffs=grader.getCoefficients(state.coords,state.asymptote),correctCoeffs=grader.getCoefficients(rubric.correct.coords,rubric.correct.asymptote);return null==guessCoeffs||null==correctCoeffs?{type:"invalid",message:null}:grader.areEqual(guessCoeffs,correctCoeffs)?{type:"points",earned:1,total:1,message:null}:{type:"points",earned:0,total:1,message:null}},getEquationString:function(props){var plot=props.plot;return plot.type&&plot.coords&&functionForType(plot.type).getEquationString(plot.coords,plot.asymptote)||""},pointsFromNormalized:function(coordsList,range,step,snapStep){return _.map(coordsList,function(coords){var unsnappedPoint=_.map(coords,function(coord,i){var currRange=range[i],currStep=step[i],nSteps=function(range,step){return Math.floor((range[1]-range[0])/step)}(currRange,currStep),tick=Math.round(coord*nSteps);return currRange[0]+currStep*tick});return kpoint.roundTo(unsnappedPoint,snapStep)})},maybePointsFromNormalized:function(coordsList,range,step,snapStep){return coordsList?this.pointsFromNormalized(coordsList,range,step,snapStep):coordsList},defaultPlotProps:function(type,graph){var model=functionForType(type),snapStep=Util.snapStepFromGridStep([1,1]);return{type:type,asymptote:this.maybePointsFromNormalized(model.defaultAsymptote,graph.range,graph.step,snapStep),coords:null}},chooseType:_.first,getGridAndSnapSteps:function(options,boxSize){var gridStep=options.gridStep||Util.getGridStep(options.range,options.step,boxSize);return{gridStep:gridStep,snapStep:options.snapStep||Util.snapStepFromGridStep(gridStep)}}},DEFAULT_GRAPHER_PROPS={};DEFAULT_GRAPHER_PROPS.graph={labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],backgroundImage:DEFAULT_BACKGROUND_IMAGE,markings:"graph",rulerLabel:"",rulerTicks:10,valid:!0,showTooltips:!1},DEFAULT_GRAPHER_PROPS.plot=GrapherUtil.defaultPlotProps("linear",DEFAULT_GRAPHER_PROPS.graph),DEFAULT_GRAPHER_PROPS.availableTypes=[DEFAULT_GRAPHER_PROPS.plot.type],module.exports={GrapherUtil:GrapherUtil,allTypes:allTypes,typeToButton:function(type){var capitalized=type.charAt(0).toUpperCase()+type.substring(1);return{value:type,title:capitalized,content:React.createElement("img",{src:functionForType(type).url,alt:capitalized})}},functionForType:functionForType,DEFAULT_GRAPHER_PROPS:DEFAULT_GRAPHER_PROPS,DEFAULT_BACKGROUND_IMAGE:DEFAULT_BACKGROUND_IMAGE}}).call(this,__webpack_require__(0))},661:function(module,exports,__webpack_require__){(function(i18n){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),ApiOptions=__webpack_require__(13).Options,InlineIcon=__webpack_require__(58),_require=__webpack_require__(72),iconStar=_require.iconStar,iconTryAgain=_require.iconTryAgain,_require2=__webpack_require__(20),boldFontFamily=_require2.boldFontFamily,gray68=_require2.gray68,gray76=_require2.gray76,gray85=_require2.gray85,gray95=_require2.gray95,kaGreen=_require2.kaGreen,phoneMargin=_require2.phoneMargin,negativePhoneMargin=_require2.negativePhoneMargin,ANSWER_BAR_STATES={HIDDEN:Symbol("HIDDEN"),ACTIVE:Symbol("ACTIVE"),INACTIVE:Symbol("INACTIVE"),INCORRECT:Symbol("INCORRECT"),CORRECT:Symbol("CORRECT")},GradedGroupAnswerBar=React.createClass({displayName:"GradedGroupAnswerBar",propTypes:{answerBarState:React.PropTypes.any.isRequired,apiOptions:ApiOptions.propTypes,onCheckAnswer:React.PropTypes.func.isRequired,onNextQuestion:React.PropTypes.func},render:function(){var _props=this.props,apiOptions=_props.apiOptions,answerBarState=_props.answerBarState,onCheckAnswer=_props.onCheckAnswer,onNextQuestion=_props.onNextQuestion,answerBarStyle=_extends({},styles.answerBar,{backgroundColor:answerBarState===ANSWER_BAR_STATES.CORRECT?gray95:"white",justifyContent:answerBarState!==ANSWER_BAR_STATES.CORRECT||onNextQuestion?"space-between":"center"}),buttonStyle=_extends({},styles.button,{backgroundColor:answerBarState===ANSWER_BAR_STATES.ACTIVE||answerBarState===ANSWER_BAR_STATES.CORRECT?kaGreen:gray85}),textStyle=_extends({},styles.text,{color:answerBarState===ANSWER_BAR_STATES.CORRECT?kaGreen:gray68}),message=answerBarState===ANSWER_BAR_STATES.INCORRECT?React.createElement("span",{style:textStyle},React.createElement("span",{style:styles.tryAgainIcon},React.createElement(InlineIcon,iconTryAgain)),React.createElement("span",{style:{marginLeft:8}},i18n._("Keep trying"))):React.createElement("span",null);if(answerBarState!==ANSWER_BAR_STATES.CORRECT){var buttonLabel=answerBarState===ANSWER_BAR_STATES.INCORRECT?i18n._("Try again"):i18n._("Check");return React.createElement("div",{style:answerBarStyle},message,React.createElement("button",{style:buttonStyle,disabled:apiOptions.readOnly||answerBarState!==ANSWER_BAR_STATES.ACTIVE,onClick:onCheckAnswer},buttonLabel))}return React.createElement("div",{style:answerBarStyle},React.createElement("span",{style:textStyle},React.createElement("span",{style:{fontSize:28,color:"#FFB300"}},React.createElement(InlineIcon,_extends({},iconStar,{style:{marginBottom:5}}))),React.createElement("span",{style:{marginLeft:8}},i18n._("Correct!"))),onNextQuestion&&React.createElement("button",{style:buttonStyle,onClick:onNextQuestion},i18n._("Next question")))}}),styles={answerBar:{display:"flex",alignItems:"center",height:68,marginLeft:negativePhoneMargin,marginRight:negativePhoneMargin,marginBottom:negativePhoneMargin,marginTop:phoneMargin,paddingLeft:phoneMargin,paddingRight:10,borderTop:"1px solid "+gray76},button:{height:48,width:143,borderRadius:4,color:"white",fontFamily:boldFontFamily,fontSize:17,border:"none"},tryAgainIcon:{fontSize:28,color:"#63D9EA",transform:"scale(-1,1) rotate(-268deg)"},text:{display:"flex",flexDirection:"row",alignItems:"center",fontFamily:boldFontFamily,fontSize:17}};GradedGroupAnswerBar.ANSWER_BAR_STATES=ANSWER_BAR_STATES,module.exports=GradedGroupAnswerBar}).call(this,__webpack_require__(21))},662:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_require=(__webpack_require__(1),__webpack_require__(6)),StyleSheet=_require.StyleSheet,css=_require.css,ApiOptions=__webpack_require__(13).Options,Changeable=__webpack_require__(156),GradedGroup=__webpack_require__(644).widget,_require2=__webpack_require__(20),grayLight=_require2.grayLight,gray76=_require2.gray76,tableBackgroundAccent=_require2.tableBackgroundAccent,kaGreen=_require2.kaGreen,phoneMargin=_require2.phoneMargin,negativePhoneMargin=_require2.negativePhoneMargin,_require3=__webpack_require__(25),linterContextProps=_require3.linterContextProps,linterContextDefault=_require3.linterContextDefault,Indicators=React.createClass({displayName:"Indicators",propTypes:{currentGroup:React.PropTypes.number.isRequired,numGroups:React.PropTypes.number.isRequired,onChangeCurrentGroup:React.PropTypes.func.isRequired},render:function(){for(var _this=this,items=[],_loop=function(i){items.push(React.createElement("div",{key:i,className:css(styles.indicator,i===_this.props.currentGroup&&styles.selectedIndicator),onClick:function(){return _this.props.onChangeCurrentGroup(i)}}))},i=0;i<this.props.numGroups;i++)_loop(i);return React.createElement("div",{className:css(styles.indicatorContainer)},items)}}),GradedGroupSet=React.createClass({displayName:"GradedGroupSet",propTypes:_extends({},Changeable.propTypes,{apiOptions:ApiOptions.propTypes,gradedGroups:React.PropTypes.array,trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps}),getDefaultProps:function(){return{gradedGroups:[],linterContext:linterContextDefault}},getInitialState:function(){return{currentGroup:0}},shouldComponentUpdate:function(nextProps,nextState){return nextProps!==this.props||nextState!==this.state},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},getInputPaths:function(){return this._childGroup.getInputPaths()},setInputValue:function(path,newValue,cb){return this._childGroup.setInputValue(path,newValue,cb)},getAcceptableFormatsForInputPath:function(path){return this._childGroup.getAcceptableFormatsForInputPath(path)},focus:function(){return this._childGroup.focus()},focusInputPath:function(path){this._childGroup.focusInputPath(path)},blurInputPath:function(path){this._childGroup.blurInputPath(path)},handleNextQuestion:function(){var currentGroup=this.state.currentGroup;currentGroup<this.props.gradedGroups.length-1&&this.setState({currentGroup:currentGroup+1})},render:function(){var _this2=this,currentGroup=this.props.gradedGroups[this.state.currentGroup];if(!currentGroup)return React.createElement("span",null,"No current group...");var numGroups=this.props.gradedGroups.length,handleNextQuestion=this.state.currentGroup<numGroups-1?this.handleNextQuestion:null;return React.createElement("div",{className:css(styles.container)},React.createElement("div",{className:css(styles.top)},React.createElement("div",{className:css(styles.title)},currentGroup.title),React.createElement("div",{className:css(styles.spacer)}),React.createElement(Indicators,{numGroups:numGroups,currentGroup:this.state.currentGroup,onChangeCurrentGroup:function(currentGroup){return _this2.setState({currentGroup:currentGroup})}})),React.createElement(GradedGroup,_extends({key:this.state.currentGroup,ref:function(comp){return _this2._childGroup=comp}},this.props,currentGroup,{inGradedGroupSet:!0,title:null,onNextQuestion:handleNextQuestion,linterContext:this.props.linterContext})))}});module.exports={name:"graded-group-set",displayName:"Graded group set (articles only)",widget:GradedGroupSet,traverseChildWidgets:function(props,traverseRenderer){return{groups:props.gradedGroups.map(traverseRenderer)}},hidden:!1,tracking:"all",isLintable:!0};var styles=StyleSheet.create({top:{display:"flex",flexDirection:"row"},spacer:{flex:1},title:{fontSize:12,color:gray76,textTransform:"uppercase",marginBottom:11,letterSpacing:.8},indicatorContainer:{display:"flex",flexDirection:"row"},indicator:{width:10,height:10,borderRadius:5,backgroundColor:grayLight,marginLeft:5,cursor:"pointer"},selectedIndicator:{backgroundColor:kaGreen},container:{borderTop:"1px solid "+gray76,borderBottom:"1px solid "+gray76,backgroundColor:tableBackgroundAccent,marginLeft:negativePhoneMargin,marginRight:negativePhoneMargin,paddingBottom:phoneMargin,paddingLeft:phoneMargin,paddingRight:phoneMargin,paddingTop:10,width:"auto"}})},663:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},classNames=__webpack_require__(22),React=__webpack_require__(0),_=__webpack_require__(1),ApiOptions=__webpack_require__(13).Options,Changeable=__webpack_require__(156),Renderer=__webpack_require__(33),_require=__webpack_require__(25),linterContextProps=_require.linterContextProps,linterContextDefault=_require.linterContextDefault,Group=React.createClass({displayName:"Group",propTypes:_extends({},Changeable.propTypes,{content:React.PropTypes.string,widgets:React.PropTypes.object,images:React.PropTypes.object,icon:React.PropTypes.object,reviewModeRubric:React.PropTypes.object,linterContext:linterContextProps}),getDefaultProps:function(){return{content:"",widgets:{},images:{},icon:null,linterContext:linterContextDefault}},componentDidMount:function(){this.forceUpdate()},render:function(){var _this=this,apiOptions=_.extend({},ApiOptions.defaults,this.props.apiOptions,{onFocusChange:function(newFocus,oldFocus){oldFocus&&_this.props.onBlur(oldFocus),newFocus&&_this.props.onFocus(newFocus)}}),number=_.indexOf(this.props.findWidgets("group"),this),problemNumComponent=this.props.apiOptions.groupAnnotator(number,this.props.widgetId),score=this.refs.renderer&&this.refs.renderer.score(),isValid=score&&"invalid"!==score.type,isInvalid=score&&"invalid"===score.type;return React.createElement("div",{className:classNames({"perseus-group":!0,"perseus-group-valid-answer":isValid,"perseus-group-invalid-answer":isInvalid})},problemNumComponent,React.createElement(Renderer,_extends({},this.props,{ref:"renderer",apiOptions:apiOptions,findExternalWidgets:this.props.findWidgets,reviewMode:!!this.props.reviewModeRubric,onInteractWithWidget:function(id){_this.refs.renderer&&_this.change("widgets",_this.refs.renderer.props.widgets)},linterContext:this.props.linterContext})),this.props.icon&&React.createElement("div",{className:"group-icon"},this.props.icon))},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},getUserInput:function(){return this.refs.renderer.getUserInput()},getSerializedState:function(){return this.refs.renderer.getSerializedState()},restoreSerializedState:function(state,callback){return this.refs.renderer.restoreSerializedState(state,callback),null},simpleValidate:function(rubric){return this.refs.renderer.score()},getInputPaths:function(){return this.refs.renderer.getInputPaths()},setInputValue:function(path,newValue,cb){return this.refs.renderer.setInputValue(path,newValue,cb)},getAcceptableFormatsForInputPath:function(path){return this.refs.renderer.getAcceptableFormatsForInputPath(path)},getRenderer:function(){return this.refs.renderer},focus:function(){return this.refs.renderer.focus()},focusInputPath:function(path){this.refs.renderer.focusPath(path)},blurInputPath:function(path){this.refs.renderer.blurPath(path)},showRationalesForCurrentlySelectedChoices:function(){this.refs.renderer.showRationalesForCurrentlySelectedChoices()}});module.exports={name:"group",displayName:"Group (SAT only)",widget:Group,traverseChildWidgets:function(props,traverseRenderer){return _.extend({},props,traverseRenderer(props))},hidden:!1,isLintable:!0}},664:function(module,exports,__webpack_require__){(function($){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),WidgetJsonifyDeprecated=__webpack_require__(269),updateQueryString=__webpack_require__(19).updateQueryString,Iframe=React.createClass({displayName:"Iframe",propTypes:_extends({},Changeable.propTypes,{width:React.PropTypes.string,height:React.PropTypes.string,url:React.PropTypes.string,settings:React.PropTypes.array,status:React.PropTypes.oneOf(["incomplete","incorrect","correct"]),message:React.PropTypes.string,allowFullScreen:React.PropTypes.bool,allowTopNavigation:React.PropTypes.bool}),getDefaultProps:function(){return{status:"incomplete",message:null,allowFullScreen:!1,allowTopNavigation:!1}},getUserInput:function(){return WidgetJsonifyDeprecated.getUserInput.call(this)},handleMessageEvent:function(e){var data={};try{data=JSON.parse(e.originalEvent.data)}catch(err){return}if(!_.isUndefined(data.testsPassed)){var status=data.testsPassed?"correct":"incorrect";this.change({status:status,message:data.message})}},componentDidMount:function(){$(window).on("message",this.handleMessageEvent)},componentWillUnmount:function(){$(window).off("message",this.handleMessageEvent)},render:function(){var style={width:this.props.width,height:this.props.height},url=this.props.url;if(url&&url.length&&0!==url.indexOf("http")&&(url=updateQueryString(url="https://www.khanacademy.org/computer-programming/program/"+url+"/embedded?buttons=no&embed=yes&editor=no&author=no","width",this.props.width),url=updateQueryString(url,"height",this.props.height),url=updateQueryString(url,"origin",window.location.origin)),"undefined"!=typeof KA&&KA.isZeroRated&&(url.match(/https?:\/\/[^\/]*khanacademy.org/)?url.match(/zero.khanacademy.org/)||(url=url.replace("khanacademy.org","zero.khanacademy.org")):url="/zero/external-link?context=iframe&url="+encodeURIComponent(url)),this.props.settings){var settings={};_.each(this.props.settings,function(setting){setting.name&&setting.value&&(settings[setting.name]=setting.value)}),url=updateQueryString(url,"settings",JSON.stringify(settings))}return" allow-top-navigation",React.createElement("iframe",{sandbox:"allow-same-origin allow-scripts allow-top-navigation",style:style,src:url,allowFullScreen:this.props.allowFullScreen})},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},simpleValidate:function(rubric){return Iframe.validate(this.getUserInput(),rubric)}});_.extend(Iframe,{validate:function(state,rubric){return"correct"===state.status?{type:"points",earned:1,total:1,message:state.message||null}:"incorrect"===state.status?{type:"points",earned:0,total:1,message:state.message||null}:{type:"invalid",message:"Keep going, you're not there yet!"}}}),module.exports={name:"iframe",displayName:"Iframe",widget:Iframe,hidden:!0}}).call(this,__webpack_require__(10))},665:function(module,exports,__webpack_require__){(function($){var _caption,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},classNames=__webpack_require__(22),_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,React=__webpack_require__(0),_=__webpack_require__(1),ApiOptions=__webpack_require__(13).Options,baseUnitPx=__webpack_require__(20).baseUnitPx,Changeable=__webpack_require__(156),mediaQueries=__webpack_require__(59),Renderer=__webpack_require__(33),SvgImage=__webpack_require__(100),_require3=__webpack_require__(25),linterContextProps=_require3.linterContextProps,linterContextDefault=_require3.linterContextDefault,defaultRange=[0,10],defaultBackgroundImage={url:null,width:0,height:0},ImageWidget=React.createClass({displayName:"ImageWidget",propTypes:_extends({},Changeable.propTypes,{alignment:React.PropTypes.oneOf(["block","float-left","float-right","full-width"]),alt:React.PropTypes.string,apiOptions:ApiOptions.propTypes,backgroundImage:React.PropTypes.shape({url:React.PropTypes.string,width:React.PropTypes.number,height:React.PropTypes.number}),box:React.PropTypes.arrayOf(React.PropTypes.number),caption:React.PropTypes.string,labels:React.PropTypes.arrayOf(React.PropTypes.shape({content:React.PropTypes.string,coordinates:React.PropTypes.arrayOf(React.PropTypes.number),alignment:React.PropTypes.string})),range:React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.number)),title:React.PropTypes.string,trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps}),statics:{styles:StyleSheet.create({caption:(_caption={display:"inline-block",marginTop:baseUnitPx,maxWidth:640},_caption[mediaQueries.lgOrSmaller]={maxWidth:540},_caption[mediaQueries.smOrSmaller]={maxWidth:450},_caption)})},getDefaultProps:function(){return{alignment:"block",title:"",range:[defaultRange,defaultRange],box:[400,400],backgroundImage:defaultBackgroundImage,labels:[],alt:"",caption:"",linterContext:linterContextDefault}},render:function(){var image,alt,title,caption,apiOptions=this.props.apiOptions,backgroundImage=this.props.backgroundImage;if(backgroundImage.url&&(image=React.createElement(SvgImage,{src:backgroundImage.url,alt:this.props.alt?"":void 0,width:backgroundImage.width,height:backgroundImage.height,preloader:apiOptions.imagePreloader,extraGraphie:{box:this.props.box,range:this.props.range,labels:this.props.labels},trackInteraction:this.props.trackInteraction,zoomToFullSizeOnMobile:apiOptions.isMobile,constrainHeight:apiOptions.isMobile,allowFullBleed:apiOptions.isMobile})),this.props.alt&&(alt=React.createElement("span",{className:"perseus-sr-only"},React.createElement(Renderer,{content:this.props.alt,apiOptions:apiOptions,linterContext:this.props.linterContext}))),apiOptions.isMobile){var titleAndCaption;if(this.props.title||this.props.caption){var _title=this.props.title;_title&&(this.props.caption&&!/[.?!"']\s*$/.test(_title)&&(_title+="."),_title="**"+_title+"** ");var className=classNames({"perseus-image-caption":!0,"has-title":!!_title}),alignment=this.props.alignment,minWidth="block"===alignment||"full-width"===alignment?null:"0 !important";titleAndCaption=React.createElement("div",{className:className},React.createElement("div",{className:css(ImageWidget.styles.caption),style:{minWidth:minWidth}},React.createElement(Renderer,{content:_title+this.props.caption,apiOptions:apiOptions,linterContext:this.props.linterContext})))}return React.createElement("div",{className:"perseus-image-widget"},image,alt,titleAndCaption)}return this.props.title&&(title=React.createElement("div",{className:"perseus-image-title"},React.createElement(Renderer,{content:this.props.title,apiOptions:apiOptions,linterContext:this.props.linterContext}))),this.props.caption&&(caption=React.createElement("div",{className:"perseus-image-caption"},React.createElement(Renderer,{content:this.props.caption,apiOptions:apiOptions,linterContext:this.props.linterContext}))),React.createElement("div",{className:"perseus-image-widget"},title,image,alt,caption)},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},getUserInput:function(){return null},simpleValidate:function(rubric){return ImageWidget.validate(this.getUserInput(),rubric)},focus:$.noop});_.extend(ImageWidget,{validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}}}),module.exports={name:"image",accessible:function(props){var bgImage=props.backgroundImage;return!(bgImage&&bgImage.url&&!props.alt)},defaultAlignment:"block",supportedAlignments:["block","full-width"],displayName:"Image",widget:ImageWidget,isLintable:!0}}).call(this,__webpack_require__(10))},666:function(module,exports,__webpack_require__){(function(KAS){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),Graphie=__webpack_require__(268),Label=Graphie.Label,Line=Graphie.Line,MovablePoint=Graphie.MovablePoint,MovableLine=Graphie.MovableLine,Plot=Graphie.Plot,PlotParametric=Graphie.PlotParametric,Point=Graphie.Point,Rect=Graphie.Rect,kvector=__webpack_require__(9).vector,KAShashFunc=function(expr,options){for(var result=expr+"||"+(options=options||{}).decimal_separatpr+"||",functions=options.functions,functionsLength=functions?functions.length:0,i=0;i<functionsLength;i++)result+=functions[i]+"|";return result},_parseCache=Object.create(null),KASparse=function(expr,options){var hash=KAShashFunc(expr,options),cached=_parseCache[hash];return cached||(cached=KAS.parse(expr,options),_parseCache[hash]=cached,cached)},_compileCache=Object.create(null),KAScompile=function(expr,options){var hash=KAShashFunc(expr,options),cached=_compileCache[hash];if(cached)return cached;var parsed=KAS.parse(expr,options).expr;return cached=parsed?parsed.compile():function(){return 0},_compileCache[hash]=cached,cached},defaultInteractionProps={graph:{box:[400,400],labels:["x","y"],range:[[-10,10],[-10,10]],tickStep:[1,1],gridStep:[1,1],markings:"graph"},elements:[]},Interaction=React.createClass({displayName:"Interaction",propTypes:_extends({},Changeable.propTypes,{graph:React.PropTypes.object,elements:React.PropTypes.arrayOf(React.PropTypes.object)}),getDefaultProps:function(){return defaultInteractionProps},getInitialState:function(){return{variables:this._getInitialVariables(this.props.elements),functions:this._getInitialFunctions(this.props.elements)}},_getInitialVariables:function(elements){var variables={};return _.each(_.where(elements,{type:"movable-point"}),function(element){var subscript=element.options.varSubscript,startXExpr=KASparse(element.options.startX||"0").expr,startYExpr=KASparse(element.options.startY||"0").expr,startX=0,startY=0;startXExpr&&(startX=startXExpr.eval({})||0),startYExpr&&(startY=startYExpr.eval({})||0),variables["x_"+subscript]=startX,variables["y_"+subscript]=startY},this),_.each(_.where(elements,{type:"movable-line"}),function(element){var startSubscript=element.options.startSubscript,endSubscript=element.options.endSubscript,startXExpr=KASparse(element.options.startX||"0").expr,startYExpr=KASparse(element.options.startY||"0").expr,endXExpr=KASparse(element.options.endX||"0").expr,endYExpr=KASparse(element.options.endY||"0").expr,startX=0,startY=0,endX=0,endY=0;startXExpr&&(startX=startXExpr.eval({})||0),startYExpr&&(startY=startYExpr.eval({})||0),endXExpr&&(endX=endXExpr.eval({})||0),endYExpr&&(endY=endYExpr.eval({})||0),variables["x_"+startSubscript]=startX,variables["y_"+startSubscript]=startY,variables["x_"+endSubscript]=endX,variables["y_"+endSubscript]=endY},this),_.each(_.where(elements,{type:"function"}),function(element){variables[element.options.funcName]=element.options.value}),variables},_getInitialFunctions:function(elements){return _.map(_.where(elements,{type:"function"}),function(element){return element.options.funcName})},componentWillReceiveProps:function(nextProps){this.setState({variables:this._getInitialVariables(nextProps.elements),functions:this._getInitialFunctions(nextProps.elements)})},_setupGraphie:function(graphie,options){if(graphie.graphInit(_.extend({},options,{grid:_.contains(["graph","grid"],this.props.graph.markings),axes:_.contains(["graph"],this.props.graph.markings),ticks:_.contains(["graph"],this.props.graph.markings),labels:_.contains(["graph"],this.props.graph.markings),labelFormat:function(s){return"\\small{"+s+"}"},axisArrows:"<->",unityLabels:!1})),"graph"===this.props.graph.markings){var labels=this.props.graph.labels,range=this.props.graph.range;graphie.label([0,range[1][1]],labels[1],"above"),graphie.label([range[0][1],0],labels[0],"right")}},_updatePointLocation:function(subscript,coord){var variables=_.clone(this.state.variables);variables["x_"+subscript]=coord[0],variables["y_"+subscript]=coord[1],this.setState({variables:variables}),this.props.trackInteraction()},_updateLineLocation:function(options,startCoord){var xDiff=this._eval("("+options.endX+")-("+options.startX+")"),yDiff=this._eval("("+options.endY+")-("+options.startY+")"),endCoord=kvector.add(startCoord,[xDiff,yDiff]),variables=_.clone(this.state.variables);variables["x_"+options.startSubscript]=startCoord[0],variables["y_"+options.startSubscript]=startCoord[1],variables["x_"+options.endSubscript]=endCoord[0],variables["y_"+options.endSubscript]=endCoord[1],this.setState({variables:variables}),this.props.trackInteraction()},_eval:function(expression,variables){var _this=this,func=KAScompile(expression,{functions:this.state.functions}),compiledVars=_.extend({},this.state.variables,variables);return _.each(_.keys(compiledVars),function(name){if(_.isString(compiledVars[name])){var func=KAScompile(compiledVars[name],{functions:_this.state.functions});compiledVars[name]=function(x){return func(_.extend({},compiledVars,{x:x}))}}}),func(compiledVars)||0},_extractVars:function(expr){if(null==expr)return[];var vars=[];return _.each(expr.args(),function(arg){arg&&"Expr"===arg.constructor.name&&(vars=vars.concat(this._extractVars(arg)))},this),"Var"===expr.name()&&vars.push(expr.prettyPrint()),vars},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},render:function(){return React.createElement(Graphie,{box:this.props.graph.box,range:this.props.graph.range,options:this.props.graph,setup:this._setupGraphie,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable},_.map(this.props.elements,function(element,n){var _this2=this;if("point"===element.type)return React.createElement(Point,{key:element.key,coord:[this._eval(element.options.coordX),this._eval(element.options.coordY)],color:element.options.color});if("line"===element.type){var start=[this._eval(element.options.startX),this._eval(element.options.startY)],end=[this._eval(element.options.endX),this._eval(element.options.endY)];return React.createElement(Line,{key:element.key,start:start,end:end,style:{stroke:element.options.color,strokeWidth:element.options.strokeWidth,strokeDasharray:element.options.strokeDasharray,arrows:element.options.arrows}})}if("movable-point"===element.type){var constraints=[function(coord){return[Math.max(_this2._eval(element.options.constraintXMin),Math.min(_this2._eval(element.options.constraintXMax),coord[0])),Math.max(_this2._eval(element.options.constraintYMin),Math.min(_this2._eval(element.options.constraintYMax),coord[1]))]}];return"snap"===element.options.constraint?constraints.push(MovablePoint.constraints.snap(element.options.snap)):"x"===element.options.constraint?constraints.push(function(coord){return[_this2._eval(element.options.constraintFn,{y:coord[1]}),coord[1]]}):"y"===element.options.constraint&&constraints.push(function(coord){return[coord[0],_this2._eval(element.options.constraintFn,{x:coord[0]})]}),React.createElement(MovablePoint,{key:element.key,coord:[this.state.variables["x_"+element.options.varSubscript],this.state.variables["y_"+element.options.varSubscript]],constraints:constraints,foo_x:element.options.constraint,foo_y:element.options.constraintFn,foo_z:element.options.snap,onMove:_.partial(this._updatePointLocation,element.options.varSubscript)})}if("movable-line"===element.type){constraints=[function(coord){return[Math.max(_this2._eval(element.options.constraintXMin),Math.min(_this2._eval(element.options.constraintXMax),coord[0])),Math.max(_this2._eval(element.options.constraintYMin),Math.min(_this2._eval(element.options.constraintYMax),coord[1]))]}];"snap"===element.options.constraint?constraints.push(MovablePoint.constraints.snap(element.options.snap)):"x"===element.options.constraint?constraints.push(function(coord){return[_this2._eval(element.options.constraintFn,{y:coord[1]}),coord[1]]}):"y"===element.options.constraint&&constraints.push(function(coord){return[coord[0],_this2._eval(element.options.constraintFn,{x:coord[0]})]});start=[this.state.variables["x_"+element.options.startSubscript],this.state.variables["y_"+element.options.startSubscript]],end=[this.state.variables["x_"+element.options.endSubscript],this.state.variables["y_"+element.options.endSubscript]];return React.createElement(MovableLine,{key:element.key,constraints:constraints,onMove:_.bind(this._updateLineLocation,this,element.options),foo_x:element.options.constraint,foo_y:element.options.constraintFn,foo_z:element.options.snap},React.createElement(MovablePoint,{coord:start,static:!0,normalStyle:{stroke:"none",fill:"none"}}),React.createElement(MovablePoint,{coord:end,static:!0,normalStyle:{stroke:"none",fill:"none"}}))}if("function"===element.type){var fn=function(x){return _this2._eval(element.options.value,{x:x})},vars=_.without(this._extractVars(KASparse(element.options.value).expr),"x"),varValues=_.object(vars,_.map(vars,function(v){return _this2.state.variables[v]})),range=[this._eval(element.options.rangeMin,this.state.variables),this._eval(element.options.rangeMax,this.state.variables)];return React.createElement(Plot,{key:element.key,fn:fn,foo_fn:element.options.value,foo_varvalues:varValues,range:range,style:{stroke:element.options.color,strokeWidth:element.options.strokeWidth,strokeDasharray:element.options.strokeDasharray,plotPoints:100}})}if("parametric"===element.type){fn=function(t){return[_this2._eval(element.options.x,{t:t}),_this2._eval(element.options.y,{t:t})]},vars=_.without(this._extractVars(KASparse(element.options.x).expr).concat(this._extractVars(KASparse(element.options.y).expr)),"t"),varValues=_.object(vars,_.map(vars,function(v){return _this2.state.variables[v]})),range=[this._eval(element.options.rangeMin,this.state.variables),this._eval(element.options.rangeMax,this.state.variables)];return React.createElement(PlotParametric,{key:element.key,fn:fn,foo_fnx:element.options.x,foo_fny:element.options.y,foo_varvalues:varValues,range:range,style:{stroke:element.options.color,strokeWidth:element.options.strokeWidth,strokeDasharray:element.options.strokeDasharray,plotPoints:100}})}if("label"===element.type){var coord=[this._eval(element.options.coordX),this._eval(element.options.coordY)];return React.createElement(Label,{key:n+1,coord:coord,text:element.options.label,style:{color:element.options.color}})}return"rectangle"===element.type?React.createElement(Rect,{key:n+1,x:this._eval(element.options.coordX),y:this._eval(element.options.coordY),width:_.max([this._eval(element.options.width),0]),height:_.max([this._eval(element.options.height),0]),style:{stroke:"none",fill:element.options.color}}):void 0},this))},getUserInput:function(){return{}},simpleValidate:function(rubric){return Interaction.validate(this.getUserInput(),rubric)}});_.extend(Interaction,{validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}}}),module.exports={name:"interaction",displayName:"Interaction",widget:Interaction,transform:_.identity,hidden:!0}}).call(this,__webpack_require__(159))},667:function(module,exports,__webpack_require__){(function(i18n,$){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Graph=__webpack_require__(645),InfoTip=__webpack_require__(646),Interactive2=__webpack_require__(270),NumberInput=__webpack_require__(642),Util=__webpack_require__(19),knumber=__webpack_require__(9).number,kpoint=__webpack_require__(9).point,KhanColors=__webpack_require__(43),GraphUtils=__webpack_require__(157),_require2=(__webpack_require__(20).interactiveSizes,__webpack_require__(271)),containerSizeClassPropType=_require2.containerSizeClassPropType,getInteractiveBoxFromSizeClass=_require2.getInteractiveBoxFromSizeClass,WrappedLine=__webpack_require__(101),DeprecationMixin=Util.DeprecationMixin,defaultBackgroundImage={url:null},eq=Util.eq,deepEq=Util.deepEq;function ccw(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])}function collinear(a,b,c){return eq(ccw(a,b,c),0)}function sign(val){return eq(val,0)?0:val>0?1:-1}function defaultVal(actual,defaultValue){return null==actual?defaultValue:actual}function pointInRect(a,b,c){return c[0]<=Math.max(a[0],b[0])&&c[0]>=Math.min(a[0],b[0])&&c[1]<=Math.max(a[1],b[1])&&c[1]>=Math.min(a[1],b[1])}function intersects(ab,cd){var triplets=[[ab[0],ab[1],cd[0]],[ab[0],ab[1],cd[1]],[cd[0],cd[1],ab[0]],[cd[0],cd[1],ab[1]]],orientations=_.map(triplets,function(triplet){return sign(ccw.apply(null,triplet))});if(orientations[0]!==orientations[1]&&orientations[2]!==orientations[3])return!0;for(var i=0;i<4;i++)if(0===orientations[i]&&pointInRect.apply(null,triplets[i]))return!0;return!1}function vector(a,b){return _.map(_.zip(a,b),function(pair){return pair[0]-pair[1]})}function magnitude(v){return Math.sqrt(_.reduce(v,function(memo,el){return memo+Math.pow(el,2)},0))}function sideLengths(coords){var segments=_.zip(coords,rotate(coords));return _.map(segments,function(segment){return magnitude(vector.apply(null,segment))})}function angleMeasures(coords){var triplets=_.zip(rotate(coords,-1),coords,rotate(coords,1)),offsets=_.map(triplets,function(triplet){var a,b,p=vector(triplet[1],triplet[0]),q=vector(triplet[2],triplet[1]),raw=Math.acos((a=p,b=q,_.reduce(_.zip(a,b),function(memo,pair){return memo+pair[0]*pair[1]},0)/(magnitude(p)*magnitude(q))));return sign(ccw.apply(null,triplet))>0?raw:-raw}),sum=_.reduce(offsets,function(memo,arg){return memo+arg},0);return _.map(offsets,function(offset){return sum>0?Math.PI-offset:Math.PI+offset})}function similar(coords1,coords2,tolerance){if(coords1.length!==coords2.length)return!1;for(var n=coords1.length,angles1=angleMeasures(coords1),angles2=angleMeasures(coords2),sides1=sideLengths(coords1),sides2=sideLengths(coords2),i=0;i<2*n;i++){var angles=angles2.slice(),sides=sides2.slice();if(i>=n&&(angles.reverse(),sides.reverse(),sides=rotate(sides,1)),angles=rotate(angles,i),sides=rotate(sides,i),deepEq(angles1,angles)){var sidePairs=_.zip(sides1,sides),factors=_.map(sidePairs,function(pair){return pair[0]/pair[1]}),same=_.all(factors,function(factor){return eq(factors[0],factor)}),congruentEnough=_.all(sidePairs,function(pair){return knumber.equal(pair[0],pair[1],tolerance)});if(same&&congruentEnough)return!0}}return!1}function leq(a,b){return a<b||eq(a,b)}function canonicalSineCoefficients(coeffs){var amplitude=coeffs[0],angularFrequency=coeffs[1],phase=coeffs[2],verticalOffset=coeffs[3];amplitude<0&&(amplitude*=-1,angularFrequency*=-1,phase*=-1);var period=2*Math.PI;for(angularFrequency<0&&(angularFrequency*=-1,phase*=-1,phase+=period/2);phase>0;)phase-=period;for(;phase<0;)phase+=period;return[amplitude,angularFrequency,phase,verticalOffset]}function rotate(array,n){return n=void 0===n?1:n%array.length,array.slice(n).concat(array.slice(0,n))}function capitalize(str){return str.replace(/(?:^|-)(.)/g,function(match,letter){return letter.toUpperCase()})}function getLineEquation(first,second){if(eq(first[0],second[0]))return"x = "+first[0].toFixed(3);var m=(second[1]-first[1])/(second[0]-first[0]),b=first[1]-m*first[0];return"y = "+m.toFixed(3)+"x + "+b.toFixed(3)}var InteractiveGraph=React.createClass({displayName:"InteractiveGraph",propTypes:{containerSizeClass:containerSizeClassPropType.isRequired,trackInteraction:React.PropTypes.func.isRequired},getInitialState:function(){return{shouldShowInstructions:this._getShouldShowInstructions()}},getDefaultProps:function(){return{labels:["x","y"],range:[[-10,10],[-10,10]],step:[1,1],backgroundImage:defaultBackgroundImage,markings:"graph",showTooltips:!1,showProtractor:!1,showRuler:!1,rulerLabel:"",rulerTicks:10,graph:{type:"linear"}}},deprecatedProps:{showGraph:function(props){return{markings:props.showGraph?"graph":"none"}}},componentWillMount:function(){DeprecationMixin.componentWillMount.call(this)},_getShouldShowInstructions:function(props){return props=props||this.props,this.isClickToAddPoints(props)&&(null==props.graph.coords||0===props.graph.coords.length)},componentDidUpdate:function(prevProps,prevState){var oldType=prevProps.graph.type,newType=this.props.graph.type;oldType===newType&&prevProps.graph.allowReflexAngles===this.props.graph.allowReflexAngles&&prevProps.graph.angleOffsetDeg===this.props.graph.angleOffsetDeg&&prevProps.graph.numPoints===this.props.graph.numPoints&&prevProps.graph.numSides===this.props.graph.numSides&&prevProps.graph.numSegments===this.props.graph.numSegments&&prevProps.graph.showAngles===this.props.graph.showAngles&&prevProps.graph.showSides===this.props.graph.showSides&&prevProps.graph.snapTo===this.props.graph.snapTo&&prevProps.graph.snapDegrees===this.props.graph.snapDegrees||(this["remove"+capitalize(oldType)+"Controls"](),this["add"+capitalize(newType)+"Controls"]()),this.shouldResetGraphie&&this.resetGraphie()},render:function(){var typeSelect,extraOptions,_this=this;if(this.props.flexibleType)if(typeSelect=React.createElement("select",{value:this.props.graph.type,onChange:function(e){var type=e.target.value;_this.onChange({graph:{type:type}})}},React.createElement("option",{value:"linear"},"Linear function"),React.createElement("option",{value:"quadratic"},"Quadratic function"),React.createElement("option",{value:"sinusoid"},"Sinusoid function"),React.createElement("option",{value:"circle"},"Circle"),React.createElement("option",{value:"point"},"Point(s)"),React.createElement("option",{value:"linear-system"},"Linear System"),React.createElement("option",{value:"polygon"},"Polygon"),React.createElement("option",{value:"segment"},"Line Segment(s)"),React.createElement("option",{value:"ray"},"Ray"),React.createElement("option",{value:"angle"},"Angle")),"point"===this.props.graph.type)extraOptions=React.createElement("select",{key:"point-select",value:this.props.graph.numPoints||1,onChange:function(e){var num=+e.target.value||e.target.value;_this.onChange({graph:{type:"point",numPoints:num,coords:null}})}},_.map(_.range(1,7),function(n){return React.createElement("option",{value:n},n," point",n>1&&"s")}),React.createElement("option",{value:"unlimited"},"unlimited"));else if("polygon"===this.props.graph.type)extraOptions=React.createElement("div",null,React.createElement("div",null,React.createElement("select",{key:"polygon-select",value:this.props.graph.numSides||3,onChange:function(e){var num=+e.target.value||e.target.value,graph=_.extend({},_this.props.graph,{numSides:num,coords:null,snapTo:"grid"});_this.onChange({graph:graph})}},_.map(_.range(3,13),function(n){return React.createElement("option",{value:n},n," sides")}),React.createElement("option",{value:"unlimited"},"unlimited sides"))),React.createElement("div",null,React.createElement("label",null," ","Snap to"," ",React.createElement("select",{key:"polygon-snap",value:this.props.graph.snapTo,onChange:function(e){var graph=_.extend({},_this.props.graph,{snapTo:e.target.value,coords:null});_this.onChange({graph:graph})}},React.createElement("option",{value:"grid"},"grid"),"unlimited"!==this.props.graph.numSides&&[React.createElement("option",{value:"angles"}," ","interior angles"," "),React.createElement("option",{value:"sides"}," ","side measures"," ")])),React.createElement(InfoTip,null,React.createElement("p",null,"These options affect the movement of the vertex points. The grid option will guide the points to the nearest half step along the grid."),React.createElement("p",null,"The interior angle and side measure options guide the points to the nearest whole angle or side")," ","measure respectively."," ")),React.createElement("div",null,React.createElement("label",null,"Show angle measures:"," ",React.createElement("input",{type:"checkbox",checked:this.props.graph.showAngles,onChange:this.toggleShowAngles})),React.createElement(InfoTip,null,React.createElement("p",null,"Displays the interior angle measures."))),React.createElement("div",null,React.createElement("label",null,"Show side measures:"," ",React.createElement("input",{type:"checkbox",checked:this.props.graph.showSides,onChange:this.toggleShowSides})),React.createElement(InfoTip,null,React.createElement("p",null,"Displays the side lengths."))));else if("segment"===this.props.graph.type)extraOptions=React.createElement("select",{key:"segment-select",value:this.props.graph.numSegments||1,onChange:function(e){var num=+e.target.value;_this.onChange({graph:{type:"segment",numSegments:num,coords:null}})}},_.map(_.range(1,7),function(n){return React.createElement("option",{value:n},n," segment",n>1&&"s")}));else if("angle"===this.props.graph.type){var allowReflexAngles=defaultVal(this.props.graph.allowReflexAngles,!0);extraOptions=React.createElement("div",null,React.createElement("div",null,React.createElement("label",null,"Show angle measure:"," ",React.createElement("input",{type:"checkbox",checked:this.props.graph.showAngles,onChange:this.toggleShowAngles}))),React.createElement("div",null,React.createElement("label",null,"Allow reflex angles:"," ",React.createElement("input",{type:"checkbox",checked:allowReflexAngles,onChange:function(newVal){_this.onChange({graph:_.extend({},_this.props.graph,{allowReflexAngles:!allowReflexAngles,coords:null})})}})),React.createElement(InfoTip,null,React.createElement("p",null,"Reflex angles are angles with a measure greater than 180 degrees."),React.createElement("p",null,"By default, these should remain enabled."))),React.createElement("div",null,React.createElement("label",null,"Snap to increments of"," ",React.createElement(NumberInput,{key:"degree-snap",placeholder:1,value:this.props.graph.snapDegrees,onChange:function(newVal){_this.onChange({graph:_.extend({},_this.props.graph,{snapDegrees:Math.abs(newVal),coords:null})})}})," ","degrees"," ")),React.createElement("div",null,React.createElement("label",null," ","With an offset of"," ",React.createElement(NumberInput,{key:"angle-offset",placeholder:0,value:this.props.graph.angleOffsetDeg,onChange:function(newVal){_this.onChange({graph:_.extend({},_this.props.graph,{angleOffsetDeg:newVal,coords:null})})}})," ","degrees"," ")))}var instructions,box=getInteractiveBoxFromSizeClass(this.props.containerSizeClass);this.isClickToAddPoints()&&this.state.shouldShowInstructions?"point"===this.props.graph.type?instructions=i18n._("Click to add points"):"polygon"===this.props.graph.type&&(instructions=i18n._("Click to add vertices")):instructions=void 0;var onMouseDown=this.isClickToAddPoints()?this.handleAddPointsMouseDown:null,gridStep=this.props.gridStep||Util.getGridStep(this.props.range,this.props.step,box[0]),snapStep=this.props.snapStep||Util.snapStepFromGridStep(gridStep),isMobile=this.props.apiOptions.isMobile;return React.createElement("div",{className:"perseus-widget perseus-widget-interactive-graph",style:{width:box[0],height:this.props.flexibleType?"auto":box[1]}},React.createElement(Graph,{instructions:instructions,ref:"graph",box:box,labels:this.props.labels,range:this.props.range,step:isMobile?Util.constrainedTickStepsFromTickSteps(this.props.step,this.props.range):this.props.step,gridStep:gridStep,snapStep:snapStep,markings:this.props.markings,backgroundImage:this.props.backgroundImage,showProtractor:this.props.showProtractor,showRuler:this.props.showRuler,rulerLabel:this.props.rulerLabel,rulerTicks:this.props.rulerTicks,onMouseDown:onMouseDown,onGraphieUpdated:this.setGraphie,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable,isMobile:isMobile}),typeSelect,extraOptions)},componentDidMount:function(){this.setGraphie(this.refs.graph.graphie())},setGraphie:function(newGraphie){this.graphie=newGraphie,this.setupGraphie()},handleAddPointsMouseDown:function(coord){if(!this.isClickToAddPoints())throw new Error("handleAddPointsClick should not be registeredwhen isClickToAddPoints() is false");if(!this.isCoordInTrash(coord)){var point;if("point"===this.props.graph.type){if(!(point=this.createPointForPointsType(coord,this.points.length)).constrain())return void point.remove();this.points.push(point);var idx=this.points.length-1;this.points[idx].grab(coord),this.updateCoordsFromPoints()}else if("polygon"===this.props.graph.type){if(this.polygon.closed())return;point=this.createPointForPolygonType(coord,this.points.length),this.points.push(point);idx=this.points.length-1;this.points[idx].grab(coord),this.updatePolygon()}this.setState({shouldShowInstructions:!1})}},resetGraphie:function(){this.shouldResetGraphie=!1,this.parabola=null,this.sinusoid=null,this.refs.graph.reset()},setupGraphie:function(){this.setTrashCanVisibility(0),this.isClickToAddPoints()&&this.setTrashCanVisibility(.5),this.props.apiOptions.isMobile&&(this.horizHairline=new WrappedLine(this.graphie,[0,0],[0,0],{normalStyle:{strokeWidth:1}}),this.horizHairline.attr({stroke:KhanColors.INTERACTIVE}),this.horizHairline.hide(),this.vertHairline=new WrappedLine(this.graphie,[0,0],[0,0],{normalStyle:{strokeWidth:1}}),this.vertHairline.attr({stroke:KhanColors.INTERACTIVE}),this.vertHairline.hide()),this["add"+capitalize(this.props.graph.type)+"Controls"]()},showHairlines:function(point){this.props.apiOptions.isMobile&&"none"!==this.props.markings&&(this.horizHairline.moveTo([this.props.range[0][0],point[1]],[this.props.range[0][1],point[1]]),this.horizHairline.show(),this.vertHairline.moveTo([point[0],this.props.range[1][0]],[point[0],this.props.range[1][1]]),this.vertHairline.show())},hideHairlines:function(){this.props.apiOptions.isMobile&&(this.horizHairline.hide(),this.vertHairline.hide())},setTrashCanVisibility:function(opacity){var graphie=this.graphie;knumber.equal(opacity,0)?this.trashCan&&(this.trashCan.remove(),this.trashCan=null):this.props.apiOptions.isMobile||(this.trashCan||(this.trashCan=graphie.raphael.image("https://ka-perseus-graphie.s3.amazonaws.com/b1452c0d79fd0f7ff4c3af9488474a0a0decb361.png",graphie.xpixels-40,graphie.ypixels-40,40,40)),this.trashCan.attr({opacity:opacity}))},componentWillReceiveProps:function(nextProps){this.isClickToAddPoints()!==this.isClickToAddPoints(nextProps)&&(this.shouldResetGraphie=!0,this.setState({shouldShowInstructions:this._getShouldShowInstructions(nextProps)})),this.props.backgroundImage.url===nextProps.backgroundImage.url&&this.props.backgroundImage===nextProps.backgroundImage&&this.props.containerSizeClass===nextProps.containerSizeClass||(this.shouldResetGraphie=!0)},isClickToAddPoints:function(props){return"point"===(props=props||this.props).graph.type&&"unlimited"===props.graph.numPoints||"polygon"===props.graph.type&&"unlimited"===props.graph.numSides},_lineStroke:function(){return this.props.isMobile?{"stroke-width":3}:{}},addLine:function(type){var _this2=this,self=this,graphie=self.graphie,coords=InteractiveGraph.getLineCoords(self.props.graph,self.props),points=self.points=_.map(coords,function(coord){return Interactive2.addMaybeMobileMovablePoint(_this2,{coord:coord,constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap()],onMove:function(){var graph=_.extend({},self.props.graph,{coords:_.invoke(points,"coord")});self.onChange({graph:graph})}})}),lineConfig={points:points,static:!0,normalStyle:_extends({stroke:this.props.apiOptions.isMobile?KhanColors.BLUE_C:KhanColors.INTERACTIVE},this._lineStroke())};"line"===type?lineConfig.extendLine=!0:"ray"===type&&(lineConfig.extendRay=!0);self.line=Interactive2.addMovableLine(graphie,lineConfig);points[0].listen("constraints","isLine",function(coord){return!kpoint.equal(coord,points[1].coord())}),points[1].listen("constraints","isLine",function(coord){return!kpoint.equal(coord,points[0].coord())})},removeLine:function(){_.invoke(this.points,"remove"),this.line.remove()},addLinearControls:function(){this.addLine("line")},removeLinearControls:function(){this.removeLine()},addQuadraticControls:function(){var pointA,pointB,pointC,_this3=this,coords=(this.graphie,this.props.graph.coords);coords||(coords=InteractiveGraph.defaultQuadraticCoords(this.props));var onMoveHandler=function(){var graph=_.extend({},_this3.props.graph,{coords:[pointA.coord(),pointB.coord(),pointC.coord()]});_this3.onChange({graph:graph}),_this3.updateQuadratic()};pointA=this.pointA=Interactive2.addMaybeMobileMovablePoint(this,{coord:coords[0],constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){return!pointA||coord[0]!==pointB.coord()[0]&&coord[0]!==pointC.coord()[0]}],onMove:onMoveHandler}),pointB=this.pointB=Interactive2.addMaybeMobileMovablePoint(this,{coord:coords[1],constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){return!pointB||coord[0]!==pointA.coord()[0]&&coord[0]!==pointC.coord()[0]}],onMove:onMoveHandler}),pointC=this.pointC=Interactive2.addMaybeMobileMovablePoint(this,{coord:coords[2],constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){return!pointC||coord[0]!==pointA.coord()[0]&&coord[0]!==pointB.coord()[0]}],onMove:onMoveHandler}),this.updateQuadratic()},updateQuadratic:function(){var coeffs=InteractiveGraph.getCurrentQuadraticCoefficients(this.props);if(coeffs){var a=coeffs[0],b=coeffs[1],c=coeffs[2];if(this.parabola){var path=this.graphie.svgParabolaPath(a,b,c);this.parabola.attr({path:path})}else this.parabola=this.graphie.parabola(a,b,c),this.parabola.attr(_extends({stroke:this.props.apiOptions.isMobile?KhanColors.BLUE_C:KhanColors.DYNAMIC},this._lineStroke())),this.parabola.toBack()}},removeQuadraticControls:function(){this.pointA.remove(),this.pointB.remove(),this.pointC.remove(),this.parabola&&(this.parabola.remove(),this.parabola=null)},addSinusoidControls:function(){var pointA,pointB,_this4=this,coords=(this.graphie,this.props.graph.coords);coords||(coords=InteractiveGraph.defaultSinusoidCoords(this.props));var onMoveHandler=function(){var graph=_.extend({},_this4.props.graph,{coords:[pointA.coord(),pointB.coord()]});_this4.onChange({graph:graph}),_this4.updateSinusoid()};pointA=this.pointA=Interactive2.addMaybeMobileMovablePoint(this,{coord:coords[0],constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){return!pointA||coord[0]!==pointB.coord()[0]}],onMove:onMoveHandler}),pointB=this.pointB=Interactive2.addMaybeMobileMovablePoint(this,{coord:coords[1],constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){return!pointA||coord[0]!==pointA.coord()[0]}],onMove:onMoveHandler}),this.updateSinusoid()},updateSinusoid:function(){var coeffs=InteractiveGraph.getCurrentSinusoidCoefficients(this.props);if(coeffs){var a=coeffs[0],b=coeffs[1],c=coeffs[2],d=coeffs[3];if(this.sinusoid){var path=this.graphie.svgSinusoidPath(a,b,c,d);this.sinusoid.attr({path:path})}else this.sinusoid=this.graphie.sinusoid(a,b,c,d),this.sinusoid.attr(_extends({stroke:this.props.apiOptions.isMobile?KhanColors.BLUE_C:KhanColors.DYNAMIC},this._lineStroke())),this.sinusoid.toBack()}},removeSinusoidControls:function(){this.pointA.remove(),this.pointB.remove(),this.sinusoid&&(this.sinusoid.remove(),this.sinusoid=null)},addCircleControls:function(){var _this5=this,graphie=this.graphie,minSnap=_.min(graphie.snap),circle=this.circle=graphie.addCircleGraph({center:this.props.graph.center||[0,0],radius:this.props.graph.radius||_.min(this.props.step),snapX:graphie.snap[0],snapY:graphie.snap[1],minRadius:minSnap,snapRadius:minSnap});$(circle).on("move",function(){var graph=_.extend({},_this5.props.graph,{center:circle.center,radius:circle.radius});_this5.onChange({graph:graph})})},removeCircleControls:function(){this.circle.remove()},addLinearSystemControls:function(){var _this6=this,graphie=this.graphie,coords=InteractiveGraph.getLinearSystemCoords(this.props.graph,this.props),segmentColors=[KhanColors.INTERACTIVE,KhanColors.GREEN],points=this.points=_.map(coords,function(segmentCoords,segmentIndex){var segmentPoints=_.map(segmentCoords,function(coord,i){return Interactive2.addMaybeMobileMovablePoint(_this6,{coord:coord,constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){if(segmentPoints)return!kpoint.equal(coord,segmentPoints[1-i].coord())}],onMove:function(){var graph=_.extend({},_this6.props.graph,{coords:_.map(_this6.points,function(segment){return _.invoke(segment,"coord")})});_this6.onChange({graph:graph})},normalStyle:{fill:segmentColors[segmentIndex]},highlightStyle:{fill:segmentColors[segmentIndex]}})});return segmentPoints});this.lines=_.map(points,function(segmentPoints,segmentIndex){return Interactive2.addMovableLine(graphie,{points:segmentPoints,static:!0,extendLine:!0,normalStyle:{stroke:segmentColors[segmentIndex]}})})},removeLinearSystemControls:function(){_.invoke(this.lines,"remove"),_.map(this.points,function(segment){return _.invoke(segment,"remove")})},isCoordInTrash:function(coord){if(this.props.apiOptions.isMobile)return!1;var graphie=this.graphie,screenPoint=graphie.scalePoint(coord);return screenPoint[0]>=graphie.xpixels-40&&screenPoint[1]>=graphie.ypixels-40},createPointForPointsType:function(coord,i){var self=this,remove=(self.graphie,function(){self.points=_.filter(self.points,function(pt){return pt!==point}),self.updateCoordsFromPoints(),setTimeout(point.remove.bind(point),0)}),point=Interactive2.addMaybeMobileMovablePoint(this,_extends({coord:coord,constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){return _.all(self.points,function(pt){return point===pt||!kpoint.equal(coord,pt.coord())})}],onMoveStart:function(){self.isClickToAddPoints()&&self.setTrashCanVisibility(1)},onMove:self.updateCoordsFromPoints,onMoveEnd:function(coord){self.isClickToAddPoints()&&(self.isCoordInTrash(coord)&&remove(),self.setTrashCanVisibility(.5))}},this.props.apiOptions.isMobile&&self.isClickToAddPoints()?{onRemove:remove}:{}));return point},removePoint:function(point){var index=null;return this.points=_.filter(this.points,function(pt,i){return pt!==point||(index=i,!1)}),index},createPointForPolygonType:function(coord,i){var _this7=this,snapToGrid=(this.graphie,!_.contains(["angles","sides"],this.props.graph.snapTo)),rel=function(j){return(i+j+_this7.points.length)%_this7.points.length},remove=function(){var index=_this7.removePoint(point);_this7.polygon.closed()&&(_this7.points=rotate(_this7.points,index),_this7.polygon.update({closed:!1})),_this7.updatePolygon(),_this7.clearCoords(),setTimeout(point.remove.bind(point),0)},point=Interactive2.addMaybeMobileMovablePoint(this,_extends({coord:coord,constraints:[Interactive2.MovablePoint.constraints.bound(),snapToGrid?Interactive2.MovablePoint.constraints.snap():null,function(coord){if(null==_this7.points||0===_this7.points.length)return!0;var a,b,c,coords=_.invoke(_this7.points,"coord");if(coords[i]=coord,!_this7.isClickToAddPoints()){if(collinear(coords[rel(-2)],coords[rel(-1)],coords[i])||collinear(coords[rel(-1)],coords[i],coords[rel(1)])||collinear(coords[i],coords[rel(1)],coords[rel(2)]))return!1;var segments=_.zip(coords,rotate(coords));if(_this7.points.length>3)for(var j=-1;j<=0;j++)for(var segment=segments[rel(j)],others=_.without(segments,segment,segments[rel(j-1)],segments[rel(j+1)]),k=0;k<others.length;k++){if(intersects(segment,others[k]))return!1}}if("angles"===_this7.props.graph.snapTo&&_this7.points.length>2){var angles=_.map(angleMeasures(coords),function(rad){return 180*rad/Math.PI});_.each([-1,1],function(j){angles[rel(j)]=Math.round(angles[rel(j)])});var getAngle=function(a,vertex,b){return(GraphUtils.findAngle(coords[rel(a)],coords[rel(b)],coords[rel(vertex)])+360)%360},innerAngles=[angles[rel(-1)]-getAngle(-2,-1,1),angles[rel(1)]-getAngle(-1,1,2)];if(innerAngles[2]=180-(innerAngles[0]+innerAngles[1]),_.any(innerAngles,function(angle){return leq(angle,1)}))return!1;var knownSide=magnitude(vector(coords[rel(-1)],coords[rel(1)])),onLeft=1===sign(ccw(coords[rel(-1)],coords[rel(1)],coords[i])),side=Math.sin(innerAngles[1]*Math.PI/180)/Math.sin(innerAngles[2]*Math.PI/180)*knownSide,outerAngle=GraphUtils.findAngle(coords[rel(1)],coords[rel(-1)]),offset=_this7.graphie.polar(side,outerAngle+(onLeft?1:-1)*innerAngles[0]);return _this7.graphie.addPoints(coords[rel(-1)],offset)}if("sides"===_this7.props.graph.snapTo&&_this7.points.length>1){var sides=_.map([[coords[rel(-1)],coords[i]],[coords[i],coords[rel(1)]],[coords[rel(-1)],coords[rel(1)]]],function(coords){return magnitude(vector.apply(null,coords))});if(_.each([0,1],function(j){sides[j]=Math.round(sides[j])}),leq(sides[1]+sides[2],sides[0])||leq(sides[0]+sides[2],sides[1])||leq(sides[0]+sides[1],sides[2]))return!1;var innerAngle=(a=sides[0],b=sides[2],c=sides[1],180*Math.acos((a*a+b*b-c*c)/(2*a*b))/Math.PI);outerAngle=GraphUtils.findAngle(coords[rel(1)],coords[rel(-1)]),onLeft=1===sign(ccw(coords[rel(-1)],coords[rel(1)],coords[i])),offset=_this7.graphie.polar(sides[0],outerAngle+(onLeft?1:-1)*innerAngle);return _this7.graphie.addPoints(coords[rel(-1)],offset)}return!0}],onMoveStart:function(){_this7.isClickToAddPoints()&&_this7.setTrashCanVisibility(1)},onMove:function(){_this7.polygon.closed()&&_this7.updateCoordsFromPoints()},onMoveEnd:function(coord){if(_this7.isClickToAddPoints()){if(_this7.isCoordInTrash(coord))remove();else if(_this7.points.length>1&&(point===_this7.points[0]&&kpoint.equal(coord,_.last(_this7.points).coord())||point===_.last(_this7.points)&&kpoint.equal(coord,_this7.points[0].coord()))){var pointToRemove=_this7.points.pop();_this7.points.length>2?(_this7.polygon.update({closed:!0}),_this7.updateCoordsFromPoints()):(_this7.polygon.update({closed:!1}),_this7.clearCoords()),_this7.updatePolygon(),setTimeout(pointToRemove.remove.bind(pointToRemove),0)}else{_.any(_this7.points,function(pt){return pt!==point&&kpoint.equal(pt.coord(),coord)})?(_this7.removePoint(point),_this7.points.length<3?(_this7.polygon.update({closed:!1}),_this7.clearCoords()):_this7.polygon.closed()&&_this7.updateCoordsFromPoints(),_this7.updatePolygon(),setTimeout(point.remove.bind(point),0)):point!==_this7.points[0]&&point!==_.last(_this7.points)||point.hasMoved()||point.state.isInitialMove||_this7.polygon.closed()||!(_this7.points.length>2)||(_this7.polygon.update({closed:!0}),_this7.updatePolygon(),_this7.updateCoordsFromPoints())}_this7.setTrashCanVisibility(.5)}point.state.isInitialMove=!1}},this.props.apiOptions.isMobile&&this.isClickToAddPoints()?{onRemove:remove}:{}));return point.state.isInitialMove=!0,point},updateCoordsFromPoints:function(){var graph=_.extend({},this.props.graph,{coords:_.map(this.points,function(point){return _.result(point,"coord")})});this.onChange({graph:graph})},clearCoords:function(){var graph=_.extend({},this.props.graph,{coords:null});this.onChange({graph:graph})},onChange:function(data){this.props.onChange(data),this.props.trackInteraction()},addPointControls:function(){var coords=InteractiveGraph.getPointCoords(this.props.graph,this.props);this.points=[],this.points=_.map(coords,this.createPointForPointsType,this)},removePointControls:function(){_.invoke(this.points,"remove")},addSegmentControls:function(){var _this8=this,self=this,graphie=this.graphie,coords=InteractiveGraph.getSegmentCoords(this.props.graph,this.props);this.points=[],this.lines=_.map(coords,function(segment,i){var updateCoordProps=function(){var graph=_.extend({},self.props.graph,{coords:_.invoke(self.lines,"coords")});self.onChange({graph:graph})},points=_.map(segment,function(coord,i){return options={coord:coord,constraints:[Interactive2.MovablePoint.constraints.bound(),Interactive2.MovablePoint.constraints.snap(),function(coord){if(points)return!kpoint.equal(coord,points[1-i].coord())}],onMove:updateCoordProps},Interactive2.addMaybeMobileMovablePoint(_this8,options);var options});self.points=self.points.concat(points);var line=Interactive2.addMovableLine(graphie,{points:points,static:!1,constraints:[Interactive2.MovableLine.constraints.bound(),Interactive2.MovableLine.constraints.snap()],onMove:[Interactive2.MovableLine.onMove.updatePoints,updateCoordProps],normalStyle:_extends({stroke:this.props.apiOptions.isMobile?KhanColors.BLUE_C:KhanColors.INTERACTIVE},this._lineStroke()),highlightStyle:_extends({stroke:this.props.apiOptions.isMobile?KhanColors.BLUE_C:KhanColors.INTERACTING},this._lineStroke())});return _.invoke(points,"toFront"),line},this)},removeSegmentControls:function(){_.invoke(this.points,"remove"),_.invoke(this.lines,"remove")},addRayControls:function(){this.addLine("ray")},removeRayControls:function(){this.removeLine()},addPolygonControls:function(){this.polygon=null;var coords=InteractiveGraph.getPolygonCoords(this.props.graph,this.props);this.points=[],this.points=_.map(coords,this.createPointForPolygonType,this),this.updatePolygon()},updatePolygon:function(){var closed;closed=this.polygon?this.polygon.closed():this.points.length>=3;var graphie=this.graphie,n=this.points.length,snapToGrid=!_.contains(["angles","sides"],this.props.graph.snapTo),angleLabels=_.times(n,function(i){return this.props.graph.showAngles&&(closed||0!==i&&i!==n-1)?"angles"===this.props.graph.snapTo?"$deg0":"$deg1":""},this),showRightAngleMarkers=_.times(n,function(i){return closed||0!==i&&i!==n-1},this),numArcs=_.times(n,function(i){return this.props.graph.showAngles&&(closed||0!==i&&i!==n-1)?1:0},this),sideLabels=_.times(n,function(i){return!this.props.graph.showSides||!closed&&i===n-1?"":"sides"===this.props.graph.snapTo?"$len0":"$len1"},this);if(null==this.polygon){var self=this;self.polygon=Interactive2.addMovablePolygon(graphie,{constraints:[Interactive2.MovablePolygon.constraints.bound(),snapToGrid?Interactive2.MovablePolygon.constraints.snap():null],closed:closed,points:self.points,angleLabels:angleLabels,showRightAngleMarkers:showRightAngleMarkers,numArcs:numArcs,sideLabels:sideLabels,onMove:[Interactive2.MovablePolygon.onMove.updatePoints,function(){this.closed()&&self.updateCoordsFromPoints()}],normalStyle:_extends({stroke:this.props.apiOptions.isMobile?KhanColors.BLUE_C:KhanColors.INTERACTIVE},this._lineStroke())})}else this.polygon.update({closed:closed,points:this.points,angleLabels:angleLabels,showRightAngleMarkers:showRightAngleMarkers,numArcs:numArcs,sideLabels:sideLabels})},removePolygonControls:function(){_.invoke(this.points,"remove"),this.polygon.remove()},addAngleControls:function(){var _this9=this,graphie=this.graphie,coords=InteractiveGraph.getAngleCoords(this.props.graph,this.props);this.points=_.map(coords,function(coord,i){return graphie.addMovablePoint(_.extend({coord:coord,normalStyle:{stroke:KhanColors.INTERACTIVE,fill:KhanColors.INTERACTIVE}},1===i?{snapX:graphie.snap[0],snapY:graphie.snap[1]}:{}))}),this.angle=graphie.addMovableAngle({points:this.points,snapDegrees:this.props.graph.snapDegrees||1,snapOffsetDeg:this.props.graph.angleOffsetDeg||0,angleLabel:this.props.graph.showAngles?"$deg0":"",pushOut:2,allowReflex:defaultVal(this.props.graph.allowReflexAngles,!0)}),$(this.angle).on("move",function(){var graph=_.extend({},_this9.props.graph,{coords:_this9.angle.getClockwiseCoords()});_this9.onChange({graph:graph})})},removeAngleControls:function(){_.invoke(this.points,"remove"),this.angle.remove()},toggleShowAngles:function(){var graph=_.extend({},this.props.graph,{showAngles:!this.props.graph.showAngles});this.onChange({graph:graph})},toggleShowSides:function(){var graph=_.extend({},this.props.graph,{showSides:!this.props.graph.showSides});this.onChange({graph:graph})},getUserInput:function(){return this.props.graph},simpleValidate:function(rubric){return InteractiveGraph.validate(this.getUserInput(),rubric,this)},focus:$.noop});_.extend(InteractiveGraph,{getQuadraticCoefficients:function(coords){var p1=coords[0],p2=coords[1],p3=coords[2],denom=(p1[0]-p2[0])*(p1[0]-p3[0])*(p2[0]-p3[0]);if(0!==denom)return[(p3[0]*(p2[1]-p1[1])+p2[0]*(p1[1]-p3[1])+p1[0]*(p3[1]-p2[1]))/denom,(p3[0]*p3[0]*(p1[1]-p2[1])+p2[0]*p2[0]*(p3[1]-p1[1])+p1[0]*p1[0]*(p2[1]-p3[1]))/denom,(p2[0]*p3[0]*(p2[0]-p3[0])*p1[1]+p3[0]*p1[0]*(p3[0]-p1[0])*p2[1]+p1[0]*p2[0]*(p1[0]-p2[0])*p3[1])/denom]},getSinusoidCoefficients:function(coords){var p1=coords[0],p2=coords[1],amplitude=p2[1]-p1[1],angularFrequency=Math.PI/(2*(p2[0]-p1[0]));return[amplitude,angularFrequency,p1[0]*angularFrequency,p1[1]]},getLineCoords:function(graph,props){return graph.coords||InteractiveGraph.pointsFromNormalized(props,[[.25,.75],[.75,.75]])},getPointCoords:function(graph,props){var numPoints=graph.numPoints||1;if(coords=graph.coords)return coords;switch(numPoints){case 1:coords=[graph.coord||[0,0]];break;case 2:coords=[[-5,0],[5,0]];break;case 3:coords=[[-5,0],[0,0],[5,0]];break;case 4:coords=[[-6,0],[-2,0],[2,0],[6,0]];break;case 5:coords=[[-6,0],[-3,0],[0,0],[3,0],[6,0]];break;case 6:coords=[[-5,0],[-3,0],[-1,0],[1,0],[3,0],[5,0]];break;case"unlimited":coords=[]}var coords;return coords=InteractiveGraph.normalizeCoords(coords,[[-10,10],[-10,10]]),coords=InteractiveGraph.pointsFromNormalized(props,coords)},getLinearSystemCoords:function(graph,props){return graph.coords||_.map([[[.25,.75],[.75,.75]],[[.25,.25],[.75,.25]]],function(coords){return InteractiveGraph.pointsFromNormalized(props,coords)})},getPolygonCoords:function(graph,props){var coords=graph.coords;if(coords)return coords;var n=graph.numSides||3;if("unlimited"===n)coords=[];else{var angle=2*Math.PI/n,offset=(1/n-.5)*Math.PI,radius="sides"===graph.snapTo?Math.sqrt(3)/3*7:4;coords=_.times(n,function(i){return[radius*Math.cos(i*angle+offset),radius*Math.sin(i*angle+offset)]})}coords=InteractiveGraph.normalizeCoords(coords,[[-10,10],[-10,10]]);var snapToGrid=!_.contains(["angles","sides"],graph.snapTo);return coords=InteractiveGraph.pointsFromNormalized(props,coords,!snapToGrid)},getSegmentCoords:function(graph,props){var coords=graph.coords;if(coords)return coords;var ys={1:[5],2:[5,-5],3:[5,0,-5],4:[6,2,-2,-6],5:[6,3,0,-3,-6],6:[5,3,1,-1,-3,-5]}[graph.numSegments||1],range=[[-10,10],[-10,10]];return _.map(ys,function(y){var segment=[[-5,y],[5,y]];return segment=InteractiveGraph.normalizeCoords(segment,range),segment=InteractiveGraph.pointsFromNormalized(props,segment)})},getAngleCoords:function(graph,props){var coords=graph.coords;if(coords)return coords;for(var snap=graph.snapDegrees||1,angle=snap;angle<20;)angle+=snap;angle=angle*Math.PI/180;var offset=(graph.angleOffsetDeg||0)*Math.PI/180;coords=InteractiveGraph.pointsFromNormalized(props,[[.85,.5],[.5,.5]]);var radius=magnitude(vector.apply(null,coords));return coords[0]=[coords[1][0]+radius*Math.cos(offset),coords[1][1]+radius*Math.sin(offset)],coords[2]=[coords[1][0]+radius*Math.cos(angle+offset),coords[1][1]+radius*Math.sin(angle+offset)],coords},normalizeCoords:function(coordsList,range){return _.map(coordsList,function(coords){return _.map(coords,function(coord,i){var extent=range[i][1]-range[i][0];return(coord+range[i][1])/extent})})},getEquationString:function(props){var funcName="get"+capitalize(props.graph.type)+"EquationString";return InteractiveGraph[funcName](props)},pointsFromNormalized:function(props,coordsList,noSnap){return _.map(coordsList,function(coords){return _.map(coords,function(coord,i){var range=props.range[i];if(noSnap)return range[0]+(range[1]-range[0])*coord;var step=props.step[i],nSteps=function(range,step){return Math.floor((range[1]-range[0])/step)}(range,step),tick=Math.round(coord*nSteps);return range[0]+step*tick})})},getLinearEquationString:function(props){var coords=InteractiveGraph.getLineCoords(props.graph,props);if(eq(coords[0][0],coords[1][0]))return"x = "+coords[0][0].toFixed(3);var m=(coords[1][1]-coords[0][1])/(coords[1][0]-coords[0][0]),b=coords[0][1]-m*coords[0][0];return eq(m,0)?"y = "+b.toFixed(3):"y = "+m.toFixed(3)+"x + "+b.toFixed(3)},getCurrentQuadraticCoefficients:function(props){var coords=props.graph.coords||InteractiveGraph.defaultQuadraticCoords(props);return InteractiveGraph.getQuadraticCoefficients(coords)},defaultQuadraticCoords:function(props){return InteractiveGraph.pointsFromNormalized(props,[[.25,.75],[.5,.25],[.75,.75]])},getQuadraticEquationString:function(props){var coeffs=InteractiveGraph.getCurrentQuadraticCoefficients(props);return"y = "+coeffs[0].toFixed(3)+"x^2 + "+coeffs[1].toFixed(3)+"x + "+coeffs[2].toFixed(3)},getCurrentSinusoidCoefficients:function(props){var coords=props.graph.coords||InteractiveGraph.defaultSinusoidCoords(props);return InteractiveGraph.getSinusoidCoefficients(coords)},defaultSinusoidCoords:function(props){return InteractiveGraph.pointsFromNormalized(props,[[.5,.5],[.65,.6]])},getSinusoidEquationString:function(props){var coeffs=InteractiveGraph.getCurrentSinusoidCoefficients(props);return"y = "+coeffs[0].toFixed(3)+"sin("+coeffs[1].toFixed(3)+"x - "+coeffs[2].toFixed(3)+") + "+coeffs[3].toFixed(3)},getCircleEquationString:function(props){var graph=props.graph,center=graph.center||[0,0];return"center ("+center[0]+", "+center[1]+"), radius "+(graph.radius||2)},getLinearSystemEquationString:function(props){var coords=InteractiveGraph.getLinearSystemCoords(props.graph,props);return"\n"+getLineEquation(coords[0][0],coords[0][1])+"\n"+getLineEquation(coords[1][0],coords[1][1])+"\n"+function(firstPoints,secondPoints){var x1=firstPoints[0][0],y1=firstPoints[0][1],x2=firstPoints[1][0],y2=firstPoints[1][1],x3=secondPoints[0][0],y3=secondPoints[0][1],x4=secondPoints[1][0],y4=secondPoints[1][1],determinant=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(Math.abs(determinant)<1e-9)return"Lines are parallel";var y=((x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4))/determinant;return"Intersection: ("+(((x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4))/determinant).toFixed(3)+", "+y.toFixed(3)+")"}(coords[0],coords[1])},getPointEquationString:function(props){return InteractiveGraph.getPointCoords(props.graph,props).map(function(coord){return"("+coord[0]+", "+coord[1]+")"}).join(", ")},getSegmentEquationString:function(props){var segments=InteractiveGraph.getSegmentCoords(props.graph,props);return _.map(segments,function(segment){return"["+_.map(segment,function(coord){return"("+coord.join(", ")+")"}).join(" ")+"]"}).join(" ")},getRayEquationString:function(props){var coords=InteractiveGraph.getLineCoords(props.graph,props),a=coords[0],b=coords[1],eq=InteractiveGraph.getLinearEquationString(props);return a[0]>b[0]?eq+=" (for x <= "+a[0].toFixed(3)+")":a[0]<b[0]?eq+=" (for x >= "+a[0].toFixed(3)+")":a[1]>b[1]?eq+=" (for y <= "+a[1].toFixed(3)+")":eq+=" (for y >= "+a[1].toFixed(3)+")",eq},getPolygonEquationString:function(props){var coords=InteractiveGraph.getPolygonCoords(props.graph,props);return _.map(coords,function(coord){return"("+coord.join(", ")+")"}).join(" ")},getAngleEquationString:function(props){var coords=InteractiveGraph.getAngleCoords(props.graph,props);return GraphUtils.findAngle(coords[2],coords[0],coords[1]).toFixed(0)+" angle at ("+coords[1].join(", ")+")"},validate:function(state,rubric,component){var hasValue=!!(state.coords||state.center&&state.radius);if(state.type===rubric.correct.type&&hasValue)if("linear"===state.type){var guess=state.coords;if(collinear((correct=rubric.correct.coords)[0],correct[1],guess[0])&&collinear(correct[0],correct[1],guess[1]))return{type:"points",earned:1,total:1,message:null}}else if("linear-system"===state.type){guess=state.coords;if(collinear((correct=rubric.correct.coords)[0][0],correct[0][1],guess[0][0])&&collinear(correct[0][0],correct[0][1],guess[0][1])&&collinear(correct[1][0],correct[1][1],guess[1][0])&&collinear(correct[1][0],correct[1][1],guess[1][1])||collinear(correct[0][0],correct[0][1],guess[1][0])&&collinear(correct[0][0],correct[0][1],guess[1][1])&&collinear(correct[1][0],correct[1][1],guess[0][0])&&collinear(correct[1][0],correct[1][1],guess[0][1]))return{type:"points",earned:1,total:1,message:null}}else if("quadratic"===state.type){var guessCoeffs=this.getQuadraticCoefficients(state.coords),correctCoeffs=this.getQuadraticCoefficients(rubric.correct.coords);if(deepEq(guessCoeffs,correctCoeffs))return{type:"points",earned:1,total:1,message:null}}else if("sinusoid"===state.type){guessCoeffs=this.getSinusoidCoefficients(state.coords),correctCoeffs=this.getSinusoidCoefficients(rubric.correct.coords);var canonicalGuessCoeffs=canonicalSineCoefficients(guessCoeffs),canonicalCorrectCoeffs=canonicalSineCoefficients(correctCoeffs);if(deepEq(canonicalGuessCoeffs,canonicalCorrectCoeffs))return{type:"points",earned:1,total:1,message:null}}else if("circle"===state.type){if(deepEq(state.center,rubric.correct.center)&&eq(state.radius,rubric.correct.radius))return{type:"points",earned:1,total:1,message:null}}else if("point"===state.type){guess=state.coords;var correct=InteractiveGraph.getPointCoords(rubric.correct,component);if(guess=guess.slice(),correct=correct.slice(),guess.sort(),correct.sort(),deepEq(guess,correct))return{type:"points",earned:1,total:1,message:null}}else if("polygon"===state.type){guess=state.coords.slice(),correct=rubric.correct.coords.slice();if("similar"===rubric.correct.match?match=similar(guess,correct,Number.POSITIVE_INFINITY):"congruent"===rubric.correct.match?match=similar(guess,correct,knumber.DEFAULT_TOLERANCE):"approx"===rubric.correct.match?match=similar(guess,correct,.1):(guess.sort(),correct.sort(),match=deepEq(guess,correct)),match)return{type:"points",earned:1,total:1,message:null}}else if("segment"===state.type){guess=state.coords.slice(),correct=rubric.correct.coords.slice();if(guess=_.invoke(guess,"sort").sort(),correct=_.invoke(correct,"sort").sort(),deepEq(guess,correct))return{type:"points",earned:1,total:1,message:null}}else if("ray"===state.type){guess=state.coords,correct=rubric.correct.coords;if(deepEq(guess[0],correct[0])&&collinear(correct[0],correct[1],guess[1]))return{type:"points",earned:1,total:1,message:null}}else if("angle"===state.type){var match;guess=state.coords,correct=rubric.correct.coords;if("congruent"===rubric.correct.match){var angles=_.map([guess,correct],function(coords){return(GraphUtils.findAngle(coords[2],coords[0],coords[1])+360)%360});match=eq.apply(null,angles)}else match=deepEq(guess[1],correct[1])&&collinear(correct[1],correct[0],guess[0])&&collinear(correct[1],correct[2],guess[2]);if(match)return{type:"points",earned:1,total:1,message:null}}return!hasValue||_.isEqual(state,rubric.graph)?{type:"invalid",message:null}:{type:"points",earned:0,total:1,message:null}}}),module.exports={name:"interactive-graph",displayName:"Interactive graph",widget:InteractiveGraph}}).call(this,__webpack_require__(21),__webpack_require__(10))},668:function(module,exports,__webpack_require__){var _require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,React=__webpack_require__(0),colors_grayLight="#aaa",colors_basicBorderColor="#ccc",colors_white="#fff",triangleBeforeAfter={borderBottom:"9px solid transparent",borderTop:"9px solid transparent",content:'" "',height:"0",position:"absolute",top:"0",width:"0"},styles=StyleSheet.create({infoTip:{display:"inline-block",marginLeft:"5px",position:"relative"},infoTipContainer:{position:"absolute",top:"-12px",left:"22px",zIndex:"1000"},infoTipTriangle:{height:"10px",left:"0",position:"absolute",top:"8px",width:"0",zIndex:"1",":before":Object.assign({},triangleBeforeAfter,{borderRight:"9px solid #bbb",right:"0"}),":after":Object.assign({},triangleBeforeAfter,{borderRight:"9px solid "+colors_white,right:"-1px"})},verticalShadow:{border:"1px solid "+colors_basicBorderColor,boxShadow:"0 1px 3px "+colors_basicBorderColor,borderBottom:"1px solid "+colors_grayLight},infoTipContentContainer:{background:colors_white,padding:"5px 10px",width:"240px"}}),InfoTip=React.createClass({displayName:"InfoTip",propTypes:{children:React.PropTypes.node},getInitialState:function(){return{hover:!1}},handleMouseEnter:function(){this.setState({hover:!0})},handleMouseLeave:function(){this.setState({hover:!1})},render:function(){return React.createElement("div",{className:css(styles.infoTip)},React.createElement("img",{width:10,height:10,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3NpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo2N2M3NTAxYS04YmVlLTQ0M2MtYmRiNS04OGM2N2IxN2NhYzEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUJCRTk4Qjc4NjAwMTFFMzg3QUJDNEI4Mzk2QTRGQkQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUJCRTk4QjY4NjAwMTFFMzg3QUJDNEI4Mzk2QTRGQkQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NGE5ZDI0OTMtODk1NC00OGFkLTlhMTgtZDAwM2MwYWNjNDJlIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjY3Yzc1MDFhLThiZWUtNDQzYy1iZGI1LTg4YzY3YjE3Y2FjMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pqm89uYAAADMSURBVHjaXJA9DoJAEIUH1M4TUHIFsCMGen9OwCGw1YRGW2ntKel0exsojHIBC0ouQAyUviFDstmXfNmZeS+zm7XSNCXRFiRgJf0bXIHixpbhGdxBBJYC1w/xaA424MhNEATkui71fU9KqfEU78UbD9PdbJRlOdae55GmhIP+1NV1TcMwkOM41DSNHvRtMhTHMRVFQW3b6mOLgx99kue5GRp/gIOZuZGvNpTNwjD8oliANU+qqqKu6/TQBdymN57AHjzBT+B6Jx79BRgAvc49kQA4yxgAAAAASUVORK5CYII=",onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave}),React.createElement("div",{className:css(styles.infoTipContainer),style:{display:this.state.hover?"block":"none"}},React.createElement("div",{className:css(styles.infoTipTriangle)}),React.createElement("div",{className:css(styles.verticalShadow,styles.infoTipContentContainer)},this.props.children)))}});module.exports=InfoTip},669:function(module,exports,__webpack_require__){(function(i18n){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),WidgetJsonifyDeprecated=__webpack_require__(269),TABLE_STYLE={display:"table",tableLayout:"fixed"},ROW_STYLE={display:"table-row"},CELL_STYLE={display:"table-cell",padding:5},BASE_TILE_STYLE={borderRadius:10,cursor:"pointer"},MOVE_COUNT_STYLE={padding:5,display:"inline-block"},RESET_BUTTON_STYLE={float:"right",paddingRight:5},PATTERNS={plus:function(){return[[!1,!0,!1],[!0,!0,!0],[!1,!0,!1]]},x:function(){return[[!0,!1,!0],[!1,!0,!1],[!0,!1,!0]]},"plus/x":function(iter){return iter%2?PATTERNS.x():PATTERNS.plus()}},Tile=React.createClass({displayName:"Tile",propTypes:{value:React.PropTypes.bool.isRequired,size:React.PropTypes.number.isRequired},render:function(){var color=this.props.value?"#55dd55":"#115511",style=_.extend({},BASE_TILE_STYLE,{width:this.props.size,height:this.props.size,backgroundColor:color});return React.createElement("div",{style:style,onClick:this._flip})},_flip:function(){this.props.onChange(!this.props.value)}}),TileGrid=React.createClass({displayName:"TileGrid",propTypes:{cells:React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.bool)).isRequired,size:React.PropTypes.number.isRequired},render:function(){var _this=this;return React.createElement("div",{style:TABLE_STYLE,className:"no-select"},_.map(this.props.cells,function(row,y){return React.createElement("div",{key:y,style:ROW_STYLE},_.map(row,function(cell,x){return React.createElement("div",{key:x,style:CELL_STYLE},React.createElement(Tile,{value:cell,size:_this.props.size,onChange:_.partial(_this.props.onChange,y,x)}))}))}))}}),flipTilesPattern=function(oldCells,tileY,tileX,pattern){return function(oldCells,predicate){return _.map(oldCells,function(row,y){return _.map(row,function(cell,x){return predicate(y,x)?!cell:cell})})}(oldCells,function(y,x){var offsetY=y-tileY,offsetX=x-tileX;return Math.abs(offsetY)<=1&&Math.abs(offsetX)<=1&&pattern[offsetY+1][offsetX+1]})},LightsPuzzle=React.createClass({displayName:"LightsPuzzle",propTypes:_extends({},Changeable.propTypes,{cells:React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.bool)),startCells:React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.bool)),flipPattern:React.PropTypes.string.isRequired,moveCount:React.PropTypes.number.isRequired}),getDefaultProps:function(){return{cells:[[!1,!1,!1],[!1,!1,!1],[!1,!1,!1]],startCells:[[!1,!1,!1],[!1,!1,!1],[!1,!1,!1]],flipPattern:"plus",moveCount:0}},getUserInput:function(){return WidgetJsonifyDeprecated.getUserInput.call(this)},render:function(){var pxWidth=60*this._width();return React.createElement("div",null,React.createElement(TileGrid,{cells:this.props.cells,size:50,onChange:this._flipTile}),React.createElement("div",{style:{width:pxWidth}},React.createElement("div",{style:MOVE_COUNT_STYLE},"Moves: ",this.props.moveCount),React.createElement("div",{style:RESET_BUTTON_STYLE},React.createElement("input",{type:"button",value:"Reset",onClick:this._reset,className:"simple-button"}))),React.createElement("div",{className:"clearfix"}))},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},_width:function(){return 0!==this.props.cells.length?this.props.cells[0].length:0},componentDidMount:function(){this._initNextPatterns()},componentDidUpdate:function(prevProps){prevProps.flipPattern!==this.props.flipPattern&&this._initNextPatterns()},_initNextPatterns:function(){this._currPattern=PATTERNS[this.props.flipPattern](0),this._nextPattern=PATTERNS[this.props.flipPattern](1),this._patternIndex=2},_shiftPatterns:function(){this._currPattern=this._nextPattern,this._nextPattern=PATTERNS[this.props.flipPattern](this._patternIndex),this._patternIndex++},_flipTile:function(tileY,tileX){var newCells=flipTilesPattern(this.props.cells,tileY,tileX,this._currPattern);this._shiftPatterns(),this.change({cells:newCells,moveCount:this.props.moveCount+1})},_reset:function(){this.change({cells:this.props.startCells,moveCount:0})},simpleValidate:function(rubric){return validate(rubric,this.getUserInput())}}),validate=function(rubric,state){return _.all(state.cells,function(row,y){return _.all(row,function(cell,x){return cell===rubric.startCells[y][x]})})?{type:"invalid",message:i18n._("Click on the tiles to change the lights.")}:_.all(state.cells,function(row){return _.all(row,function(cell){return cell})})?{type:"points",earned:1,total:1,message:null}:rubric.gradeIncompleteAsWrong?{type:"points",earned:0,total:1,message:null}:{type:"invalid",message:i18n._("You must turn on all of the lights to continue.")}};module.exports={name:"lights-puzzle",displayName:"Lights Puzzle",hidden:!0,widget:LightsPuzzle,transform:function(editorProps){return{cells:editorProps.startCells,startCells:editorProps.startCells,flipPattern:editorProps.flipPattern}}}}).call(this,__webpack_require__(21))},670:function(module,exports,__webpack_require__){(function(i18n){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},classNames=__webpack_require__(22),React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),NumberInput=__webpack_require__(642),Renderer=__webpack_require__(33),TextInput=__webpack_require__(275),MathOutput=__webpack_require__(267),SimpleKeypadInput=__webpack_require__(158),ApiOptions=__webpack_require__(13).Options,KhanAnswerTypes=__webpack_require__(73),keypadElementPropType=__webpack_require__(28).propTypes.keypadElementPropType,assert=__webpack_require__(34).assert,stringArrayOfSize=__webpack_require__(19).stringArrayOfSize,_require=__webpack_require__(25),linterContextProps=_require.linterContextProps,linterContextDefault=_require.linterContextDefault,STATIC_INPUT_DIMENSIONS={INPUT_MARGIN:4,INPUT_HEIGHT:38,INPUT_WIDTH:82},NORMAL_DIMENSIONS={INPUT_MARGIN:3,INPUT_HEIGHT:30,INPUT_WIDTH:40},KEYPAD_INPUT_DIMENSIONS={INPUT_MARGIN:4,INPUT_HEIGHT:36,INPUT_WIDTH:64},getInputPath=function(row,column){return[""+row,""+column]},getDefaultPath=function(){return getInputPath(0,0)},getRowFromPath=function(path){return assert(_.isArray(path)&&2===path.length),+path[0]},getColumnFromPath=function(path){return assert(_.isArray(path)&&2===path.length),+path[1]},getRefForPath=function(path){return"answer"+getRowFromPath(path)+","+getColumnFromPath(path)},getMatrixSize=function(matrix){var matrixSize=[1,1];return _(matrix).each(function(matrixRow,row){var rowWidth=0;_(matrixRow).each(function(matrixCol,col){null!=matrixCol&&matrixCol.toString().length&&(rowWidth=col+1)}),matrixSize[1]=Math.max(matrixSize[1],rowWidth),rowWidth>0&&(matrixSize[0]=Math.max(matrixSize[0],row+1))}),matrixSize},Matrix=React.createClass({displayName:"Matrix",propTypes:{answers:React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]))),apiOptions:ApiOptions.propTypes,cursorPosition:React.PropTypes.arrayOf(React.PropTypes.number),keypadElement:keypadElementPropType,matrixBoardSize:React.PropTypes.arrayOf(React.PropTypes.number).isRequired,prefix:React.PropTypes.string,suffix:React.PropTypes.string,trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps},getDefaultProps:function(){return{matrixBoardSize:[3,3],answers:[[]],prefix:"",suffix:"",cursorPosition:[0,0],apiOptions:ApiOptions.defaults,linterContext:linterContextDefault}},getInitialState:function(){return{enterTheMatrix:0}},componentDidMount:function(){this.cursorPosition=[0,0]},render:function(){var dimensions,_this=this,INPUT_MARGIN=(dimensions=this.props.apiOptions.customKeypad?KEYPAD_INPUT_DIMENSIONS:this.props.apiOptions.staticRender?STATIC_INPUT_DIMENSIONS:NORMAL_DIMENSIONS,dimensions.INPUT_MARGIN),INPUT_HEIGHT=dimensions.INPUT_HEIGHT,INPUT_WIDTH=dimensions.INPUT_WIDTH,matrixSize=getMatrixSize(this.props.answers),maxRows=this.props.matrixBoardSize[0],maxCols=this.props.matrixBoardSize[1],cursorRow=this.props.cursorPosition[0],cursorCol=this.props.cursorPosition[1],highlightedRow=Math.max(cursorRow,matrixSize[0]-1),highlightedCol=Math.max(cursorCol,matrixSize[1]-1),bracketHeight=(highlightedRow+1)*(INPUT_HEIGHT+2*INPUT_MARGIN),bracketOffset=(highlightedCol+1)*(INPUT_WIDTH+2*INPUT_MARGIN),className=classNames({"perseus-matrix":!0,"static-mode":this.props.static,"the-matrix":this.state.enterTheMatrix>=5});return React.createElement("div",{className:className},this.props.prefix&&React.createElement("div",{className:"matrix-prefix"},React.createElement(Renderer,{content:this.props.prefix,linterContext:this.props.linterContext})),React.createElement("div",{className:"matrix-input"},React.createElement("div",{className:"matrix-bracket bracket-left",style:{height:bracketHeight}}),React.createElement("div",{className:"matrix-bracket bracket-right",style:{height:bracketHeight,left:bracketOffset}}),_(maxRows).times(function(row){var rowVals=_this.props.answers[row];return React.createElement("div",{className:"matrix-row",key:row},_(maxCols).times(function(col){var outside=row>highlightedRow||col>highlightedCol,inputProps={className:outside?"outside":"inside",ref:getRefForPath(getInputPath(row,col)),value:rowVals?rowVals[col]:null,style:{height:INPUT_HEIGHT,width:INPUT_WIDTH,margin:INPUT_MARGIN},disabled:_this.props.apiOptions.readOnly,onFocus:function(){_this.cursorPosition=[row,col],_this.props.onChange({cursorPosition:[row,col]},function(){return!1}),_this._handleFocus(row,col)},onBlur:function(){row===_this.cursorPosition[0]&&col===_this.cursorPosition[1]&&_this.props.onChange({cursorPosition:[0,0]},function(){return!1}),_this._handleBlur(row,col)},onKeyDown:function(e){_this.handleKeyDown(row,col,e)},onChange:function(value,cb){_this.onValueChange(row,col,value,cb)}},MatrixInput=void 0;if(_this.props.apiOptions.customKeypad){var style={margin:INPUT_MARGIN,minWidth:INPUT_WIDTH,minHeight:INPUT_HEIGHT,boxSizing:"border-box",backgroundColor:outside?"#f3f3f3":"#fff"};MatrixInput=React.createElement(SimpleKeypadInput,_extends({},inputProps,{style:style,scrollable:!0,keypadElement:_this.props.keypadElement}))}else MatrixInput=_this.props.apiOptions.staticRender?React.createElement(MathOutput,inputProps):_this.props.numericInput?React.createElement(NumberInput,inputProps):React.createElement(TextInput,inputProps);return React.createElement("span",{key:col,className:"matrix-input-field"},MatrixInput)}))})),this.props.suffix&&React.createElement("div",{className:"matrix-suffix"},React.createElement(Renderer,{content:this.props.suffix,linterContext:this.props.linterContext})))},getInputPaths:function(){var inputPaths=[],maxRows=this.props.matrixBoardSize[0],maxCols=this.props.matrixBoardSize[1];return _(maxRows).times(function(row){_(maxCols).times(function(col){var inputPath=getInputPath(row,col);inputPaths.push(inputPath)})}),inputPaths},getGrammarTypeForPath:function(inputPath){return"number"},_handleFocus:function(row,col){this.props.onFocus(getInputPath(row,col))},_handleBlur:function(row,col){this.props.onBlur(getInputPath(row,col))},focus:function(){return this.focusInputPath(getDefaultPath()),!0},focusInputPath:function(path){var inputID=getRefForPath(path);this.refs[inputID].focus()},blurInputPath:function(path){0===path.length&&(path=getDefaultPath());var inputID=getRefForPath(path);this.refs[inputID].blur()},getDOMNodeForPath:function(inputPath){var inputID=getRefForPath(inputPath);return ReactDOM.findDOMNode(this.refs[inputID])},setInputValue:function(inputPath,value,callback){var row=getRowFromPath(inputPath),col=getColumnFromPath(inputPath);this.onValueChange(row,col,value,callback)},handleKeyDown:function(row,col,e){var maxRow=this.props.matrixBoardSize[0],maxCol=this.props.matrixBoardSize[1],enterTheMatrix=null,curInput=this.refs[getRefForPath(getInputPath(row,col))],curValueString=curInput.getStringValue(),cursorStartPosition=curInput.getSelectionStart(),cursorEndPosition=curInput.getSelectionEnd(),nextPath=null;if("ArrowUp"===e.key&&row>0?nextPath=getInputPath(row-1,col):"ArrowDown"===e.key&&row+1<maxRow?nextPath=getInputPath(row+1,col):"ArrowLeft"===e.key&&col>0?0===cursorStartPosition&&0===cursorEndPosition&&(nextPath=getInputPath(row,col-1)):"ArrowRight"===e.key&&col+1<maxCol?cursorStartPosition===curValueString.length&&(nextPath=getInputPath(row,col+1)):"Enter"===e.key?enterTheMatrix=this.state.enterTheMatrix+1:"Escape"===e.key&&(enterTheMatrix=0),nextPath){e.preventDefault();var input=this.refs[getRefForPath(nextPath)],valueLength=2*input.getStringValue().length;input.focus(),"ArrowRight"===e.key?input.setSelectionRange(0,0):input.setSelectionRange(valueLength,valueLength)}null!=enterTheMatrix&&this.setState({enterTheMatrix:enterTheMatrix})},onValueChange:function(row,column,value,cb){var answers=_.map(this.props.answers,_.clone);answers[row]||(answers[row]=[]),answers[row][column]=value,this.props.onChange({answers:answers},cb),this.props.trackInteraction()},getUserInput:function(){return{answers:this.props.answers}},simpleValidate:function(rubric){return Matrix.validate(this.getUserInput(),rubric)}});_.extend(Matrix,{validate:function(state,rubric){var solution=rubric.answers,supplied=state.answers,solutionSize=getMatrixSize(solution),suppliedSize=getMatrixSize(supplied),incorrectSize=solutionSize[0]!==suppliedSize[0]||solutionSize[1]!==suppliedSize[1],createValidator=KhanAnswerTypes.number.createValidatorFunctional,message=null,hasEmptyCell=!1,incorrect=!1;return _(suppliedSize[0]).times(function(row){_(suppliedSize[1]).times(function(col){null!=supplied[row][col]&&0!==supplied[row][col].toString().length||(hasEmptyCell=!0);var result=createValidator(solution[row][col],{simplify:!0})(supplied[row][col]);result.message&&(message=result.message),result.correct||(incorrect=!0)})}),hasEmptyCell?{type:"invalid",message:i18n._("Make sure you fill in all cells in the matrix.")}:incorrectSize?{type:"points",earned:0,total:1,message:null}:{type:"points",earned:incorrect?0:1,total:1,message:message}}});module.exports={name:"matrix",displayName:"Matrix",widget:Matrix,transform:function(editorProps){var blankAnswers=_(editorProps.matrixBoardSize[0]).times(function(){return stringArrayOfSize(editorProps.matrixBoardSize[1])});return editorProps=_.pick(editorProps,"matrixBoardSize","prefix","suffix"),_.extend(editorProps,{answers:blankAnswers})},staticTransform:function(editorProps){var widgetProps=_.pick(editorProps,"matrixBoardSize","prefix","suffix");return widgetProps.answers=_.map(editorProps.answers,function(row){return _.map(row,function(cell){return null!=cell?String(cell):""})}),widgetProps},isLintable:!0}}).call(this,__webpack_require__(21))},671:function(module,exports,__webpack_require__){var React=__webpack_require__(0),_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,_=__webpack_require__(1),Renderer=__webpack_require__(33),Sortable=__webpack_require__(647),ApiOptions=__webpack_require__(13).Options,shuffle=__webpack_require__(19).shuffle,seededRNG=__webpack_require__(19).seededRNG,_require2=__webpack_require__(25),linterContextProps=_require2.linterContextProps,linterContextDefault=_require2.linterContextDefault,Matcher=React.createClass({displayName:"Matcher",propTypes:{apiOptions:ApiOptions.propTypes,labels:React.PropTypes.array,left:React.PropTypes.array,onChange:React.PropTypes.func,orderMatters:React.PropTypes.bool,padding:React.PropTypes.bool,problemNum:React.PropTypes.number,right:React.PropTypes.array,trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps},getDefaultProps:function(){return{left:[],right:[],labels:["",""],orderMatters:!1,padding:!0,problemNum:0,onChange:function(){},linterContext:linterContextDefault}},getInitialState:function(){return{leftHeight:0,rightHeight:0}},render:function(){var left,rng=seededRNG(this.props.problemNum);left=this.props.orderMatters?shuffle(this.props.left,rng,!0):this.props.left;var right=shuffle(this.props.right,rng,!0),showLabels=_.any(this.props.labels),constraints={height:_.max([this.state.leftHeight,this.state.rightHeight])},cellMarginPx=this.props.apiOptions.isMobile?8:5;return React.createElement("table",{className:css(styles.widget)+" perseus-widget-matcher"},React.createElement("tbody",null,showLabels&&React.createElement("tr",{className:css(styles.row)},React.createElement("th",{className:css(styles.column,styles.columnLabel)},React.createElement(Renderer,{content:this.props.labels[0]||"...",linterContext:this.props.linterContext})),React.createElement("th",{className:css(styles.column,styles.columnRight,styles.columnLabel)},React.createElement(Renderer,{content:this.props.labels[1]||"...",linterContext:this.props.linterContext}))),React.createElement("tr",{className:css(styles.row)},React.createElement("td",{className:css(styles.column)},React.createElement(Sortable,{options:left,layout:"vertical",padding:this.props.padding,disabled:!this.props.orderMatters,constraints:constraints,onMeasure:this.onMeasureLeft,onChange:this.changeAndTrack,margin:cellMarginPx,linterContext:this.props.linterContext,ref:"left"})),React.createElement("td",{className:css(styles.column,styles.columnRight)},React.createElement(Sortable,{options:right,layout:"vertical",padding:this.props.padding,constraints:constraints,onMeasure:this.onMeasureRight,onChange:this.changeAndTrack,margin:cellMarginPx,linterContext:this.props.linterContext,ref:"right"})))))},changeAndTrack:function(e){this.props.onChange(e),this.props.trackInteraction()},onMeasureLeft:function(dimensions){var height=_.max(dimensions.heights);this.setState({leftHeight:height})},onMeasureRight:function(dimensions){var height=_.max(dimensions.heights);this.setState({rightHeight:height})},getUserInput:function(){return{left:this.refs.left.getOptions(),right:this.refs.right.getOptions()}},simpleValidate:function(rubric){return Matcher.validate(this.getUserInput(),rubric)}});_.extend(Matcher,{validate:function(state,rubric){return{type:"points",earned:_.isEqual(state.left,rubric.left)&&_.isEqual(state.right,rubric.right)?1:0,total:1,message:null}}});var styles=StyleSheet.create({widget:{paddingTop:5,maxWidth:"100%",minWidth:"auto"},row:{border:0},column:{padding:0,border:0},columnRight:{borderLeft:"1px solid #444"},columnLabel:{fontWeight:"inherit",borderBottom:"1px solid #444",padding:"0 5px 5px 5px",textAlign:"center"}});module.exports={name:"matcher",displayName:"Two column matcher",widget:Matcher,isLintable:!0}},672:function(module,exports,__webpack_require__){(function($){var React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_2=__webpack_require__(1),ApiOptions=__webpack_require__(13).Options,GraphUtils=__webpack_require__(157),defaultImage={url:null,top:0,left:0},Measurer=React.createClass({displayName:"Measurer",propTypes:{apiOptions:ApiOptions.propTypes,box:React.PropTypes.arrayOf(React.PropTypes.number),image:React.PropTypes.shape({url:React.PropTypes.string,top:React.PropTypes.number,left:React.PropTypes.number}),showProtractor:React.PropTypes.bool,protractorX:React.PropTypes.number,protractorY:React.PropTypes.number,showRuler:React.PropTypes.bool,rulerLabel:React.PropTypes.string,rulerTicks:React.PropTypes.number,rulerPixels:React.PropTypes.number,rulerLength:React.PropTypes.number},getDefaultProps:function(){return{box:[480,480],image:{},showProtractor:!0,protractorX:7.5,protractorY:.5,showRuler:!1,rulerLabel:"",rulerTicks:10,rulerPixels:40,rulerLength:10}},getInitialState:function(){return{}},render:function(){var image=_2.extend({},defaultImage,this.props.image);return React.createElement("div",{className:"perseus-widget perseus-widget-measurer graphie-container above-scratchpad",style:{width:this.props.box[0],height:this.props.box[1]}},image.url&&React.createElement("img",{src:image.url,style:{top:image.top,left:image.left}}),React.createElement("div",{className:"graphie",ref:"graphieDiv"}))},componentDidMount:function(){this.setupGraphie()},componentDidUpdate:function(prevProps){_2.any(["box","showProtractor","showRuler","rulerLabel","rulerTicks","rulerPixels","rulerLength"],function(prop){return prevProps[prop]!==this.props[prop]},this)&&this.setupGraphie()},setupGraphie:function(){var graphieDiv=ReactDOM.findDOMNode(this.refs.graphieDiv);$(graphieDiv).empty();var graphie=this.graphie=GraphUtils.createGraphie(graphieDiv),scale=[40,40],range=[[0,this.props.box[0]/scale[0]],[0,this.props.box[1]/scale[1]]];graphie.init({range:range,scale:scale}),graphie.addMouseLayer({allowScratchpad:!0,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable}),this.protractor&&this.protractor.remove(),this.props.showProtractor&&(this.protractor=graphie.protractor([this.props.protractorX,this.props.protractorY])),this.ruler&&this.ruler.remove(),this.props.showRuler&&(this.ruler=graphie.ruler({center:[(range[0][0]+range[0][1])/2,(range[1][0]+range[1][1])/2],label:this.props.rulerLabel,pixelsPerUnit:this.props.rulerPixels,ticksPerUnit:this.props.rulerTicks,units:this.props.rulerLength}))},getUserInput:function(){return{}},simpleValidate:function(rubric){return Measurer.validate(this.getUserInput(),rubric)},focus:$.noop});_2.extend(Measurer,{validate:function(state,rubric){return{type:"points",earned:1,total:1,message:null}}});var propUpgrades={1:function(v0props){return _2(v0props).chain().omit("imageUrl","imageTop","imageLeft").extend({image:{url:v0props.imageUrl,top:v0props.imageTop,left:v0props.imageLeft}}).value()}};module.exports={name:"measurer",displayName:"Measurer",widget:Measurer,version:{major:1,minor:0},propUpgrades:propUpgrades}}).call(this,__webpack_require__(10))},673:function(module,exports){function drawLine(ctx,item){var path=new Path2D;ctx.lineWidth=styles.lineWidth,ctx.strokeStyle=styles.fgColor,path.moveTo(item.startPos[0],item.startPos[1]),path.lineTo(item.endPos[0],item.endPos[1]),ctx.stroke(path)}var drawingFuncs={text:function(ctx,item){null!==item.value&&(ctx.fillStyle=styles.fgColor,ctx.font=styles.font,ctx.fillText(item.value,item.pos[0]-styles.fontSizePx/2+1,item.pos[1]+styles.fontSizePx/2))},"line:single":drawLine,"line:double":function(ctx,item){var path=new Path2D;ctx.lineWidth=5*styles.lineWidth,ctx.strokeStyle=styles.fgColor,path.moveTo(item.startPos[0],item.startPos[1]),path.lineTo(item.endPos[0],item.endPos[1]),ctx.stroke(path),path=new Path2D,ctx.lineWidth=3*styles.lineWidth,ctx.strokeStyle=styles.bgColor,path.moveTo(item.startPos[0],item.startPos[1]),path.lineTo(item.endPos[0],item.endPos[1]),ctx.stroke(path)},"line:triple":function(ctx,item){var path=new Path2D;ctx.lineWidth=7*styles.lineWidth,ctx.strokeStyle=styles.fgColor,path.moveTo(item.startPos[0],item.startPos[1]),path.lineTo(item.endPos[0],item.endPos[1]),ctx.stroke(path),path=new Path2D,ctx.lineWidth=5*styles.lineWidth,ctx.strokeStyle=styles.bgColor,path.moveTo(item.startPos[0],item.startPos[1]),path.lineTo(item.endPos[0],item.endPos[1]),ctx.stroke(path),drawLine(ctx,item)}};var ordering={"line:single":0,"line:double":0,"line:triple":0,text:1};function compareElements(item0,item1){return ordering[item0.type]-ordering[item1.type]}var styles={bgColor:"rgb(255, 255, 255)",fgColor:"rgb(0, 0, 0)",fontSizePx:12,lineWidth:1};styles.font=styles.fontSizePx+"px sans",module.exports=function(ctx,items){items.sort(compareElements).forEach(function(ctx){return function(item){drawingFuncs[item.type](ctx,item)}}(ctx))}},674:function(module,exports){var bondLength=30;function atomLayout(atom,atoms,bonds,rotationAngle){var textValue=atom.symbol;if("C"===textValue&&1!==Object.keys(atoms).length&&(textValue=null),"1,0"===atom.idx){var _pos=[0,0];return atom.pos=_pos,atom.baseAngle=-30+rotationAngle,{type:"text",value:textValue,pos:_pos,idx:atom.idx}}var prevPositionedAtom=atoms[atom.connections.find(function(c){return atoms[c].pos})],myIndex=prevPositionedAtom.connections.indexOf(atom.idx),baseAngleIncrement=60,angleIncrement=120;4===prevPositionedAtom.connections.length?(angleIncrement=90,baseAngleIncrement=90):(bonds.find(function(bond){return"triple"===bond.bondType&&bond.to===atom.idx})||bonds.find(function(bond){return"triple"===bond.bondType&&bond.to===prevPositionedAtom.idx}))&&(angleIncrement=0,baseAngleIncrement=0);var angle,idxPath=prevPositionedAtom.idx.split(":"),lastAtomIdx=idxPath[idxPath.length-1].split(",")[0];angle=parseInt(lastAtomIdx)%2!=0?prevPositionedAtom.baseAngle-(baseAngleIncrement-angleIncrement*myIndex):prevPositionedAtom.baseAngle+(baseAngleIncrement-angleIncrement*myIndex);var pos=function(origin,angle,length){var x=origin[0],y=origin[1];return[x+Math.cos(2*angle*Math.PI/360)*length,y+-1*Math.sin(2*angle*Math.PI/360)*length]}(prevPositionedAtom.pos,angle,bondLength);return atom.pos=pos,atom.baseAngle=angle,{type:"text",value:textValue,pos:pos,idx:atom.idx}}function bondLayout(bond,atoms){var startAndEndPos=function(fromAtom,toAtom){var fromPos=[fromAtom.pos[0],fromAtom.pos[1]],toPos=[toAtom.pos[0],toAtom.pos[1]];return"C"!==fromAtom.symbol&&(fromPos=[toAtom.pos[0]-.75*(toAtom.pos[0]-fromAtom.pos[0]),toAtom.pos[1]-.75*(toAtom.pos[1]-fromAtom.pos[1])]),"C"!==toAtom.symbol&&(toPos=[fromAtom.pos[0]-.75*(fromAtom.pos[0]-toAtom.pos[0]),fromAtom.pos[1]-.75*(fromAtom.pos[1]-toAtom.pos[1])]),[fromPos,toPos]}(atoms[bond.from],atoms[bond.to]);return{type:"line:"+bond.bondType,startPos:startAndEndPos[0],endPos:startAndEndPos[1]}}function idxString(idx){return idx.join(":")}function convertTree(atoms,bonds,tree){if(null===tree)return[atoms,bonds];if("atom"===tree.type){var treeIdx=idxString(tree.idx);atoms[treeIdx]={idx:treeIdx,symbol:tree.symbol,connections:[]},tree.bonds&&tree.bonds.forEach(function(b){var toIdx=idxString(b.to.idx);atoms[treeIdx].connections.push(toIdx),bonds.push({from:treeIdx,to:toIdx,bondType:b.bondType}),convertTree(atoms,bonds,b.to),atoms[toIdx].connections.push(treeIdx)})}return[atoms,bonds]}module.exports={layout:function(tree,rotationAngle){var converted=convertTree({},[],tree),atoms=converted[0],bonds=converted[1];return function bondLayoutHelper(outputs,atoms,bonds){return 0===bonds.length?outputs:bondLayoutHelper(outputs.concat(bondLayout(bonds[0],atoms)),atoms,bonds.slice(1))}(function atomLayoutHelper(outputs,atomProcessingQueue,atoms,bonds,rotationAngle){if(0===atomProcessingQueue.length)return outputs;var queuedAtomIdx=atomProcessingQueue.shift(),atom=atoms[queuedAtomIdx];return atom.connections.forEach(function(c){atoms[c].pos||atomProcessingQueue.push(c)}),atomLayoutHelper(outputs.concat(atomLayout(atom,atoms,bonds,rotationAngle)),atomProcessingQueue,atoms,bonds,rotationAngle)}([],["1,0"],atoms,bonds,rotationAngle),atoms,bonds)},_atomLayout:atomLayout,_bondLayout:bondLayout,_bondLength:bondLength,_convertTree:convertTree}},675:function(module,exports){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},smilesRe=new RegExp("^[A-Za-z\\[\\]()=#+-]*$"),atomRe=new RegExp("^(Cl|Br|[CONPSFBI]|\\[)");function ParseError(message){this.message=message}function _mset(obj,keylist,val){var k0=keylist[0],rest=keylist.slice(1),newObj=void 0;newObj=Array.isArray(obj)?[].concat(obj):_extends({},obj||{});var newVal=val;return rest.length>0&&(newVal=_mset(newObj[k0],rest,val)),newObj[k0]=newVal,newObj}function parseParenthesizedExpression(smiles,ctx){var obj,keylist,firstChar=smiles[0],rest=smiles.slice(1);if("("===firstChar){var newCtx=_extends({},ctx,{parens:ctx.parens+"("});obj=ctx,keylist=["idx",ctx.idx.length-1,1],newCtx=_mset(obj,keylist,keylist.reduce(function(acc,elt){return acc[elt]},obj)+1);var inBranchIdx=-1;return ctx.idx[ctx.idx.length-1][0]%2==0&&(inBranchIdx=0),[parse(rest,_extends({},newCtx,{idx:newCtx.idx.concat([[inBranchIdx,0]]),parens:newCtx.parens.concat("(")}))].concat(parse(function sliceFromMatchingCloseParen(smiles,parenStack){if(0===parenStack.length)return smiles;if(""===smiles)throw new ParseError("Mismatched parentheses");var firstChar=smiles[0],rest=smiles.slice(1);return sliceFromMatchingCloseParen(rest,"("===firstChar?parenStack.concat(firstChar):")"===firstChar?parenStack.slice(1):parenStack)}(rest,["("]),newCtx))}if(")"===firstChar){if("("!==ctx.parens[ctx.parens.length-1])throw new ParseError("Mismatched parentheses");return null}throw new ParseError("Invalid bare character: "+firstChar)}function parseAtom(smiles,ctx){var symbolInfo=function(smiles,_ctx){var sym=null,rest=null;if("["===smiles[0]){var closingIdx=smiles.indexOf("]");if(-1===closingIdx)return["",smiles];sym=smiles.slice(1,closingIdx),rest=smiles.slice(closingIdx+1)}else sym=atomRe.exec(smiles)[1],rest=smiles.slice(sym.length);return[sym,rest]}(smiles),atom=symbolInfo[0];if(""===atom)return["error","Unable to parse bracketed atom."];var rest=symbolInfo[1],newCtx=_mset(ctx,["idx",ctx.idx.length-1],[1+ctx.idx[ctx.idx.length-1][0],0]),restOfMolecule=parse(rest,_mset(newCtx,["bond","bondType"],"single"));Array.isArray(restOfMolecule)||!restOfMolecule||(restOfMolecule=[restOfMolecule]);var atomObj={type:"atom",symbol:atom,bonds:restOfMolecule,idx:newCtx.idx};return ctx.bond?{type:"bond",bondType:ctx.bond.bondType,to:atomObj}:atomObj}function parse(smiles,ctx){if(!function(smiles){return smilesRe.test(smiles)}(smiles))throw new ParseError("Invalid input.");return smiles&&0!==smiles.length?(s=smiles,atomRe.test(s)?parseAtom(smiles,ctx||{idx:[[0,0]],parens:[],stack:[],bondModifiers:[]}):function(s){return"="===s||"#"===s}(smiles[0])?function(smiles,ctx){var firstChar=smiles[0],rest=smiles.slice(1);if("="===firstChar)return parse(rest,_mset(ctx,["bond","bondType"],"double"));if("#"===firstChar)return parse(rest,_mset(ctx,["bond","bondType"],"triple"));throw new ParseError("Invalid character: "+firstChar)}(smiles,ctx):parseParenthesizedExpression(smiles,ctx)):null;var s}module.exports={parse:parse,ParseError:ParseError}},676:function(module,exports,__webpack_require__){(function(i18n,$_){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),Changeable=__webpack_require__(156),NumberInput=__webpack_require__(642),MathOutput=__webpack_require__(267),SimpleKeypadInput=__webpack_require__(158),ApiOptions=__webpack_require__(13).Options,keypadElementPropType=__webpack_require__(28).propTypes.keypadElementPropType,Graphie=__webpack_require__(268),MovablePoint=Graphie.MovablePoint,Line=Graphie.Line,knumber=__webpack_require__(9).number,KhanMath=__webpack_require__(44),KhanColors=__webpack_require__(43),assert=__webpack_require__(34).assert,reverseRel={ge:"le",gt:"lt",le:"ge",lt:"gt"},toggleStrictRel={ge:"gt",gt:"ge",le:"lt",lt:"le"};function formatImproper(n,d){return 1===d?""+n:"\\dfrac{"+n+"}{"+d+"}"}var _label=function(graphie,labelStyle,pos,value,base){if(value=value||pos,"decimal"===labelStyle||"decimal ticks"===labelStyle)return graphie.label([pos,-.53],Math.round(100*value)/100,"center");if("improper"===labelStyle){var frac=KhanMath.toFraction(value);return graphie.label([pos,-.17],formatImproper(frac[0],frac[1]),"below")}if("mixed"===labelStyle){var _frac=KhanMath.toFraction(value);return graphie.label([pos,-.17],function formatMixed(n,d){if(n<0)return"-"+formatMixed(-n,d);var w=Math.floor(n/d);return 0===w?formatImproper(n,d):n-w*d==0?""+w:w+formatImproper(n-w*d,d)}(_frac[0],_frac[1]),"below")}if("non-reduced"===labelStyle){var _frac2=KhanMath.toFraction(value);return graphie.label([pos,-.17],function(n,d,base){return formatImproper(n*Math.floor(base/d),base)}(_frac2[0],_frac2[1],base),"below")}},TickMarks=Graphie.createSimpleClass(function(graphie,props){if(!_.isFinite(props.tickStep)||props.tickStep<=0)return[];var base,results=[],range=props.range,labelRange=props.labelRange,leftLabel=null==labelRange[0]?range[0]:labelRange[0],rightLabel=null==labelRange[1]?range[1]:labelRange[1];if("non-reduced"===props.labelStyle){for(var fractions=[leftLabel,rightLabel],i=0;i<=props.numDivisions;i++){var x=range[0]+i*props.tickStep;fractions.push(x)}var denoms=_.map(fractions,function(x){return knumber.toFraction(x)[1]});base=_.reduce(denoms,function(x,y){return KhanMath.getLCM(x,y)})}else base=void 0;for(var _i=0;_i<=props.numDivisions;_i++){var _x=range[0]+_i*props.tickStep;results.push(graphie.line([_x,-.2],[_x,.2])),(props.labelTicks||"decimal ticks"===props.labelStyle)&&results.push(_label(graphie,props.labelStyle,_x,_x,base))}return results.push(graphie.style(props.isMobile?{color:KhanColors.BLUE_D}:{},function(){return _label(graphie,props.labelStyle,leftLabel,leftLabel,base)})),results.push(graphie.style(props.isMobile?{color:KhanColors.BLUE_D}:{},function(){return _label(graphie,props.labelStyle,rightLabel,rightLabel,base)})),graphie.style({stroke:props.isMobile?KhanColors.BLUE_D:KhanColors.DYNAMIC,strokeWidth:3.5},function(){results.push(graphie.line([leftLabel,-.2],[leftLabel,.2])),results.push(graphie.line([rightLabel,-.2],[rightLabel,.2]))}),results}),NumberLine=React.createClass({displayName:"NumberLine",propTypes:_extends({},Changeable.propTypes,{range:React.PropTypes.arrayOf(React.PropTypes.number).isRequired,labelRange:React.PropTypes.arrayOf(React.PropTypes.number).isRequired,labelStyle:React.PropTypes.string.isRequired,labelTicks:React.PropTypes.bool.isRequired,divisionRange:React.PropTypes.arrayOf(React.PropTypes.number).isRequired,numDivisions:React.PropTypes.number.isRequired,snapDivisions:React.PropTypes.number.isRequired,isTickCtrl:React.PropTypes.bool.isRequired,isInequality:React.PropTypes.bool.isRequired,numLinePosition:React.PropTypes.number.isRequired,rel:React.PropTypes.oneOf(["lt","gt","le","ge"]),onFocus:React.PropTypes.func.isRequired,onBlur:React.PropTypes.func.isRequired,onChange:React.PropTypes.func.isRequired,apiOptions:ApiOptions.propTypes,keypadElement:keypadElementPropType,static:React.PropTypes.bool,showTooltips:React.PropTypes.bool,trackInteraction:React.PropTypes.func.isRequired}),getDefaultProps:function(){return{range:[0,10],labelStyle:"decimal",labelRange:[null,null],divisionRange:[1,12],labelTicks:!0,isTickCtrl:!1,isInequality:!1,numLinePosition:0,snapDivisions:2,showTooltips:!1,rel:"ge",apiOptions:ApiOptions.defaults}},getInitialState:function(){return{numDivisionsEmpty:!1}},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},isValid:function(){var range=this.props.range,initialX=this.props.numLinePosition,divisionRange=this.props.divisionRange;return initialX=null==initialX?range[0]:initialX,range[0]<range[1]&&knumber.sign(initialX-range[0])>=0&&knumber.sign(initialX-range[1])<=0&&divisionRange[0]<divisionRange[1]&&0<this.props.numDivisions&&0<this.props.snapDivisions},onNumDivisionsChange:function(numDivisions,cb){var _this=this,divRange=this.props.divisionRange.slice(),width=this.props.range[1]-this.props.range[0];if(numDivisions=(numDivisions=Math.round(numDivisions))<0?-1*numDivisions:numDivisions){var nextProps=_.extend({},this.props,{tickStep:width/numDivisions}),newNumLinePosition=this.snapNumLinePosition(nextProps,this.props.numLinePosition);this.setState({numDivisionsEmpty:!1},function(){_this.props.onChange({divisionRange:divRange,numDivisions:numDivisions,numLinePosition:newNumLinePosition},cb)})}else this.setState({numDivisionsEmpty:!0},cb)},_handleTickCtrlFocus:function(){this.props.onFocus(["tick-ctrl"])},_handleTickCtrlBlur:function(){this.props.onBlur(["tick-ctrl"])},focus:function(){if(this.props.isTickCtrl)return this.refs["tick-ctrl"].focus(),!0},focusInputPath:function(path){1===path.length&&this.refs[path[0]].focus()},blurInputPath:function(path){1===path.length&&this.refs[path[0]].blur()},getInputPaths:function(){return this.props.isTickCtrl?[["tick-ctrl"]]:[]},getDOMNodeForPath:function(inputPath){if(1===inputPath.length)return ReactDOM.findDOMNode(this.refs[inputPath[0]])},getGrammarTypeForPath:function(inputPath){if(1===inputPath.length&&"tick-ctrl"===inputPath[0])return"number"},setInputValue:function(inputPath,value,callback){1===inputPath.length&&"tick-ctrl"===inputPath[0]&&this.onNumDivisionsChange(value,callback)},_renderGraphie:function(){var _this2=this,range=this.props.range,width=range[1]-range[0],options=_.pick(this.props,["range","isTickCtrl"]),props=_.extend({},this.props,{tickStep:width/this.props.numDivisions});return React.createElement(Graphie,{ref:"graphie",key:this.props.labelStyle,box:[this.props.apiOptions.isMobile?288:460,80],options:options,onMouseDown:function(coord){_this2.refs.graphie.movables.numberLinePoint.grab(coord)},setup:this._setupGraphie,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable,isMobile:this.props.apiOptions.isMobile},React.createElement(TickMarks,_extends({},_.pick(props,["range","numDivisions","labelTicks","labelStyle","labelRange","tickStep"]),{isMobile:this.props.apiOptions.isMobile})),this._renderInequality(props),this._renderNumberLinePoint(props))},snapNumLinePosition:function(props,numLinePosition){var left=props.range[0],right=props.range[1],snapX=props.tickStep/props.snapDivisions,x=function(x,gt,lt){return Math.min(Math.max(x,gt),lt)}(numLinePosition,left,right);return x=left+knumber.roundTo(x-left,snapX),assert(_.isFinite(x)),x},_renderNumberLinePoint:function(props){var _this3=this,isOpen=_(["lt","gt"]).contains(props.rel),normalStyle={fill:isOpen?KhanColors._BACKGROUND:props.static?KhanColors.DYNAMIC:KhanColors.INTERACTIVE,stroke:props.static?KhanColors.DYNAMIC:KhanColors.INTERACTIVE,"stroke-width":isOpen?3:1},highlightStyle={fill:isOpen?KhanColors._BACKGROUND:KhanColors.INTERACTING,"stroke-width":isOpen?3:1},mobileDotStyle=props.isInequality?{stroke:KhanColors.INTERACTIVE,"fill-opacity":isOpen?0:1}:{};return React.createElement(MovablePoint,{ref:"numberLinePoint",pointSize:6,coord:[props.numLinePosition,0],constraints:[function(coord,prevCoord){return[coord[0],prevCoord[1]]},function(coord,prevCoord){return[_this3.snapNumLinePosition(props,coord[0]),coord[1]]}],normalStyle:normalStyle,highlightStyle:highlightStyle,onMove:function(coord){_this3.change({numLinePosition:coord[0]}),_this3.props.trackInteraction()},isMobile:this.props.apiOptions.isMobile,mobileStyleOverride:mobileDotStyle,showTooltips:this.props.showTooltips,xOnlyTooltip:!0})},handleReverse:function(){var newRel=reverseRel[this.props.rel];this.props.onChange({rel:newRel})},handleToggleStrict:function(){var newRel=toggleStrictRel[this.props.rel];this.props.onChange({rel:newRel})},_getInequalityEndpoint:function(props){var isGreater=_(["ge","gt"]).contains(props.rel),range=props.range,buffer=30*((range[1]-range[0])/400),left=range[0]-buffer,right=range[1]+buffer;return isGreater?[right,0]:[left,0]},_renderInequality:function(props){if(props.isInequality){var end=this._getInequalityEndpoint(props),style={arrows:"->",stroke:this.props.apiOptions.isMobile?KhanColors.INTERACTIVE:KhanColors.DYNAMIC,strokeWidth:3.5},isGreater=["ge","gt"].includes(props.rel);return React.createElement(Line,{start:[(isGreater?.4:-.4)+props.numLinePosition,0],end:end,style:style})}return null},_setupGraphie:function(graphie,options){if(this.isValid()){var widthInPixels=this.props.apiOptions.isMobile?228:400,range=options.range,scale=(range[1]-range[0])/widthInPixels,buffer=30*scale,left=range[0]-buffer,right=range[1]+buffer,bottom="improper"===this.props.labelStyle||"mixed"===this.props.labelStyle||"non-reduced"===this.props.labelStyle?-1.5:-1;graphie.init({range:[[left,right],[bottom,1]],scale:[1/scale,40],isMobile:this.props.apiOptions.isMobile});var center=(range[0]+range[1])/2;graphie.line([center,0],[right,0],{arrows:"->"}),graphie.line([center,0],[left,0],{arrows:"->"})}},getUserInput:function(){return{numLinePosition:this.props.numLinePosition,rel:this.props.isInequality?this.props.rel:"eq",numDivisions:this.props.numDivisions,divisionRange:this.props.divisionRange}},simpleValidate:function(rubric){return NumberLine.validate(this.getUserInput(),rubric)},render:function(){var tickCtrl,Input,divisionRange=this.props.divisionRange,divRangeString=divisionRange[0]+""+divisionRange[1],invalidNumDivisions=this.props.numDivisions<divisionRange[0]||this.props.numDivisions>divisionRange[1],inequalityControls=React.createElement("div",null,React.createElement("input",{type:"button",className:"simple-button",value:i18n._("Switch direction"),onClick:this.handleReverse}),React.createElement("input",{type:"button",className:"simple-button",value:_(["le","ge"]).contains(this.props.rel)?i18n._("Make circle open"):i18n._("Make circle filled"),onClick:this.handleToggleStrict}));this.props.isTickCtrl&&(Input=this.props.apiOptions.customKeypad?SimpleKeypadInput:this.props.apiOptions.staticRender?MathOutput:NumberInput,tickCtrl=React.createElement("label",null,i18n._("Number of divisions:")," ",React.createElement(Input,{ref:"tick-ctrl",value:this.state.numDivisionsEmpty?null:this.props.numDivisions||divisionRange[0],checkValidity:function(val){return val>=divisionRange[0]&&val<=divisionRange[1]},onChange:this.onNumDivisionsChange,onFocus:this._handleTickCtrlFocus,onBlur:this._handleTickCtrlBlur,useArrowKeys:!0,keypadElement:this.props.keypadElement})));return React.createElement("div",{className:"perseus-widget perseus-widget-interactive-number-line"},tickCtrl,this.isValid()?this.props.isTickCtrl&&invalidNumDivisions?React.createElement("div",{className:"perseus-error"},$_({divRangeString:divRangeString},"Please make sure the number of divisions is in the range { divRangeString }.")):this._renderGraphie():React.createElement("div",{className:"perseus-error"},"Invalid number line configuration."),!this.props.static&&this.props.isInequality&&inequalityControls)}});_.extend(NumberLine,{validate:function(state,rubric){var range=rubric.range,divisionRange=state.divisionRange,start=null!=rubric.initialX?rubric.initialX:range[0],startRel=rubric.isInequality?"ge":"eq",correctRel=rubric.correctRel||"eq",correctPos=knumber.equal(state.numLinePosition,rubric.correctX||0),outsideAllowedRange=state.numDivisions>divisionRange[1]||state.numDivisions<divisionRange[0];return state.isTickCrtl&&outsideAllowedRange?{type:"invalid",message:"Number of divisions is outside the allowed range."}:correctPos&&correctRel===state.rel?{type:"points",earned:1,total:1,message:null}:state.numLinePosition===start&&state.rel===startRel?{type:"invalid",message:null}:{type:"points",earned:0,total:1,message:null}}});module.exports={name:"number-line",displayName:"Number line",widget:NumberLine,transform:function(editorProps){var numDivisions,props=_.pick(editorProps,["range","labelRange","labelStyle","labelTicks","divisionRange","snapDivisions","isTickCtrl","isInequality","showTooltips"]),numLinePosition=null!=editorProps.initialX?editorProps.initialX:editorProps.range[0],width=editorProps.range[1]-editorProps.range[0];return numDivisions=null!=editorProps.numDivisions?editorProps.numDivisions:null!=editorProps.tickStep?width/editorProps.tickStep:void 0,_.extend(props,{numLinePosition:numLinePosition,numDivisions:numDivisions,snapDivisions:props.snapDivisions||void 0}),props},staticTransform:function(editorProps){var numDivisions,props=_.pick(editorProps,["range","labelRange","labelStyle","labelTicks","divisionRange","snapDivisions","isInequality"]),numLinePosition=null!=editorProps.correctX?editorProps.correctX:editorProps.range[0],width=editorProps.range[1]-editorProps.range[0];return numDivisions=null!=editorProps.numDivisions?editorProps.numDivisions:null!=editorProps.tickStep?width/editorProps.tickStep:void 0,_.extend(props,{numLinePosition:numLinePosition,numDivisions:numDivisions,rel:editorProps.isInequality?editorProps.correctRel:null,snapDivisions:props.snapDivisions||void 0}),props}}}).call(this,__webpack_require__(21),__webpack_require__(272))},677:function(module,exports,__webpack_require__){(function($){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),Renderer=__webpack_require__(33),Util=__webpack_require__(19),ApiClassNames=__webpack_require__(13).ClassNames,_require=__webpack_require__(25),linterContextProps=_require.linterContextProps,linterContextDefault=_require.linterContextDefault,PlaceholderCard=React.createClass({displayName:"PlaceholderCard",propTypes:{width:React.PropTypes.number.isRequired,height:React.PropTypes.number.isRequired},render:function(){return React.createElement("div",{className:"card-wrap "+ApiClassNames.INTERACTIVE,style:{width:this.props.width}},React.createElement("div",{className:"card placeholder",style:{height:this.props.height}}))}}),DragHintCard=React.createClass({displayName:"DragHintCard",render:function(){return React.createElement("div",{className:"card-wrap "+ApiClassNames.INTERACTIVE},React.createElement("div",{className:"card drag-hint"}))}}),PropTypes={position:React.PropTypes.shape({left:React.PropTypes.number,top:React.PropTypes.number})},Card=React.createClass({displayName:"Card",propTypes:{floating:React.PropTypes.bool.isRequired,animating:React.PropTypes.bool,width:React.PropTypes.number,stack:React.PropTypes.bool,onMouseDown:React.PropTypes.func,onMouseMove:React.PropTypes.func,onMouseUp:React.PropTypes.func,startMouse:PropTypes.position,startOffset:PropTypes.position,animateTo:PropTypes.position,onAnimationEnd:React.PropTypes.func,linterContext:linterContextProps},getDefaultProps:function(){return{stack:!1,animating:!1,linterContext:linterContextDefault}},render:function(){var style={};this.props.floating&&(style={position:"absolute",left:this.props.startOffset.left,top:this.props.startOffset.top}),this.props.width&&(style.width=this.props.width);var className=["card"];this.props.stack&&className.push("stack"),this.props.floating&&!this.props.animating&&(className.push("dragging"),style.left+=this.props.mouse.left-this.props.startMouse.left,style.top+=this.props.mouse.top-this.props.startMouse.top);var rendererProps=_.pick(this.props,"content"),onMouseDown=this.props.animating?$.noop:this.onMouseDown;return React.createElement("div",{className:"card-wrap "+ApiClassNames.INTERACTIVE,style:style,onMouseDown:onMouseDown,onTouchStart:onMouseDown,onTouchMove:this.onMouseMove,onTouchEnd:this.onMouseUp,onTouchCancel:this.onMouseUp},React.createElement("div",{className:className.join(" ")},React.createElement(Renderer,_extends({},rendererProps,{linterContext:this.props.linterContext}))))},shouldComponentUpdate:function(nextProps,nextState){return this.props.floating||nextProps.floating||this.props.content!==nextProps.content||this.props.fakeRef!==nextProps.fakeRef},componentDidMount:function(){this.mouseMoveUpBound=!1},componentDidUpdate:function(prevProps,prevState){if(this.props.animating&&!prevProps.animating){var ms=15*Math.sqrt(Math.sqrt(Math.pow(this.props.animateTo.left-this.props.startOffset.left,2)+Math.pow(this.props.animateTo.top-this.props.startOffset.top,2)));$(ReactDOM.findDOMNode(this)).animate(this.props.animateTo,Math.max(ms,1),this.props.onAnimationEnd)}},componentWillUnmount:function(){this.mouseMoveUpBound&&(console.warn("Removing an element with bound event handlers."),this.unbindMouseMoveUp(),Util.resetTouchHandlers())},bindMouseMoveUp:function(){this.mouseMoveUpBound=!0,$(document).on("mousemove",this.onMouseMove),$(document).on("mouseup",this.onMouseUp)},unbindMouseMoveUp:function(){this.mouseMoveUpBound=!1,$(document).off("mousemove",this.onMouseMove),$(document).off("mouseup",this.onMouseUp)},onMouseDown:function(event){event.preventDefault();var loc=Util.extractPointerLocation(event);loc&&(this.bindMouseMoveUp(),this.props.onMouseDown&&this.props.onMouseDown(loc,this))},onMouseMove:function(event){event.preventDefault();var loc=Util.extractPointerLocation(event);loc&&this.props.onMouseMove&&this.props.onMouseMove(loc)},onMouseUp:function(event){event.preventDefault();var loc=Util.extractPointerLocation(event);loc&&(this.unbindMouseMoveUp(),this.props.onMouseUp&&this.props.onMouseUp(loc))}}),Orderer=React.createClass({displayName:"Orderer",propTypes:{correctOptions:React.PropTypes.array,current:React.PropTypes.array,height:React.PropTypes.oneOf(["normal","auto"]),layout:React.PropTypes.oneOf(["horizontal","vertical"]),options:React.PropTypes.array,trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps},getDefaultProps:function(){return{current:[],options:[],correctOptions:[],height:"normal",layout:"horizontal",linterContext:linterContextDefault}},getInitialState:function(){return{current:[],dragging:!1,placeholderIndex:null}},componentWillReceiveProps:function(nextProps){_.isEqual(this.props.current,nextProps.current)||this.setState({current:nextProps.current})},render:function(){var _this=this,dragging=this.state.dragging&&React.createElement(Card,{ref:"dragging",floating:!0,content:this.state.dragContent,startOffset:this.state.offsetPos,startMouse:this.state.grabPos,mouse:this.state.mousePos,width:this.state.dragWidth,onMouseUp:this.onRelease,onMouseMove:this.onMouseMove,key:this.state.dragKey||"draggingCard",linterContext:this.props.linterContext}),animating=this.state.animating&&React.createElement(Card,{floating:!0,animating:!0,content:this.state.dragContent,startOffset:this.state.offsetPos,width:this.state.dragWidth,animateTo:this.state.animateTo,onAnimationEnd:this.state.onAnimationEnd,key:this.state.dragKey||"draggingCard",linterContext:this.props.linterContext}),sortableCards=_.map(this.state.current,function(opt,i){return React.createElement(Card,{ref:"sortable"+i,fakeRef:"sortable"+i,floating:!1,content:opt.content,width:opt.width,key:opt.key,linterContext:this.props.linterContext,onMouseDown:this.state.animating?$.noop:this.onClick.bind(null,"current",i)})},this);if(null!=this.state.placeholderIndex){var placeholder=React.createElement(PlaceholderCard,{ref:"placeholder",width:this.state.dragWidth,height:this.state.dragHeight,key:"placeholder"});sortableCards.splice(this.state.placeholderIndex,0,placeholder)}var anySortableCards=sortableCards.length>0;sortableCards.push(dragging,animating);var sortable=React.createElement("div",{className:"perseus-clearfix draggable-box"},!anySortableCards&&React.createElement(DragHintCard,null),React.createElement("div",{ref:"dragList"},sortableCards)),bank=React.createElement("div",{ref:"bank",className:"bank perseus-clearfix"},_.map(this.props.options,function(opt,i){return React.createElement(Card,{ref:"bank"+i,floating:!1,content:opt.content,stack:!0,key:i,linterContext:_this.props.linterContext,onMouseDown:_this.state.animating?$.noop:_this.onClick.bind(null,"bank",i),onMouseMove:_this.onMouseMove,onMouseUp:_this.onRelease})},this));return React.createElement("div",{className:"draggy-boxy-thing orderer height-"+this.props.height+" layout-"+this.props.layout+" above-scratchpad blank-background perseus-clearfix "+ApiClassNames.INTERACTIVE,ref:"orderer"},bank,sortable)},onClick:function(type,index,loc,draggable){var opt,$draggable=$(ReactDOM.findDOMNode(draggable)),list=this.state.current.slice(),placeholderIndex=null;"current"===type?(list.splice(index,1),opt=this.state.current[index],placeholderIndex=index):"bank"===type&&(opt=this.props.options[index]),this.setState({current:list,dragging:!0,placeholderIndex:placeholderIndex,dragKey:opt.key,dragContent:opt.content,dragWidth:$draggable.width(),dragHeight:$draggable.height(),grabPos:loc,mousePos:loc,offsetPos:$draggable.position()})},onRelease:function(loc){var _this2=this,draggable=this.refs.dragging;if(null!=draggable){var inCardBank=this.isCardInBank(draggable),index=this.state.placeholderIndex,onAnimationEnd=function(){var list=_this2.state.current.slice();if(!inCardBank){var newCard={content:_this2.state.dragContent,key:_.uniqueId("perseus_draggable_card_"),width:_this2.state.dragWidth};list.splice(index,0,newCard)}_this2.props.onChange({current:list}),_this2.setState({current:list,dragging:!1,placeholderIndex:null,animating:!1}),_this2.props.trackInteraction()},offset=$(ReactDOM.findDOMNode(draggable)).position(),finalOffset=null;inCardBank?_.each(this.props.options,function(opt,i){if(opt.content===this.state.dragContent){var card=ReactDOM.findDOMNode(this.refs["bank"+i]);finalOffset=$(card).position()}},this):null!=this.refs.placeholder&&(finalOffset=$(ReactDOM.findDOMNode(this.refs.placeholder)).position()),null==finalOffset?onAnimationEnd():this.setState({offsetPos:offset,animateTo:finalOffset,onAnimationEnd:onAnimationEnd,animating:!0,dragging:!1})}},onMouseMove:function(loc){var index,draggable=this.refs.dragging;null!=draggable&&(index=this.isCardInBank(draggable)?null:this.findCorrectIndex(draggable,this.state.current),this.setState({mousePos:loc,placeholderIndex:index}))},findCorrectIndex:function(draggable,list){var isHorizontal="horizontal"===this.props.layout,$dragList=$(ReactDOM.findDOMNode(this.refs.dragList)),leftEdge=$dragList.offset().left,topEdge=$dragList.offset().top,midWidth=$(ReactDOM.findDOMNode(draggable)).offset().left-leftEdge,midHeight=$(ReactDOM.findDOMNode(draggable)).offset().top-topEdge,index=0,sumWidth=0,sumHeight=0;return isHorizontal?_.each(list,function(opt,i){var card=ReactDOM.findDOMNode(this.refs["sortable"+i]),outerWidth=$(card).outerWidth(!0);midWidth>sumWidth+outerWidth/2&&(index+=1),sumWidth+=outerWidth},this):_.each(list,function(opt,i){var card=ReactDOM.findDOMNode(this.refs["sortable"+i]),outerHeight=$(card).outerHeight(!0);midHeight>sumHeight+outerHeight/2&&(index+=1),sumHeight+=outerHeight},this),index},isCardInBank:function(draggable){if(null==draggable)return!1;var isHorizontal="horizontal"===this.props.layout,$draggable=$(ReactDOM.findDOMNode(draggable)),$bank=$(ReactDOM.findDOMNode(this.refs.bank)),draggableOffset=$draggable.offset(),bankOffset=$bank.offset(),draggableHeight=$draggable.outerHeight(!0),bankHeight=$bank.outerHeight(!0),bankWidth=$bank.outerWidth(!0),dragList=ReactDOM.findDOMNode(this.refs.dragList),draggableWidth=($(dragList).width(),$draggable.outerWidth(!0));return isHorizontal?draggableOffset.top+draggableHeight/2<bankOffset.top+bankHeight:draggableOffset.left+draggableWidth/2<bankOffset.left+bankWidth},getUserInput:function(){return{current:_.map(this.props.current,function(v){return v.content})}},simpleValidate:function(rubric){return Orderer.validate(this.getUserInput(),rubric)}});_.extend(Orderer,{validate:function(state,rubric){return 0===state.current.length?{type:"invalid",message:null}:{type:"points",earned:_.isEqual(state.current,_.pluck(rubric.correctOptions,"content"))?1:0,total:1,message:null}}}),module.exports={name:"orderer",displayName:"Orderer",widget:Orderer,isLintable:!0}}).call(this,__webpack_require__(10))},678:function(module,exports,__webpack_require__){(function(i18n){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),$=__webpack_require__(10),HighlightableContent=__webpack_require__(679),Renderer=__webpack_require__(33),PassageMarkdown=__webpack_require__(685),linterContextDefault=__webpack_require__(25).linterContextDefault,LineHeightMeasurer=(__webpack_require__(156).babelPluginFlowReactPropTypes_proptype_ChangeableProps||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_SerializedHighlightSet||__webpack_require__(0).PropTypes.any,function(_React$Component){function LineHeightMeasurer(){return _classCallCheck(this,LineHeightMeasurer),_possibleConstructorReturn(this,_React$Component.apply(this,arguments))}return _inherits(LineHeightMeasurer,_React$Component),LineHeightMeasurer.prototype.measureLineHeight=function(){return"number"!=typeof this._cachedLineHeight&&this.forceMeasureLineHeight(),this._cachedLineHeight},LineHeightMeasurer.prototype.forceMeasureLineHeight=function(){this.$body.text(" "),this._cachedLineHeight=this.$end.offset().top-this.$body.offset().top,this.$body.text("")},LineHeightMeasurer.prototype.render=function(){var _this2=this;return React.createElement("div",{className:css(styles.measurer)},React.createElement("div",null,React.createElement("div",{ref:function(e){return _this2.$body=$(e)},className:"paragraph"}),React.createElement("div",{ref:function(e){return _this2.$end=$(e)}})))},LineHeightMeasurer}(React.Component)),styles=StyleSheet.create({measurer:{position:"absolute",width:"100%",top:0,left:0}}),Passage=function(_React$Component2){function Passage(){var _temp,_this3;_classCallCheck(this,Passage);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this3=_possibleConstructorReturn(this,_React$Component2.call.apply(_React$Component2,[this].concat(args))),_this3.state={nLines:null,startLineNumbersAfter:0,stylesAreApplied:!1},_this3._handleSerializedHighlightsUpdate=function(serializedHighlights){_this3.props.onChange({highlights:serializedHighlights})},_possibleConstructorReturn(_this3,_temp)}return _inherits(Passage,_React$Component2),Passage.prototype.componentDidMount=function(){var _this4=this;this._updateState(),this._onResize=_.throttle(function(){_this4.shouldRenderJipt()||(_this4._lineHeightMeasurer.forceMeasureLineHeight(),_this4._updateState())},500),window.addEventListener("resize",this._onResize),window.setTimeout(function(){_this4.setState({stylesAreApplied:!0})},0)},Passage.prototype.shouldComponentUpdate=function(nextProps,nextState){return!_.isEqual(this.props,nextProps)||!_.isEqual(this.state,nextState)},Passage.prototype.componentDidUpdate=function(){this._updateState()},Passage.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this._onResize)},Passage.prototype._updateState=function(){this.shouldRenderJipt()||this.setState({nLines:this._measureLines(),startLineNumbersAfter:this._getInitialLineNumber()})},Passage.prototype._measureLines=function(){var contentsHeight=$(ReactDOM.findDOMNode(this.refs.content)).height(),lineHeight=this._getLineHeight();return Math.round(contentsHeight/lineHeight)},Passage.prototype._getInitialLineNumber=function(){var _this5=this,isPassageBeforeThisPassage=!0;return this.props.findWidgets(function(id,widgetInfo){return"passage"===widgetInfo.type&&(id===_this5.props.widgetId&&(isPassageBeforeThisPassage=!1),isPassageBeforeThisPassage)}).map(function(passageWidget){return passageWidget.getLineCount()}).reduce(function(a,b){return a+b},0)},Passage.prototype._getLineHeight=function(){return this._lineHeightMeasurer.measureLineHeight()},Passage.prototype.getLineCount=function(){return null!=this.state.nLines?this.state.nLines:this._measureLines()},Passage.prototype._getStartRefLineNumber=function(referenceNumber){var refRef=PassageMarkdown.START_REF_PREFIX+referenceNumber,ref=this.refs[refRef];if(!ref)return null;var $ref=$(ReactDOM.findDOMNode(ref)),$refText=$ref.next();0===$refText.length&&($refText=$ref);var vPos=$refText.offset().top;return this.state.startLineNumbersAfter+1+this._convertPosToLineNumber(vPos)},Passage.prototype._getEndRefLineNumber=function(referenceNumber){var refRef=PassageMarkdown.END_REF_PREFIX+referenceNumber,ref=this.refs[refRef];if(!ref)return null;var $ref=$(ReactDOM.findDOMNode(ref)),$refText=$ref.prev();0===$refText.length&&($refText=$ref);var height=$refText.height(),vPos=$refText.offset().top,line=this._convertPosToLineNumber(vPos+height);return 0===height&&(line+=1),this.state.startLineNumbersAfter+line},Passage.prototype._convertPosToLineNumber=function(absoluteVPos){var relativeVPos=absoluteVPos-$(ReactDOM.findDOMNode(this.refs.content)).offset().top,lineHeight=this._getLineHeight();return Math.round(relativeVPos/lineHeight)},Passage.prototype._getRefContent=function(referenceNumber){var refRef=PassageMarkdown.START_REF_PREFIX+referenceNumber,ref=this.refs[refRef];return ref?ref.getRefContent():null},Passage.prototype.getReference=function(referenceNumber){var refStartLine=this._getStartRefLineNumber(referenceNumber),refEndLine=this._getEndRefLineNumber(referenceNumber);return null==refStartLine||null==refEndLine?null:{startLine:refStartLine,endLine:refEndLine,content:this._getRefContent(referenceNumber)}},Passage.prototype.getUserInput=function(){return null},Passage.prototype.simpleValidate=function(rubric){return Passage.validate(this.getUserInput(),rubric)},Passage.validate=function(state,rubric){return{type:"points",earned:0,total:0,message:null}},Passage.prototype._renderInstructions=function(parseState){var firstQuestionNumber=parseState.firstQuestionRef,firstSentenceRef=parseState.firstSentenceRef,instructions="";firstQuestionNumber&&(instructions+=i18n._("The symbol { questionSymbol } indicates that question { questionNumber } references this portion of the passage.",{questionSymbol:"[["+firstQuestionNumber+"]]",questionNumber:firstQuestionNumber})),firstSentenceRef&&(instructions+=i18n._(" The symbol { sentenceSymbol } indicates that the following sentence is referenced in a question.",{sentenceSymbol:"["+firstSentenceRef+"]"}));var parsedInstructions=PassageMarkdown.parse(instructions);return React.createElement("div",{className:"perseus-widget-passage-instructions"},PassageMarkdown.output(parsedInstructions))},Passage.prototype.shouldRenderJipt=function(){return"undefined"!=typeof KA&&"en-pt"===KA.language&&-1!==this.props.passageText.indexOf("crwdns")},Passage.prototype._renderContent=function(parsed){var _this6=this,enabled=this.state.stylesAreApplied,editable=!this.props.reviewModeRubric;return React.createElement(HighlightableContent,{editable:editable,enabled:enabled,onSerializedHighlightsUpdate:this._handleSerializedHighlightsUpdate,serializedHighlights:this.props.highlights},React.createElement("div",{ref:"content"},React.createElement(LineHeightMeasurer,{ref:function(e){return _this6._lineHeightMeasurer=e}}),PassageMarkdown.output(parsed)))},Passage.prototype._hasFootnotes=function(){return!/^\s*$/.test(this.props.footnotes)},Passage.prototype._renderFootnotes=function(){var rawContent=this.props.footnotes,parsed=PassageMarkdown.parse(rawContent);return PassageMarkdown.output(parsed)},Passage.prototype.render=function(){var _this7=this,lineNumbers=void 0,nLines=this.state.nLines;this.props.showLineNumbers&&nLines&&(lineNumbers=_.range(1,nLines+1).map(function(lineN){return 4===lineN&&nLines>4?React.createElement("span",{key:"line-marker",className:"line-marker"},"Line"):React.createElement("span",{key:lineN},lineN+_this7.state.startLineNumbersAfter)}));var parseState={firstSentenceRef:null,firstQuestionRef:null},parsedContent=PassageMarkdown.parse(this.props.passageText,parseState),hasTitle=/\S/.test(this.props.passageTitle);return React.createElement("div",null,React.createElement("div",{className:"perseus-widget-passage-container"},this._renderInstructions(parseState),React.createElement("div",{className:"perseus-widget-passage"},hasTitle&&React.createElement("h3",{className:"passage-title"},React.createElement(Renderer,{content:this.props.passageTitle,linterContext:this.props.linterContext})),lineNumbers&&React.createElement("div",{className:"line-numbers","aria-hidden":!0},lineNumbers),!hasTitle&&React.createElement("h3",{className:"perseus-sr-only"},i18n._("Beginning of reading passage.")),React.createElement("div",{className:"passage-text"},this.shouldRenderJipt()?React.createElement(Renderer,{content:this.props.passageText}):this._renderContent(parsedContent)),this._hasFootnotes()&&[React.createElement("h4",{key:"footnote-start",className:"perseus-sr-only"},i18n._("Beginning of reading passage footnotes.")),React.createElement("div",{key:"footnotes",className:"footnotes"},this._renderFootnotes())],React.createElement("div",{className:"perseus-sr-only"},i18n._("End of reading passage.")))))},Passage}(React.Component);Passage.defaultProps={passageTitle:"",passageText:"",footnotes:"",showLineNumbers:!0,highlights:{},linterContext:linterContextDefault},module.exports={name:"passage",displayName:"Passage (SAT only)",widget:Passage,transform:function(editorProps){return _.pick(editorProps,"passageTitle","passageText","footnotes","showLineNumbers")},isLintable:!0}}).call(this,__webpack_require__(21))},679:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}var React=__webpack_require__(0),_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,HighlightingUI=__webpack_require__(680),WordIndexer=__webpack_require__(683),_require2=__webpack_require__(684),addHighlight=_require2.addHighlight,buildHighlight=_require2.buildHighlight,deserializeHighlight=_require2.deserializeHighlight,serializeHighlight=_require2.serializeHighlight,babelPluginFlowReactPropTypes_proptype_SerializedHighlightSet=(__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_SerializedHighlightSet||__webpack_require__(0).PropTypes.any),HighlightableContent=(__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMHighlightSet||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMHighlight||__webpack_require__(0).PropTypes.any,function(_React$PureComponent){function HighlightableContent(){var _temp,_this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HighlightableContent);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,_React$PureComponent.call.apply(_React$PureComponent,[this].concat(args))),_this.state={wordRanges:[]},_this._handleAddHighlight=function(highlight){var newDomHighlights=addHighlight(_this._getDOMHighlights(),highlight),newSerializedHighlights={},_iterator=Object.keys(newDomHighlights),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var key=_ref;newSerializedHighlights[key]=serializeHighlight(newDomHighlights[key])}_this.props.onSerializedHighlightsUpdate(newSerializedHighlights)},_this._handleRemoveHighlight=function(keyToRemove){var serializedHighlights=_this.props.serializedHighlights,newSerializedHighlights=_extends({},serializedHighlights);delete newSerializedHighlights[keyToRemove],_this.props.onSerializedHighlightsUpdate(newSerializedHighlights)},_this._handleWordsUpdate=function(wordRanges){_this.setState({wordRanges:wordRanges})},_possibleConstructorReturn(_this,_temp)}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HighlightableContent,_React$PureComponent),HighlightableContent.prototype._buildHighlight=function(highlightRange){return buildHighlight(this._getDOMHighlights(),this.state.wordRanges,highlightRange)},HighlightableContent.prototype._getDOMHighlights=function(){var serializedHighlights=this.props.serializedHighlights,wordRanges=this.state.wordRanges,domHighlights={},_iterator2=Object.keys(serializedHighlights),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var key=_ref2;domHighlights[key]=deserializeHighlight(serializedHighlights[key],wordRanges)}return domHighlights},HighlightableContent.prototype.render=function(){var _this2=this,highlights=this._getDOMHighlights();return React.createElement("div",{className:css(styles.container),ref:function(container){return _this2._container=container}},React.createElement("div",null,this.props.enabled&&this._container&&this._content&&React.createElement(HighlightingUI,{buildHighlight:function(r){return _this2._buildHighlight(r)},contentNode:this._content,editable:this.props.editable,highlights:highlights,offsetParent:this._container,zIndexes:{aboveContent:2,belowContent:0},onAddHighlight:this._handleAddHighlight,onRemoveHighlight:this._handleRemoveHighlight})),React.createElement("div",{className:css(styles.content),ref:function(content){return _this2._content=content}},React.createElement(WordIndexer,{onWordsUpdate:this._handleWordsUpdate},this.props.children)))},HighlightableContent}(React.PureComponent));HighlightableContent.propTypes={children:__webpack_require__(0).PropTypes.any,editable:__webpack_require__(0).PropTypes.bool.isRequired,enabled:__webpack_require__(0).PropTypes.bool.isRequired,onSerializedHighlightsUpdate:__webpack_require__(0).PropTypes.func.isRequired,serializedHighlights:babelPluginFlowReactPropTypes_proptype_SerializedHighlightSet};var styles=StyleSheet.create({container:{position:"relative",zIndex:0},content:{position:"relative",zIndex:1}});module.exports=HighlightableContent},680:function(module,exports,__webpack_require__){(function(i18n){var React=__webpack_require__(0),HighlightSetRenderer=__webpack_require__(681),HighlightTooltip=__webpack_require__(650),rangesOverlap=__webpack_require__(643).rangesOverlap,SelectionTracker=__webpack_require__(651),babelPluginFlowReactPropTypes_proptype_ZIndexes=__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_ZIndexes||__webpack_require__(0).PropTypes.any,babelPluginFlowReactPropTypes_proptype_DOMHighlightSet=(__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any,__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMHighlightSet||__webpack_require__(0).PropTypes.any),HighlightingUI=(__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMHighlight||__webpack_require__(0).PropTypes.any,__webpack_require__(651).babelPluginFlowReactPropTypes_proptype_TrackedSelection||__webpack_require__(0).PropTypes.any,function(_React$PureComponent){function HighlightingUI(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HighlightingUI),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_React$PureComponent.apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HighlightingUI,_React$PureComponent),HighlightingUI.prototype._handleAddHighlight=function(highlightToAdd){this.props.onAddHighlight(highlightToAdd);var selection=document.getSelection();selection&&selection.collapseToEnd()},HighlightingUI.prototype._selectionIsValid=function(trackedSelection){if(!trackedSelection)return!1;var contentNode=this.props.contentNode,contentRange=new Range;contentRange.selectNodeContents(contentNode);var focusRange=new Range;return focusRange.setStart(trackedSelection.focusNode,trackedSelection.focusOffset),focusRange.collapse(!0),rangesOverlap(contentRange,focusRange)},HighlightingUI.prototype.render=function(){var _this2=this;return React.createElement(SelectionTracker,{buildHighlight:this.props.buildHighlight,enabled:this.props.editable},function(trackedSelection,userIsMouseSelecting){return React.createElement("div",null,React.createElement(HighlightSetRenderer,{editable:_this2.props.editable&&!_this2._selectionIsValid(trackedSelection),highlights:_this2.props.highlights,offsetParent:_this2.props.offsetParent,onRemoveHighlight:_this2.props.onRemoveHighlight,zIndexes:_this2.props.zIndexes}),_this2._selectionIsValid(trackedSelection)&&!userIsMouseSelecting&&React.createElement(HighlightTooltip,{label:i18n._("Add highlight"),onClick:function(){return _this2._handleAddHighlight(trackedSelection.proposedHighlight)},focusNode:trackedSelection.focusNode,focusOffset:trackedSelection.focusOffset,offsetParent:_this2.props.offsetParent,zIndex:_this2.props.zIndexes.aboveContent}))})},HighlightingUI}(React.PureComponent));HighlightingUI.propTypes={buildHighlight:__webpack_require__(0).PropTypes.func.isRequired,contentNode:__webpack_require__(0).PropTypes.any.isRequired,editable:__webpack_require__(0).PropTypes.bool.isRequired,highlights:babelPluginFlowReactPropTypes_proptype_DOMHighlightSet,offsetParent:__webpack_require__(0).PropTypes.any.isRequired,onAddHighlight:__webpack_require__(0).PropTypes.func.isRequired,onRemoveHighlight:__webpack_require__(0).PropTypes.func.isRequired,zIndexes:babelPluginFlowReactPropTypes_proptype_ZIndexes},module.exports=HighlightingUI}).call(this,__webpack_require__(21))},681:function(module,exports,__webpack_require__){(function(i18n){function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}var React=__webpack_require__(0),HighlightRenderer=__webpack_require__(682),HighlightTooltip=__webpack_require__(650),babelPluginFlowReactPropTypes_proptype_ZIndexes=__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_ZIndexes||__webpack_require__(0).PropTypes.any,babelPluginFlowReactPropTypes_proptype_DOMHighlightSet=(__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_Position||__webpack_require__(0).PropTypes.any,__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMHighlightSet||__webpack_require__(0).PropTypes.any),HighlightSetRenderer=function(_React$PureComponent){function HighlightSetRenderer(){var _temp,_this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HighlightSetRenderer);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,_React$PureComponent.call.apply(_React$PureComponent,[this].concat(args))),_this.state={mouseClientPosition:null,hoveringTooltipFor:null},_this._highlightRenderers={},_this._handleMouseMove=function(e){_this.setState({mouseClientPosition:{left:e.clientX,top:e.clientY}})},_possibleConstructorReturn(_this,_temp)}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HighlightSetRenderer,_React$PureComponent),HighlightSetRenderer.prototype.componentDidMount=function(){this._updateEditListeners(!1,this.props.editable)},HighlightSetRenderer.prototype.componentWillReceiveProps=function(nextProps){this._updateEditListeners(this.props.editable,nextProps.editable),"string"!=typeof this.state.hoveringTooltipFor||this.state.hoveringTooltipFor in nextProps.highlights||this.setState({hoveringTooltipFor:null})},HighlightSetRenderer.prototype.componentWillUnmount=function(){this._updateEditListeners(this.props.editable,!1)},HighlightSetRenderer.prototype._updateEditListeners=function(wasListening,willListen){!wasListening&&willListen?window.addEventListener("mousemove",this._handleMouseMove):wasListening&&!willListen&&(window.removeEventListener("mousemove",this._handleMouseMove),this.setState({mouseClientPosition:null}))},HighlightSetRenderer.prototype._getHoveredHighlightKey=function(){var _this2=this,hoveringTooltipFor=this.state.hoveringTooltipFor;return"string"==typeof hoveringTooltipFor?hoveringTooltipFor:Object.keys(this.props.highlights).find(function(key){var highlightRenderer=_this2._highlightRenderers[key];return highlightRenderer&&highlightRenderer.isHovered(_this2.state.mouseClientPosition)})},HighlightSetRenderer.prototype._renderTooltip=function(){var _this3=this,hoveredHighlightKey=this._getHoveredHighlightKey();if("string"!=typeof hoveredHighlightKey)return null;var hoveredHighlight=this.props.highlights[hoveredHighlightKey];return React.createElement(HighlightTooltip,{label:i18n._("Remove highlight"),focusNode:hoveredHighlight.domRange.endContainer,focusOffset:hoveredHighlight.domRange.endOffset,offsetParent:this.props.offsetParent,zIndex:this.props.zIndexes.aboveContent,onClick:function(){return _this3.props.onRemoveHighlight(hoveredHighlightKey)},onMouseEnter:function(){return _this3.setState({hoveringTooltipFor:hoveredHighlightKey})},onMouseLeave:function(){return _this3.setState({hoveringTooltipFor:null})}})},HighlightSetRenderer.prototype.render=function(){var _this4=this;return React.createElement("div",null,Object.keys(this.props.highlights).map(function(key){return React.createElement(HighlightRenderer,{ref:function(r){r?_this4._highlightRenderers[key]=r:delete _this4._highlightRenderers[key]},editable:_this4.props.editable,key:key,highlight:_this4.props.highlights[key],highlightKey:key,mouseClientPosition:_this4.state.mouseClientPosition,offsetParent:_this4.props.offsetParent,onRemoveHighlight:_this4.props.onRemoveHighlight,zIndexes:_this4.props.zIndexes})}),this.props.editable&&this._renderTooltip())},HighlightSetRenderer}(React.PureComponent);HighlightSetRenderer.propTypes={editable:__webpack_require__(0).PropTypes.bool.isRequired,highlights:babelPluginFlowReactPropTypes_proptype_DOMHighlightSet,offsetParent:__webpack_require__(0).PropTypes.any.isRequired,onRemoveHighlight:__webpack_require__(0).PropTypes.func.isRequired,zIndexes:babelPluginFlowReactPropTypes_proptype_ZIndexes},module.exports=HighlightSetRenderer}).call(this,__webpack_require__(21))},682:function(module,exports,__webpack_require__){function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}var React=__webpack_require__(0),_require=__webpack_require__(6),StyleSheet=_require.StyleSheet,css=_require.css,_require2=__webpack_require__(649),getClientRectsForTextInRange=_require2.getClientRectsForTextInRange,getRelativePosition=_require2.getRelativePosition,getRelativeRect=_require2.getRelativeRect,babelPluginFlowReactPropTypes_proptype_ZIndexes=__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_ZIndexes||__webpack_require__(0).PropTypes.any,babelPluginFlowReactPropTypes_proptype_DOMHighlight=(__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_Rect||__webpack_require__(0).PropTypes.any,__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_Position||__webpack_require__(0).PropTypes.any,__webpack_require__(640).babelPluginFlowReactPropTypes_proptype_DOMHighlight||__webpack_require__(0).PropTypes.any),HighlightRenderer=function(_React$PureComponent){function HighlightRenderer(){var _temp,_this;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HighlightRenderer);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=_possibleConstructorReturn(this,_React$PureComponent.call.apply(_React$PureComponent,[this].concat(args))),_this.state={cachedHighlightRects:_this._computeRects(_this.props),tooltipIsHovered:!1},_possibleConstructorReturn(_this,_temp)}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(HighlightRenderer,_React$PureComponent),HighlightRenderer.prototype.componentWillReceiveProps=function(nextProps){this.props.highlight===nextProps.highlight&&this.props.offsetParent===nextProps.offsetParent||this.setState({cachedHighlightRects:this._computeRects(nextProps)})},HighlightRenderer.prototype._computeRects=function(props){var highlight=props.highlight,offsetParent=props.offsetParent,clientRects=getClientRectsForTextInRange(highlight.domRange),offsetParentRect=offsetParent.getBoundingClientRect();return clientRects.map(function(rect){return getRelativeRect(rect,offsetParentRect)})},HighlightRenderer.prototype._rectIsHovered=function(rect,mouseOffsetPosition){var positionWithinRect=getRelativePosition(mouseOffsetPosition,rect);return 0<=positionWithinRect.left&&positionWithinRect.left<rect.width&&0<=positionWithinRect.top&&positionWithinRect.top<rect.height},HighlightRenderer.prototype.isHovered=function(mouseClientPosition){var _this2=this;if(!mouseClientPosition)return!1;var offsetParent=this.props.offsetParent,cachedHighlightRects=this.state.cachedHighlightRects,offsetParentRect=offsetParent.getBoundingClientRect(),mouseOffsetPosition=getRelativePosition(mouseClientPosition,offsetParentRect);return cachedHighlightRects.some(function(rect){return _this2._rectIsHovered(rect,mouseOffsetPosition)})},HighlightRenderer.prototype.render=function(){var _this3=this,rects=this.state.cachedHighlightRects;return React.createElement("div",null,rects.map(function(rect,index){return React.createElement("div",{key:index,className:css(styles.highlightRect),style:{position:"absolute",width:rect.width,height:rect.height,top:rect.top,left:rect.left,zIndex:_this3.props.zIndexes.belowContent}})}))},HighlightRenderer}(React.PureComponent);HighlightRenderer.propTypes={highlight:babelPluginFlowReactPropTypes_proptype_DOMHighlight,highlightKey:__webpack_require__(0).PropTypes.string.isRequired,offsetParent:__webpack_require__(0).PropTypes.any.isRequired,zIndexes:babelPluginFlowReactPropTypes_proptype_ZIndexes};var styles=StyleSheet.create({highlightRect:{background:"#fffabe"}});module.exports=HighlightRenderer},683:function(module,exports,__webpack_require__){var React=__webpack_require__(0),WordIndexer=(__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any,function(_React$PureComponent){function WordIndexer(){return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WordIndexer),function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}(this,_React$PureComponent.apply(this,arguments))}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}(WordIndexer,_React$PureComponent),WordIndexer.prototype.componentDidMount=function(){this._sendWordsUpdate()},WordIndexer.prototype.componentDidUpdate=function(){this._sendWordsUpdate()},WordIndexer.prototype._sendWordsUpdate=function(){this.props.onWordsUpdate(this._getWordRanges())},WordIndexer.prototype._getWordRanges=function(){var container=this._container;if(!container)throw new Error("invariant violation: `this._container` is not defined, but this method is only called after mount/update");for(var treeWalker=container.ownerDocument.createTreeWalker(container,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,function(){return NodeFilter.FILTER_ACCEPT},!1),index=[],trailingWordRange=null;treeWalker.nextNode();){var node=treeWalker.currentNode;if(node.nodeType===Node.ELEMENT_NODE)"inline"!==getComputedStyle(node).display&&(trailingWordRange=null);else if(node.nodeType===Node.TEXT_NODE){for(var text=node.nodeValue,wordPattern=/\S+/g,wordMatch=void 0,newTrailingWordRange=null;null!==(wordMatch=wordPattern.exec(text));){var startOffset=wordMatch.index,endOffset=wordMatch.index+wordMatch[0].length,range=void 0;0===startOffset&&trailingWordRange?(range=trailingWordRange).setEnd(node,endOffset):((range=node.ownerDocument.createRange()).setStart(node,startOffset),range.setEnd(node,endOffset),index.push(range)),endOffset===text.length&&(newTrailingWordRange=range)}trailingWordRange=newTrailingWordRange}}return index},WordIndexer.prototype.render=function(){var _this2=this;return React.createElement("div",{ref:function(container){return _this2._container=container}},this.props.children)},WordIndexer}(React.PureComponent));WordIndexer.propTypes={children:__webpack_require__(0).PropTypes.any,onWordsUpdate:__webpack_require__(0).PropTypes.func.isRequired},module.exports=WordIndexer},684:function(module,exports,__webpack_require__){var _require=__webpack_require__(643),findFirstAndLastWordIndexes=_require.findFirstAndLastWordIndexes,unionRanges=_require.unionRanges,spanRanges=_require.spanRanges,rangeIncludes=_require.rangeIncludes;__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMRange||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_SerializedHighlight||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMHighlightSet||__webpack_require__(0).PropTypes.any,__webpack_require__(641).babelPluginFlowReactPropTypes_proptype_DOMHighlight||__webpack_require__(0).PropTypes.any;module.exports={addHighlight:function(existingHighlights,newHighlight){var newHighlights={},mergedDomRange=newHighlight.domRange,mergedFirstWordIndex=newHighlight.firstWordIndex,mergedLastWordIndex=newHighlight.lastWordIndex,_iterator=Object.keys(existingHighlights),_isArray=Array.isArray(_iterator),_i=0;for(_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{if((_i=_iterator.next()).done)break;_ref=_i.value}var key=_ref,h=existingHighlights[key],newMergedDomRange=unionRanges(h.domRange,mergedDomRange);newMergedDomRange?(mergedDomRange=newMergedDomRange,mergedFirstWordIndex=Math.min(h.firstWordIndex,mergedFirstWordIndex),mergedLastWordIndex=Math.max(h.lastWordIndex,mergedLastWordIndex)):newHighlights[key]=h}var newMergedHighlight={firstWordIndex:mergedFirstWordIndex,lastWordIndex:mergedLastWordIndex,domRange:mergedDomRange};return newHighlights[function(existingKeys){var base=""+(new Date).getTime();if(!existingKeys.includes(base))return base;var suffix=0,key=void 0;do{key=base+"-"+suffix,suffix++}while(existingKeys.includes(key));return key}(Object.keys(newHighlights))]=newMergedHighlight,newHighlights},buildHighlight:function(existingHighlights,wordRanges,newHighlightRange){var _iterator2=Object.keys(existingHighlights),_isArray2=Array.isArray(_iterator2),_i2=0;for(_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{if((_i2=_iterator2.next()).done)break;_ref2=_i2.value}var existingHighlightRange=existingHighlights[_ref2].domRange;if(rangeIncludes(existingHighlightRange,newHighlightRange))return null}var indexes=findFirstAndLastWordIndexes(newHighlightRange,wordRanges);if(!indexes)return null;var firstWordIndex=indexes[0],lastWordIndex=indexes[1],firstWord=wordRanges[firstWordIndex],lastWord=wordRanges[lastWordIndex];return{firstWordIndex:firstWordIndex,lastWordIndex:lastWordIndex,domRange:spanRanges(firstWord,lastWord)}},deserializeHighlight:function(serializedHighlight,wordRanges){var _serializedHighlight$=serializedHighlight.range,firstWordIndex=_serializedHighlight$.firstWordIndex,lastWordIndex=_serializedHighlight$.lastWordIndex,firstWord=wordRanges[firstWordIndex];if(!firstWord)throw new Error("first word index "+firstWord+" is out of bounds: must be 0"+(wordRanges.length-1)+" inclusive");var lastWord=wordRanges[lastWordIndex];if(!lastWord)throw new Error("last word index "+lastWord+" is out of bounds: must be 0"+(wordRanges.length-1)+" inclusive");return{firstWordIndex:firstWordIndex,lastWordIndex:lastWordIndex,domRange:spanRanges(firstWord,lastWord)}},serializeHighlight:function(highlight){return{range:{type:"word-indexes",firstWordIndex:highlight.firstWordIndex,lastWordIndex:highlight.lastWordIndex}}}}},685:function(module,exports,__webpack_require__){(function($_){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),SimpleMarkdown=__webpack_require__(160),_=__webpack_require__(1),REF_STYLE={display:"inline-block",width:0,visibility:"hidden"},LABEL_OUTER_STYLE={display:"inline",whiteSpace:"nowrap"},SQUARE_LABEL_STYLE={display:"inline-block",color:"rgb(255, 255, 255)",backgroundColor:"rgb(90, 90, 90)",paddingLeft:10,paddingRight:10,userSelect:"none",WebkitUserSelect:"none"},CIRCLE_LABEL_STYLE={display:"inline-block",color:"rgb(255, 255, 255)",backgroundColor:"rgb(90, 90, 90)",userSelect:"none",WebkitUserSelect:"none",width:22,height:22,borderRadius:"50%",textAlign:"center"},RefStart=React.createClass({displayName:"RefStart",propTypes:{refContent:React.PropTypes.node.isRequired},render:function(){return React.createElement("span",{style:REF_STYLE},"_")},getRefContent:function(){return this.props.refContent}}),RefEnd=React.createClass({displayName:"RefEnd",render:function(){return React.createElement("span",{style:REF_STYLE},"_")}}),rules={newline:SimpleMarkdown.defaultRules.newline,paragraph:SimpleMarkdown.defaultRules.paragraph,escape:SimpleMarkdown.defaultRules.escape,passageFootnote:{order:SimpleMarkdown.defaultRules.escape.order+.1,match:SimpleMarkdown.inlineRegex(/^\^/),parse:function(capture,_parse,state){var id=state.lastFootnote.id+1,footnote={id:id,text:1===id?"*":""+id};return"*"===state.lastFootnote.text&&(state.lastFootnote.text=""+state.lastFootnote.id),state.lastFootnote=footnote,footnote},react:function(node,output,state){return React.createElement("sup",{key:state.key},node.text)}},refStart:{order:SimpleMarkdown.defaultRules.escape.order+.2,match:function(source,state){var capture=/^\{\{/.exec(source);if(capture){for(var closeIndex=2,refNestingLevel=0;closeIndex<source.length;){var token=source.slice(closeIndex,closeIndex+2);if("{{"===token)refNestingLevel++,closeIndex++;else if("}}"===token){if(!(refNestingLevel>0))break;refNestingLevel--,closeIndex++}closeIndex++}var refText=source.slice(2,closeIndex);return[capture[0],refText]}return null},parse:function(capture,_parse2,state){if(!state.useRefs)return{ref:null,refContent:null};var ref=state.lastRef+1;return state.lastRef=ref,state.currentRef.push(ref),{ref:ref,refContent:_parse2("("+capture[1]+")\n\n",_.defaults({useRefs:!1},INITIAL_PARSE_STATE))}},react:function(node,output,state){if(null==node.ref)return null;var refContent=output(node.refContent,{});return React.createElement(RefStart,{ref:"start-ref-"+node.ref,key:"start-ref-"+node.ref,refContent:refContent})}},refEnd:{order:SimpleMarkdown.defaultRules.escape.order+.3,match:SimpleMarkdown.inlineRegex(/^\}\}/),parse:function(capture,_parse3,state){return state.useRefs?{ref:state.currentRef.pop()||null}:{ref:null}},react:function(node,output,state){return null!=node.ref?React.createElement(RefEnd,{ref:"end-ref-"+node.ref,key:"end-ref-"+node.ref}):null}},squareLabel:{order:SimpleMarkdown.defaultRules.escape.order+.4,match:SimpleMarkdown.inlineRegex(/^\[\[(\w+)\]\]( *)/),parse:function(capture,_parse4,state){return state.firstQuestionRef||(state.firstQuestionRef=capture[1]),{content:capture[1],space:capture[2].length>0}},react:function(node,output,state){return[React.createElement("span",{key:"visual-square",className:"perseus-passage-square-label",style:LABEL_OUTER_STYLE,"aria-hidden":"true"},React.createElement("span",{style:SQUARE_LABEL_STYLE},node.content)),React.createElement("span",{key:"alt-text",className:"perseus-sr-only"},$_({number:node.content},"[Marker for question { number }]")),node.space?"":null]}},circleLabel:{order:SimpleMarkdown.defaultRules.escape.order+.5,match:SimpleMarkdown.inlineRegex(/^\(\((\w+)\)\)( *)/),parse:function(capture,_parse5,state){return{content:capture[1],space:capture[2].length>0}},react:function(node,output,state){return[React.createElement("span",{key:"visual-circle",className:"perseus-passage-circle-label",style:LABEL_OUTER_STYLE,"aria-hidden":!0},React.createElement("span",{style:CIRCLE_LABEL_STYLE},node.content)),React.createElement("span",{key:"alt-text",className:"perseus-sr-only"},$_({number:node.content},"[Circle marker { number }]")),node.space?"":null]}},squareBracketRef:{order:SimpleMarkdown.defaultRules.escape.order+.6,match:SimpleMarkdown.inlineRegex(/^\[(\d+)\]( *)/),parse:function(capture,_parse6,state){return state.firstSentenceRef||(state.firstSentenceRef=capture[1]),{content:capture[1],space:capture[2].length>0}},react:function(node,output,state){return[React.createElement("span",{key:"visual-brackets",className:"perseus-passage-bracket-label","aria-hidden":"true"},"[",node.content,"]"),React.createElement("span",{key:"alt-text",className:"perseus-sr-only"},$_({number:node.content},"[Sentence { number }]")),node.space?"":null]}},highlight:{order:SimpleMarkdown.defaultRules.escape.order+.7,match:SimpleMarkdown.inlineRegex(/^{highlighting.start}(.+?){highlighting.end}/),parse:function(capture,_parse7,state){return{content:capture[1]}},react:function(node,output,state){return[React.createElement("span",{className:"perseus-highlight"},node.content)]}},reviewHighlight:{order:SimpleMarkdown.defaultRules.escape.order+.7,match:SimpleMarkdown.inlineRegex(/^{review-highlighting.start}(.+?){review-highlighting.end}/),parse:function(capture,_parse8,state){return{content:capture[1]}},react:function(node,output,state){return[React.createElement("span",{className:"perseus-review-highlight"},node.content)]}},strong:SimpleMarkdown.defaultRules.strong,u:SimpleMarkdown.defaultRules.u,em:SimpleMarkdown.defaultRules.em,del:SimpleMarkdown.defaultRules.del,text:_extends({},SimpleMarkdown.defaultRules.text,{react:function(node,output,state){return React.createElement("span",{key:state.key},node.content)}})},INITIAL_PARSE_STATE={currentRef:[],useRefs:!0,lastRef:0,lastFootnote:{id:0,text:""}},builtParser=SimpleMarkdown.parserFor(rules);module.exports={parse:function(source,state){return state=state||{},builtParser(source+"\n\n",_.extend(state,INITIAL_PARSE_STATE))},output:SimpleMarkdown.reactFor(SimpleMarkdown.ruleOutput(rules,"react")),START_REF_PREFIX:"start-ref-",END_REF_PREFIX:"end-ref-",_rulesForTesting:rules}}).call(this,__webpack_require__(272))},686:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),WidgetJsonifyDeprecated=__webpack_require__(269),Renderer=__webpack_require__(33),_require=__webpack_require__(25),linterContextProps=_require.linterContextProps,linterContextDefault=_require.linterContextDefault,PassageRefTarget=React.createClass({displayName:"PassageRefTarget",propTypes:_extends({},Changeable.propTypes,{content:React.PropTypes.string,linterContext:linterContextProps}),getDefaultProps:function(){return{content:"",linterContext:linterContextDefault}},getUserInput:function(){return WidgetJsonifyDeprecated.getUserInput.call(this)},render:function(){return React.createElement(Renderer,{content:this.props.content,inline:!0,apiOptions:this.props.apiOptions,linterContext:this.props.linterContext})},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},simpleValidate:function(rubric){return PassageRefTarget.validate(this.getUserInput(),rubric)}});_.extend(PassageRefTarget,{validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}}}),module.exports={name:"passage-ref-target",displayName:"PassageRefTarget",defaultAlignment:"inline",widget:PassageRefTarget,hidden:!0,transform:function(editorProps){return _.pick(editorProps,"content")},version:{major:0,minor:0},isLintable:!0}},687:function(module,exports,__webpack_require__){(function($){var React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),ApiClassNames=__webpack_require__(13).ClassNames,deepEq=__webpack_require__(19).deepEq,KhanMath=__webpack_require__(44),KhanColors=__webpack_require__(43),GraphUtils=__webpack_require__(157),Interactive2=__webpack_require__(270),WrappedLine=__webpack_require__(101),Plotter=(React.PropTypes.oneOf(["bar","line","pic","histogram","dotplot"]),React.PropTypes.arrayOf(React.PropTypes.string),React.PropTypes.arrayOf(React.PropTypes.oneOfType([React.PropTypes.number,React.PropTypes.string])),React.PropTypes.number,React.PropTypes.number,React.PropTypes.number,React.PropTypes.number,React.PropTypes.number,React.PropTypes.string,React.PropTypes.arrayOf(React.PropTypes.number),React.PropTypes.number,React.PropTypes.arrayOf(React.PropTypes.number),React.PropTypes.bool,React.createClass({displayName:"Plotter",propTypes:{onChange:React.PropTypes.func.isRequired,trackInteraction:React.PropTypes.func.isRequired},getDefaultProps:function(){return{type:"bar",labels:["",""],categories:[""],scaleY:1,maxY:10,snapsPerLine:2,picSize:40,picBoxHeight:48,picUrl:"",plotDimensions:[380,300],labelInterval:1}},getInitialState:function(){return{values:this.props.starting||[1]}},DOT_PLOT_POINT_SIZE:function(){return this.props.apiOptions.isMobile?6:4},DOT_PLOT_POINT_PADDING:function(){return 8},DOT_TICK_POINT_SIZE:function(){return 2},render:function(){var style={marginBottom:this.props.labels[0]?75:0};return React.createElement("div",{className:"perseus-widget-plotter graphie "+ApiClassNames.INTERACTIVE,ref:"graphieDiv",style:style})},componentDidUpdate:function(prevProps,prevState){this.shouldSetupGraphie&&this.setupGraphie(prevState)},componentDidMount:function(){this.setupGraphie(this.state)},componentWillReceiveProps:function(nextProps){this.shouldSetupGraphie=_.any(["type","labels","categories","scaleY","maxY","snapsPerLine","picUrl","labelInterval","static"],function(prop){return!_.isEqual(this.props[prop],nextProps[prop])},this),_.isEqual(this.props.starting,nextProps.starting)||_.isEqual(this.state.values,nextProps.starting)||(this.shouldSetupGraphie=!0,this.setState({values:nextProps.starting}))},setupGraphie:function(prevState){var self=this;self.shouldSetupGraphie=!1;var graphieDiv=ReactDOM.findDOMNode(self.refs.graphieDiv);$(graphieDiv).empty();var graphie=GraphUtils.createGraphie(graphieDiv);self.graphie=graphie,self.graphie.pics=[],self.graphie.dotTicks=[];var isBar="bar"===self.props.type,isLine="line"===self.props.type,isPic="pic"===self.props.type,isHistogram="histogram"===self.props.type,isDotplot="dotplot"===self.props.type,isTiledPlot=isPic||isDotplot,config={},c=config,isMobile=this.props.apiOptions.isMobile;c.graph={lines:[],bars:[],points:[],dividers:[]},c.scaleY=self.props.scaleY,c.dimX=self.props.categories.length;var plotDimensions=isMobile?[288,336]:self.props.plotDimensions;if(isLine)c.dimX+=isMobile?-.2:1;else if(isHistogram)c.barPad=0,c.barWidth=1;else if(isBar)c.barPad=isMobile?.08:.15,c.barWidth=1-2*c.barPad,c.dimX+=(isMobile?-2:2)*c.barPad;else if(isTiledPlot){c.picBoxHeight=self.props.picBoxHeight,c.picBoxWidthPx=plotDimensions[0]/self.props.categories.length;var picPadAllWidth=plotDimensions[0]-c.dimX*c.picBoxWidthPx;c.picPad=picPadAllWidth/(2*c.dimX+2);var picFullWidth=c.picBoxWidthPx+2*c.picPad;c.picPad=c.picPad/picFullWidth,c.picBoxWidth=c.picBoxWidthPx/picFullWidth,c.dimX+=2*c.picPad}isDotplot&&(c.picBoxHeight=2*this.DOT_PLOT_POINT_SIZE()+this.DOT_PLOT_POINT_PADDING()),c.dimY=Math.ceil(self.props.maxY/c.scaleY)*c.scaleY;var padX=25,padY=25;if((isBar||isLine)&&isMobile&&(padX=0!==self.props.labels[1].length?17:11),isDotplot&&(padX/=2),isMobile&&isTiledPlot&&0===self.props.labels[1].length&&(padX=0),c.scale=isMobile?_.map([[c.dimX,padX],[c.dimY,padY]],function(_ref,i){var dim=_ref[0],pad=_ref[1];return(plotDimensions[i]-4*pad)/dim}):_.map([c.dimX,c.dimY],function(dim,i){return plotDimensions[i]/dim}),padX/=c.scale[0],padY/=c.scale[1],isTiledPlot&&(c.scale[1]=c.picBoxHeight/c.scaleY),graphie.init({range:[[-3*padX,c.dimX+padX],[-3*padY,c.dimY+padY]],scale:c.scale,isMobile:this.props.apiOptions.isMobile}),graphie.addMouseLayer({allowScratchpad:!0,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable}),!isTiledPlot)for(var y=isMobile?c.scaleY:0;y<=c.dimY;y+=c.scaleY)graphie.label([0,y],KhanMath.roundToApprox(y,2),"left",!0),graphie.style({stroke:isMobile?"#e9ebec":"#000",strokeWidth:1,opacity:isMobile?1:.3},function(){graphie.line([0,y],[c.dimX,y])});(isBar||isLine)&&isMobile&&(self.graphie.dragPrompt=graphie.label([c.dimX/2,c.dimY/2],"Drag handles to make graph","center",!1).css("font-weight","bold").css("color",KhanColors.KA_GREEN).css("display","none")),self.setupCategories(config),isTiledPlot&&isMobile&&(self.graphie.dotPrompt=graphie.label([c.dimX/2,c.dimY/2],"Tap to add points","center",!1).css("font-weight","bold").css("color",KhanColors.KA_GREEN).css("display","none")),isTiledPlot&&self.drawPicHeights(self.state.values,prevState.values),graphie.style({stroke:"#000",strokeWidth:2,opacity:1},function(){isTiledPlot?isDotplot?graphie.style({stroke:isMobile?KhanColors.GRAY_G:"#000",strokeWidth:isMobile?1:2},function(){return graphie.line([isMobile?0:.5,0],[c.dimX-(isMobile?0:.5),0])}):(graphie.line([0,0],[c.dimX,0]),0===self.props.labels[1].length&&isMobile||graphie.style({stroke:isMobile?KhanColors.GRAY_G:"#000",strokeWidth:isMobile?1:2},function(){return graphie.line([0,0],[0,c.dimY])})):(graphie.style({stroke:isMobile?KhanColors.GRAY_G:"#000",strokeWidth:isMobile?1:2},function(){return graphie.line([isMobile?3*-padX:0,0],[c.dimX+(isMobile?padX:0),0])}),(isBar||isLine)&&isMobile||graphie.style({stroke:isMobile?KhanColors.GRAY_G:"#000",strokeWidth:isMobile?1:2},function(){return graphie.line([0,0],[0,c.dimY])}))}),graphie.label([c.dimX/2,isMobile?3*-padY:-35/c.scale[1]],self.props.labels[0],isMobile?"above":"below",!1).css("font-weight","bold").css("color",isMobile&&KhanColors.GRAY_F),graphie.label([(isMobile?-35:-60)/c.scale[0],c.dimY/2],self.props.labels[1],"center",!1).css("font-weight","bold").css("color",isMobile&&KhanColors.GRAY_F).addClass("rotate"),this.props.apiOptions.isMobile&&(this.horizHairline=new WrappedLine(this.graphie,[0,0],[0,0],{normalStyle:{strokeWidth:1}}),this.horizHairline.attr({stroke:KhanColors.INTERACTIVE}),this.horizHairline.hide(),this.hairlineRange=[[0,c.dimX],[0,c.dimY]])},showHairlines:function(point){this.props.apiOptions.isMobile&&"none"!==this.props.markings&&(this.horizHairline.moveTo([this.hairlineRange[0][0],point[1]],[this.hairlineRange[0][1],point[1]]),this.horizHairline.show())},hideHairlines:function(){this.props.apiOptions.isMobile&&this.horizHairline.hide()},labelCategory:function(x,category){var isMobile=this.props.apiOptions.isMobile,graphie=this.graphie,isTeX=!1,mathyCategory=(category+="").match(/^\$(.*)\$$/);mathyCategory&&(category=mathyCategory[1],isTeX=!0);this.props.labels[0].length;graphie.style({color:isMobile?KhanColors.GRAY_G:"inherit",transform:isMobile&&!mathyCategory?"translateX(-50%) translateX(5px) translateY(-50%) rotate(-45deg)":"none",transformOrigin:"100%"},function(){return graphie.label([x,isMobile?-.5:0],category,"below",isTeX)})},setupCategories:function(config){var self=this,c=config,graphie=self.graphie,isMobile=this.props.apiOptions.isMobile;"histogram"===self.props.type?(_.times(self.props.categories.length-1,function(i){self.setupBar({index:i,startHeight:self.state.values[i],config:config,isHistogram:!0})}),_.each(self.props.categories,function(category,i){var x=.5+i*c.barWidth;self.labelCategory(x,category);var tickHeight=6/c.scale[1];graphie.style({stroke:"#000",strokeWidth:isMobile?1:2,opacity:1},function(){graphie.line([x,-tickHeight],[x,0])})})):_.each(self.props.categories,function(category,i){var x,startHeight=self.state.values[i];"bar"===self.props.type?x=self.setupBar({index:i,startHeight:startHeight,config:config,isHistogram:!1}):"line"===self.props.type?x=self.setupLine(i,startHeight,config):"pic"===self.props.type?x=self.setupPic(i,config):"dotplot"===self.props.type&&(x=self.setupDotplot(i,config));var tickStart=0,tickEnd=-6/c.scale[1];"dotplot"!==self.props.type||isMobile||(tickStart=-tickEnd),"dotplot"===self.props.type?i%self.props.labelInterval!=0&&i!==self.props.categories.length-1||(self.labelCategory(x,category),tickStart*=1.5,tickEnd*=1.5):self.labelCategory(x,category),graphie.style({stroke:isMobile?KhanColors.GRAY_G:"#000",strokeWidth:isMobile?1:2,opacity:1},function(){graphie.line([x,tickStart],[x,tickEnd])})})},_clampValue:function(v,min,max){return Math.max(Math.min(v,max),min)},_maybeShowDragPrompt:function(){null!=this.graphie.dragPrompt&&(this.graphie.dragPrompt[0].style.display="inline")},_maybeHideDragPrompt:function(){null!=this.graphie.dragPrompt&&(this.graphie.dragPrompt[0].style.display="none")},setupBar:function(args){var x,_this=this,isMobile=this.props.apiOptions.isMobile,i=args.index,startHeight=args.startHeight,config=args.config,isHistogram=args.isHistogram,self=this,graphie=self.graphie,barHalfWidth=config.barWidth/2;x=isHistogram?.5+i*config.barWidth+barHalfWidth:(isMobile?barHalfWidth:.5+config.barPad)+i;var scaleBar=function(i,height){var center=graphie.scalePoint(0);if(config.graph.bars[i].scale(1,Math.max(isMobile?.2:.01,height/config.scaleY),center[0],center[1]),isHistogram){var leftDivider=config.graph.dividers[i-1],rightDivider=config.graph.dividers[i];if(leftDivider){var divHeight=Math.min(self.state.values[i-1],height);leftDivider.scale(1,Math.max(.01,divHeight/config.scaleY),center[0],center[1])}if(rightDivider){divHeight=Math.min(self.state.values[i+1],height);rightDivider.scale(1,Math.max(.01,divHeight/config.scaleY),center[0],center[1])}}};if(graphie.style({stroke:"none",fill:isMobile?KhanColors.BLUE_C:KhanColors.LIGHT_BLUE,opacity:1},function(){config.graph.bars[i]=graphie.path([[x-barHalfWidth,0],[x-barHalfWidth,config.scaleY],[x+barHalfWidth,config.scaleY],[x+barHalfWidth,0],[x-barHalfWidth,0]])}),isHistogram&&i>0&&graphie.style({stroke:"#000",strokeWidth:1,opacity:.3},function(){config.graph.dividers.push(graphie.path([[x-barHalfWidth,0],[x-barHalfWidth,config.scaleY]]))}),isMobile){var snap=config.scaleY/self.props.snapsPerLine;config.graph.lines[i]=Interactive2.addMaybeMobileMovablePoint(this,{coord:[x,startHeight],constraints:[function(coord,prev,options){return[x,_this._clampValue(Math.round(coord[1]/snap)*snap,0,config.dimY)]}],onMoveStart:function(){config.graph.bars[i].attr({fill:KhanColors.INTERACTIVE})},onMove:function(){var y=config.graph.lines[i].coord()[1],values=_.clone(self.state.values);values[i]=y,self.setState({values:values}),self.changeAndTrack({values:values}),self._maybeHideDragPrompt(),scaleBar(i,y)},onMoveEnd:function(){config.graph.bars[i].attr({fill:KhanColors.BLUE_C})}}),config.graph.lines[i].state.visibleShape.wrapper.style.zIndex="1",self._maybeShowDragPrompt()}else config.graph.lines[i]=graphie.addMovableLineSegment({coordA:[x-barHalfWidth,startHeight],coordZ:[x+barHalfWidth,startHeight],snapY:config.scaleY/self.props.snapsPerLine,constraints:{constrainX:!0},normalStyle:{stroke:KhanColors.INTERACTIVE,"stroke-width":this.props.static?0:4}}),config.graph.lines[i].onMove=function(dx,dy){var y=this.coordA[1];(y<0||y>config.dimY)&&(y=Math.min(Math.max(y,0),config.dimY),this.coordA[1]=this.coordZ[1]=y,this.transform());var values=_.clone(self.state.values);values[i]=y,self.setState({values:values}),self.changeAndTrack({values:values}),scaleBar(i,y)};return scaleBar(i,startHeight),x},setupLine:function(i,startHeight,config){var _this2=this,isMobile=this.props.apiOptions.isMobile,self=this,c=config,graphie=self.graphie,x=i+(isMobile?.4:1);if(isMobile){var snap=config.scaleY/self.props.snapsPerLine;c.graph.points[i]=Interactive2.addMaybeMobileMovablePoint(this,{coord:[x,startHeight],constraints:[function(coord,prev,options){return[x,_this2._clampValue(Math.round(coord[1]/snap)*snap,0,config.dimY)]}],onMove:function(){var y=c.graph.points[i].coord()[1],values=_.clone(self.state.values);values[i]=y,self.setState({values:values}),self.changeAndTrack({values:values}),self._maybeHideDragPrompt()}}),self._maybeShowDragPrompt(),i>0&&(c.graph.lines[i]=Interactive2.addMovableLine(graphie,{points:[c.graph.points[i-1],c.graph.points[i]],constraints:Interactive2.MovablePoint.constraints.fixed(),normalStyle:{stroke:KhanColors.BLUE_C,"stroke-width":2},highlightStyle:{stroke:KhanColors.BLUE_C,"stroke-width":2}}))}else c.graph.points[i]=graphie.addMovablePoint({coord:[x,startHeight],constraints:{constrainX:!0},normalStyle:{fill:KhanColors.INTERACTIVE,stroke:KhanColors.INTERACTIVE},snapY:c.scaleY/self.props.snapsPerLine}),c.graph.points[i].onMove=function(x,y){y=Math.min(Math.max(y,0),c.dimY);var values=_.clone(self.state.values);return values[i]=y,self.setState({values:values}),self.changeAndTrack({values:values}),[x,y]},i>0&&(c.graph.lines[i]=graphie.addMovableLineSegment({pointA:c.graph.points[i-1],pointZ:c.graph.points[i],constraints:{fixed:!0},normalStyle:{stroke:"#9ab8ed","stroke-width":2}}));return x},setupDotplot:function(i,config){var _this3=this,graphie=this.graphie,isMobile=this.props.apiOptions.isMobile;return this.setupTiledPlot(i,isMobile?.5:1,config,function(x,y){return graphie.ellipse([x,y],[_this3.DOT_PLOT_POINT_SIZE()/graphie.scale[0],_this3.DOT_PLOT_POINT_SIZE()/graphie.scale[1]],{fill:KhanColors.INTERACTIVE,stroke:KhanColors.INTERACTIVE})})},setupPic:function(i,config){var _this4=this,graphie=this.graphie;return this.setupTiledPlot(i,0,config,function(x,y){var scaledCenter=graphie.scalePoint([x,y]),size=_this4.props.picSize;return graphie.raphael.image(_this4.props.picUrl,scaledCenter[0]-size/2,scaledCenter[1]-size/2,size,size)})},setupTiledPlot:function(i,bottomMargin,config,createImage){var self=this,c=config,graphie=self.graphie,pics=graphie.pics,dotTicks=graphie.dotTicks,x=i+.5+c.picPad;graphie.mouselayer.canvas.style.touchAction="none",pics[i]=[],dotTicks[i]=[];var n=Math.round(c.dimY/c.scaleY)+1;return _(n).times(function(j){var midY=((j-=1)+.5)*c.scaleY,leftX=x-c.picBoxWidth/2,topY=midY+.5*c.scaleY,coord=graphie.scalePoint([leftX,topY+bottomMargin]),mouseRect=graphie.mouselayer.rect(coord[0],coord[1],c.picBoxWidthPx,c.picBoxHeight);$(mouseRect[0]).css({fill:"#000",opacity:0,cursor:"pointer"}).on("vmousedown",function(e){e.preventDefault(),self.whichPicClicked=i,self.setPicHeight(i,topY),$(document).on("vmouseup.plotTile",function(e){$(document).unbind(".plotTile")}),$(document).on("vmousemove.plotTile",function(e){e.preventDefault();var yCoord=graphie.getMouseCoord(e)[1],adjustedCoord=Math.floor(yCoord-bottomMargin),newTopY=(Math.max(-1,Math.floor(adjustedCoord/c.scaleY))+.5)*c.scaleY+.5*c.scaleY;self.setPicHeight(self.whichPicClicked,newTopY)})}),j<0||(pics[i][j]=createImage(x,midY+bottomMargin),dotTicks[i][j]=graphie.ellipse([x,midY+bottomMargin],[self.DOT_TICK_POINT_SIZE()/graphie.scale[0],self.DOT_TICK_POINT_SIZE()/graphie.scale[1]],{fill:"#dee1e3",stroke:"#dee1e3"}))}),x},setPicHeight:function(i,y){var values=_.clone(this.state.values);values[i]=y,this.drawPicHeights(values,this.state.values),this.setState({values:values}),this.changeAndTrack({values:values})},changeAndTrack:function(data){this.props.onChange(data),this.props.trackInteraction()},drawPicHeights:function(values,prevValues){var self=this,graphie=self.graphie,pics=graphie.pics,isMobile=this.props.apiOptions.isMobile;if(isMobile){var shouldDisplay=values.every(function(v){return 0===v});graphie.dotPrompt[0].style.display=shouldDisplay?"inline":"none"}_.each(pics,function(ps,i){_.each(ps,function(pic,j){var y=(j+1)*self.props.scaleY,show=y<=values[i];if("dotplot"===self.props.type){var wasShown=y<=prevValues[i];show&&!wasShown&&pic.animate({"stroke-width":8},75,function(){return pic.animate({"stroke-width":2},75)})}$(pic[0]).css({display:show?"inline":"none"}),graphie.dotTicks[i][j][0].style.display=show||!isMobile?"none":"inline"})})},getUserInput:function(){return this.state.values},simpleValidate:function(rubric){return Plotter.validate(this.getUserInput(),rubric)}}));_.extend(Plotter,{validate:function(guess,rubric){return deepEq(guess,rubric.starting)?{type:"invalid",message:null}:{type:"points",earned:deepEq(guess,rubric.correct)?1:0,total:1,message:null}}});var staticTransform=_.identity;module.exports={name:"plotter",displayName:"Plotter",widget:Plotter,staticTransform:staticTransform}}).call(this,__webpack_require__(10))},688:function(module,exports,__webpack_require__){var React=__webpack_require__(0),Molecule=__webpack_require__(648).molecule,Separator=React.createClass({displayName:"Separator",propTypes:{data:React.PropTypes.any,index:React.PropTypes.number},componentDidMount:function(){this.drawArrow()},componentDidUpdate:function(){this.drawArrow()},arrowLength:100,drawArrow:function(){var canvas=this.refs["arrowCanvas"+this.props.index],ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);var path=new Path2D;ctx.strokeStyle="rgb(0,0,0)",ctx.lineWidth=1.2,ctx.lineCap="round";path.moveTo(5,canvas.height/2),path.lineTo(canvas.width-5,canvas.height/2),path.moveTo(canvas.width-10,canvas.height/2-5),path.lineTo(canvas.width-5,canvas.height/2),path.moveTo(canvas.width-10,canvas.height/2+5),path.lineTo(canvas.width-5,canvas.height/2),ctx.stroke(path)},render:function(){return React.createElement("div",{className:"arrow-container"},React.createElement("div",{className:"above-text"},this.props.data.topText),React.createElement("canvas",{height:"30",id:"arrowCanvas"+this.props.index,ref:"arrowCanvas"+this.props.index,width:this.arrowLength},"Reaction arrow pointing to the right."),React.createElement("div",{className:"below-text"},this.props.data.bottomText))}}),ReactionDiagramWidget=React.createClass({displayName:"ReactionDiagramWidget",propTypes:{rotationAngle:React.PropTypes.arrayOf(React.PropTypes.number),separators:React.PropTypes.arrayOf(React.PropTypes.object),smiles:React.PropTypes.arrayOf(React.PropTypes.string),widgetId:React.PropTypes.string},getDefaultProps:function(){return{smiles:[],rotationAngle:[],separators:[]}},simpleValidate:function(){return{type:"points",earned:0,total:0,message:null}},getUserInput:function(){return[]},validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}},focus:function(){return!0},render:function(){var _this=this;return React.createElement("div",{className:"reaction",ref:"reaction"},this.props.smiles.map(function(s,i){var id=_this.props.widgetId+"-"+i;return React.createElement("div",{key:id,className:"molecule-container"},React.createElement(Molecule,{id:id,rotationAngle:_this.props.rotationAngle[i],smiles:s}),i===_this.props.smiles.length-1?null:React.createElement(Separator,{data:_this.props.separators[i],index:i}))}))}});module.exports={name:"reaction-diagram",displayName:"Chemical reaction",hidden:!0,widget:ReactionDiagramWidget}},689:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),ApiOptions=__webpack_require__(13).Options,Changeable=__webpack_require__(156),iconOk=__webpack_require__(72).iconOk,InlineIcon=__webpack_require__(58),Renderer=__webpack_require__(33),Util=__webpack_require__(19),_require2=__webpack_require__(25),linterContextProps=_require2.linterContextProps,linterContextDefault=_require2.linterContextDefault,Sequence=React.createClass({displayName:"Sequence",propTypes:_extends({},Changeable.propTypes,{apiOptions:ApiOptions.propTypes,json:React.PropTypes.arrayOf(React.PropTypes.shape({content:React.PropTypes.string,images:React.PropTypes.object,widgets:React.PropTypes.object})),trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps}),getDefaultProps:function(){return{json:[{content:"",widgets:{},images:{}}],linterContext:linterContextDefault}},getInitialState:function(){return{visible:1}},shouldComponentUpdate:function(nextProps,nextState){return nextProps!==this.props||nextState!==this.state},render:function(){var _this=this,icon=React.createElement(InlineIcon,_extends({},iconOk,{style:{color:"green"}})),content=_.chain(this.props.json).first(this.state.visible).map(function(step,i){return"[["+Util.snowman+" group "+i+"]]"}).join("\n\n").value(),widgets={};return _.each(this.props.json,function(step,i){widgets["group "+i]={type:"group",graded:!0,version:{major:0,minor:0},options:_.extend({},step,{icon:i<_this.state.visible-1?icon:null})}}),React.createElement("div",{className:"perseus-sequence"},React.createElement(Renderer,{ref:"renderer",content:content,widgets:widgets,onInteractWithWidget:this._handleInteraction,apiOptions:this.props.apiOptions,linterContext:this.props.linterContext}))},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},_handleInteraction:function(groupWidgetId){var step=parseInt(groupWidgetId.split(" ")[1]);if(step===this.state.visible-1){var widget=this.refs.renderer.getWidgetInstance("group "+step);widget.showRationalesForCurrentlySelectedChoices();var score=widget.simpleValidate();"points"===score.type&&score.total===score.earned&&(this.setState({visible:this.state.visible+1}),this.props.trackInteraction({visible:this.state.visible+1}))}}});module.exports={name:"sequence",displayName:"Graded Sequence",widget:Sequence,traverseChildWidgets:function(props,traverseRenderer){var oldJson=props.json;_.isArray(oldJson)||(oldJson=[oldJson]);var json=_.map(oldJson,function(rendererOptions){return traverseRenderer(rendererOptions)});return _.extend({},props,{json:json})},tracking:"all",hidden:!0,isLintable:!0}},690:function(module,exports,__webpack_require__){(function(i18n){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},InfoTip=__webpack_require__(646),React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),Changeable=__webpack_require__(156),ApiOptions=__webpack_require__(13).Options,assert=__webpack_require__(34).assert,Graphie=__webpack_require__(268),Path=Graphie.Path,Arc=Graphie.Arc,Label=(Graphie.Circle,Graphie.Label),Line=Graphie.Line,MovablePoint=Graphie.MovablePoint,MovableLine=Graphie.MovableLine,NumberInput=__webpack_require__(642),MathOutput=__webpack_require__(267),Util=(__webpack_require__(19).seededRNG,__webpack_require__(19)),knumber=__webpack_require__(9).number,KhanColors=__webpack_require__(43),KhanMath=__webpack_require__(44),Histogram=React.createClass({displayName:"Histogram",propTypes:{data:React.PropTypes.arrayOf(React.PropTypes.number),xAxisLabel:React.PropTypes.string,yAxisLabel:React.PropTypes.string,box:React.PropTypes.arrayOf(React.PropTypes.number)},getDefaultProps:function(){return{data:null,xAxisLabel:"Proportion (%)",yAxisLabel:"Number of times seen",box:[400,400]}},getInitialState:function(){return{threshold:this._getInitialThreshold(this._range())}},componentWillReceiveProps:function(nextProps){var oldRange=this._range(),nextRange=this._range(nextProps);Util.deepEq(oldRange,nextRange)||this.setState({threshold:this._getInitialThreshold(nextRange)})},_renderThresholdLine:function(){var _this=this,yRange=[0,this._range()[1][1]],coords=_.map(yRange,function(y){return[_this.state.threshold,y]});return React.createElement(MovableLine,{onMove:this.handleMouseInteraction},_.map(coords,function(coord,i){return React.createElement(MovablePoint,{key:i,static:!0,coord:coord,normalStyle:{stroke:"none",fill:"none"}})}))},_renderCircle:function(){var options,_this2=this,data=this.props.data,total=_.reduce(data,function(sum,next){return sum+next},0),numBelow=_.reduce(data,function(sum,next,i){return null!=_this2.state.threshold&&i<=_this2.state.threshold?sum+next:sum},0),proportionBelow=numBelow/total,center=[this.props.box[0]-30,30],xRange=this._range()[0],formattedThreshold=Math.min(Math.max(this.state.threshold,xRange[0]),xRange[1]).toFixed(2);return[proportionBelow>0&&(options={key:"below",center:center,radius:20,startAngle:0,endAngle:proportionBelow<1?360*proportionBelow:360-1e-5,sector:1!==proportionBelow,unscaled:!0,style:{fill:KhanColors.LIGHT_RED,stroke:KhanColors.RED}},React.createElement(Arc,options)),proportionBelow<1&&function(){var options={key:"above",center:center,radius:20,startAngle:proportionBelow>0?360*proportionBelow:1e-5,endAngle:360,sector:0!==proportionBelow,unscaled:!0,style:{fill:KhanColors.LIGHT_BLUE,stroke:KhanColors.BLUE}};return React.createElement(Arc,options)}(),function(){var options={key:"label",coord:[center[0],center[1]+30],text:numBelow+" of "+total+" results below "+formattedThreshold+"%",direction:"center",tex:!1,unscaled:!0,style:{fontSize:"12px"}};return React.createElement(Label,options)}()]},_renderData:function(){var _this3=this,data=this.props.data;this._range();return _.map(data,function(count,i){if(count){var isBelow=null!=_this3.state.threshold&&i<=_this3.state.threshold,style={fill:isBelow?KhanColors.LIGHT_RED:KhanColors.LIGHT_BLUE,stroke:isBelow?KhanColors.RED:KhanColors.BLUE},coords=[[i,0],[i,count],[i+1,count],[i+1,0]];return React.createElement(Path,{key:i,coords:coords,style:style})}})},render:function(){var data=this.props.data,range=this._range(),options={xAxisLabel:this.props.xAxisLabel,yAxisLabel:this.props.yAxisLabel,box:this.props.box,range:range,data:data,scale:[Util.scaleFromExtent(range[0],this.props.box[0]),Util.scaleFromExtent(range[1],this.props.box[1])]},origin=[range[0][0],0],bottomRight=[range[0][1],0];return React.createElement(Graphie,{box:options.box,range:options.range,options:options,setup:this._setupGraphie,onMouseMove:this.handleMouseInteraction,onMouseDown:this.handleMouseInteraction,setDrawingAreaAvailable:this.props.setDrawingAreaAvailable},React.createElement(Line,{start:origin,end:bottomRight,style:{stroke:"#000",strokeWidth:1,opacity:1}}),data&&this._renderData(),data&&this._renderCircle(),data&&this._renderThresholdLine())},_setupGraphie:function(graphie,options){var data=options.data,range=options.range,scale=options.scale,xWidth=range[0][1]-range[0][0],yWidth=range[1][1]-0,ySkip=Math.ceil(yWidth/20);if(_.each(_.range(0,range[1][1],ySkip),function(y){data&&graphie.label([range[0][0],y],KhanMath.roundToApprox(y,2),"left",!0),graphie.line([range[0][0],y],[range[0][1],y],{stroke:"#000",strokeWidth:1,opacity:.3})}),data){var xSkip=Math.ceil(xWidth/15);_.each(_.range(range[0][0],range[0][1],xSkip),function(x){graphie.label([x,0],knumber.round(x,2),"below",!0);graphie.line([x,0],[x,-8/scale[1]],{stroke:"#000",strokeWidth:1})})}var origin=[range[0][0],0],topLeft=[range[0][0],range[1][1]];graphie.line(origin,topLeft,{stroke:"#000",strokeWidth:2,opacity:1});var xMid=range[0][0]+xWidth/2,xOffset=data?25:0;graphie.label([xMid,-xOffset/scale[1]],options.xAxisLabel,"below",!1).css("font-weight","bold");var yMid=0+yWidth/2,yOffset=data?55:28;graphie.label([range[0][0]-yOffset/scale[0],yMid],options.yAxisLabel,"center",!1).css("font-weight","bold").css("-webkit-transform","rotate(-90deg)")},handleMouseInteraction:function(point){this.setState({threshold:point[0]})},_range:function(props){return(props=props||this.props).data?this._getRangeForData(props.data):[[0,100],[-1,10]]},_getRangeForData:function(data){var firstIndex=_.indexOf(data,_.find(data,function(n){return n>0})),xMin=Math.max(0,firstIndex-10),lastIndex=_.lastIndexOf(data,_.last(_.filter(data,function(n){return n>0})));return[[xMin,Math.min(101,lastIndex+1+10)],[-1,_.max(data)]]},_getInitialThreshold:function(range){var xRange=range[0];return xRange[0]+(xRange[1]-xRange[0])/3}}),Simulator=React.createClass({displayName:"Simulator",propTypes:_extends({},Changeable.propTypes,{apiOptions:ApiOptions.propTypes,data:React.PropTypes.arrayOf(React.PropTypes.number),numTrials:React.PropTypes.number,proportionLabel:React.PropTypes.string,proportionOrPercentage:React.PropTypes.string,randomSeed:React.PropTypes.number,sampleSize:React.PropTypes.number,trackInteraction:React.PropTypes.func.isRequired,userProportion:React.PropTypes.number,xAxisLabel:React.PropTypes.string,yAxisLabel:React.PropTypes.string}),getInitialState:function(){return{invalidInput:!1}},getDefaultProps:function(){return{data:null,userProportion:null,sampleSize:null,numTrials:null,randomSeed:0,xAxisLabel:"Proportion (%)",yAxisLabel:"Number of times seen",proportionLabel:"Underlying proportion",proportionOrPercentage:"proportion",apiOptions:ApiOptions.defaults}},componentWillMount:function(){null!=this.props.randomSeed&&(this.generateNumber=Util.seededRNG(this.props.randomSeed))},componentWillReceiveProps:function(nextProps){nextProps.randomSeed!==this.props.randomSeed&&(this.generateNumber=Util.seededRNG(nextProps.randomSeed))},render:function(){var _this4=this,inputStyle={marginLeft:"5px"},highlight="0px 0px 0px 2px rgba(255, 165, 0, 1)",highlightStyle=_.extend({},inputStyle,{WebkitBoxShadow:highlight,MozBoxShadow:highlight,boxShadow:highlight,transition:"all 0.15s"}),unhighlightStyle=_.extend({},inputStyle,{transition:"all 0.15s"}),style=this.state.invalidInput?highlightStyle:unhighlightStyle,InputComponent=this.props.apiOptions.staticRender?MathOutput:NumberInput,proportionInput=React.createElement("div",null,React.createElement(InputComponent,{ref:"userProportion",style:style,value:this.calculateDisplayProportion(),checkValidity:this.checkProportionValidity,disabled:this.props.apiOptions.readOnly,onChange:this.handleUserProportionChange,onFocus:function(){return _this4.props.onFocus(["userProportion"])},onBlur:function(){return _this4.props.onBlur(["userProportion"])}}),React.createElement(InfoTip,null,React.createElement("p",null,"This controls the proportion or percentage that will be used in your simulation."))),sampleSizeInput=React.createElement("div",null,React.createElement(InputComponent,{ref:"sampleSize",style:style,value:this.props.sampleSize,checkValidity:function(val){return val>=0},disabled:this.props.apiOptions.readOnly,onChange:this.handleSampleSizeChange,onFocus:function(){return _this4.props.onFocus(["sampleSize"])},onBlur:function(){return _this4.props.onBlur(["sampleSize"])}}),React.createElement(InfoTip,null,React.createElement("p",null,"This controls the sample size that will be used in your simulation. For example, if you set this to 100, then for each trial, responses from 100 participants will be simulated."))),numTrialsDisplay=React.createElement("div",{style:{textAlign:"right"}},React.createElement("b",null,this.props.numTrials),React.createElement(InfoTip,null,React.createElement("p",null,"This is the number of trials used in the simulation. For example, if set to 50, then the survey will be conducted 50 times."))),contents=[{title:this.props.proportionLabel+":",value:proportionInput},{title:"Sample size:",value:sampleSizeInput},{title:"Number of trials:",value:numTrialsDisplay}],startButton=React.createElement("button",{className:"simple-button",style:{margin:"20px 0"},disabled:this.props.apiOptions.readOnly,onClick:this.handleRunSimulation},i18n._("Run simulation")),histogramStyle={paddingBottom:this.props.data?40:0},histogram=React.createElement("div",{style:histogramStyle},React.createElement(Histogram,{data:this.props.data,xAxisLabel:this.props.xAxisLabel,yAxisLabel:this.props.yAxisLabel,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable}));return React.createElement("div",null,function(contents){var header=React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Parameter"),React.createElement("th",null,"Value"))),body=React.createElement("tbody",null,_.map(contents,function(row,i){return React.createElement("tr",{key:i},React.createElement("td",null,row.title),React.createElement("td",null,row.value))}));return React.createElement("table",null,header,body)}(contents),startButton,histogram)},calculateDisplayProportion:function(){var userProportion=this.props.userProportion;return"percentage"===this.props.proportionOrPercentage?Math.round(100*userProportion):userProportion},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},checkProportionValidity:function(value){return value>=0&&"proportion"===this.props.proportionOrPercentage&&value<=1||"percentage"===this.props.proportionOrPercentage&&value<=100},handleUserProportionChange:function(value,cb){var userProportion;null!=(userProportion="percentage"===this.props.proportionOrPercentage?value/100:value)&&(userProportion=Math.min(1,Math.max(0,userProportion))),this.props.onChange({userProportion:userProportion},cb)},handleSampleSizeChange:function(sampleSize,cb){null!=sampleSize&&(sampleSize=Math.min(1e3,Math.max(0,Math.floor(sampleSize)))),this.props.onChange({sampleSize:sampleSize},cb)},handleRunSimulation:function(){null!=this.props.numTrials&&null!=this.props.userProportion&&null!=this.props.sampleSize?(this.setState({invalidInput:!1}),this.props.onChange({data:this.generateData()}),this.props.trackInteraction()):this.setState({invalidInput:!0})},generateData:function(props){var sampleSize,numTrials,proportion,draw,sampleDistribution,_this5=this;return props=props||this.props,sampleSize=props.sampleSize,numTrials=props.numTrials,proportion=props.userProportion,draw=function(){return _this5.generateNumber()<proportion},sampleDistribution=_.times(101,function(){return 0}),_.times(numTrials,function(){var results=_.times(sampleSize,draw),count=_.filter(results,_.identity).length,normalizedCount=Math.floor(100*count/sampleSize);sampleDistribution[normalizedCount]++}),sampleDistribution},getInputPaths:function(){return[["userProportion"],["sampleSize"]]},focus:function(){var path=_.head(this.getInputPaths());return this.focusInputPath(path),!0},focusInputPath:function(path){assert(path.length>0);var inputID=_.head(path);this.refs[inputID].focus()},blurInputPath:function(path){assert(path.length>0);var inputID=_.head(path);this.refs[inputID].blur()},getDOMNodeForPath:function(path){assert(path.length>0);var inputID=_.head(path);return ReactDOM.findDOMNode(this.refs[inputID])},getGrammarTypeForPath:function(path){return assert(path.length>0),"number"},setInputValue:function(path,newValue,cb){assert(path.length>0);var inputID=_.head(path);this["handle"+(inputID.charAt(0).toUpperCase()+inputID.slice(1))+"Change"](newValue,cb)},getUserInput:function(){return null},simpleValidate:function(rubric){return Simulator.validate(this.getUserInput(),rubric)}});_.extend(Simulator,{validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}}});module.exports={name:"simulator",displayName:"Simulator",widget:Simulator,transform:function(editorProps){var widgetProps=_.clone(editorProps);return widgetProps.randomSeed=editorProps.problemNum,widgetProps},hidden:!0}}).call(this,__webpack_require__(21))},691:function(module,exports,__webpack_require__){var React=__webpack_require__(0),_=__webpack_require__(1),Sortable=__webpack_require__(647),ApiOptions=__webpack_require__(13).Options,shuffle=__webpack_require__(19).shuffle,_require=__webpack_require__(25),linterContextProps=_require.linterContextProps,linterContextDefault=_require.linterContextDefault,Sorter=React.createClass({displayName:"Sorter",propTypes:{apiOptions:ApiOptions.propTypes,correct:React.PropTypes.array,layout:React.PropTypes.oneOf(["horizontal","vertical"]),onChange:React.PropTypes.func,padding:React.PropTypes.bool,problemNum:React.PropTypes.number,trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps},getDefaultProps:function(){return{correct:[],layout:"horizontal",padding:!0,problemNum:0,onChange:function(){},linterContext:linterContextDefault}},render:function(){var options=shuffle(this.props.correct,this.props.problemNum,!0),marginPx=this.props.apiOptions.isMobile?8:5;return React.createElement("div",{className:"perseus-widget-sorter perseus-clearfix"},React.createElement(Sortable,{options:options,layout:this.props.layout,margin:marginPx,padding:this.props.padding,onChange:this.handleChange,linterContext:this.props.linterContext,ref:"sortable"}))},handleChange:function(e){this.props.onChange(e),this.props.trackInteraction()},getUserInput:function(){return{options:this.refs.sortable.getOptions()}},simpleValidate:function(rubric){return Sorter.validate(this.getUserInput(),rubric)}});_.extend(Sorter,{validate:function(state,rubric){return{type:"points",earned:_.isEqual(state.options,rubric.correct)?1:0,total:1,message:null}}}),module.exports={name:"sorter",displayName:"Sorter",widget:Sorter,isLintable:!0}},692:function(module,exports,__webpack_require__){var React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),MathOutput=__webpack_require__(267),SimpleKeypadInput=__webpack_require__(158),Renderer=__webpack_require__(33),Util=__webpack_require__(19),keypadElementPropType=__webpack_require__(28).propTypes.keypadElementPropType,ApiOptions=__webpack_require__(13).Options,KhanAnswerTypes=__webpack_require__(73),_require=__webpack_require__(25),linterContextProps=_require.linterContextProps,linterContextDefault=_require.linterContextDefault,assert=__webpack_require__(34).assert,getInputPath=function(row,column){return[""+row,""+column]},getRowFromPath=function(path){return assert(_.isArray(path)&&2===path.length),+path[0]},getColumnFromPath=function(path){return assert(_.isArray(path)&&2===path.length),+path[1]},getRefForPath=function(path){return"answer"+getRowFromPath(path)+","+getColumnFromPath(path)},Table=React.createClass({displayName:"Table",propTypes:{answers:React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.string)),editableHeaders:React.PropTypes.bool,Editor:React.PropTypes.func,headers:React.PropTypes.arrayOf(React.PropTypes.string),keypadElement:keypadElementPropType,trackInteraction:React.PropTypes.func.isRequired,linterContext:linterContextProps},getDefaultProps:function(){var blankAnswers=_(4).times(function(){return Util.stringArrayOfSize(1)});return{apiOptions:ApiOptions.defaults,headers:[""],editableHeaders:!1,rows:4,columns:1,answers:blankAnswers,linterContext:linterContextDefault}},_getRows:function(){return this.props.answers.length},_getColumns:function(){return this.props.answers[0].length},render:function(){var _this=this,rows=this._getRows(),columns=this._getColumns(),headers=this.props.headers,InputComponent=void 0,inputStyle=void 0;return this.props.apiOptions.customKeypad?(InputComponent=SimpleKeypadInput,inputStyle={width:80}):this.props.apiOptions.staticRender?(InputComponent=MathOutput,inputStyle={}):(InputComponent="input",inputStyle={}),React.createElement("table",{className:"perseus-widget-table-of-values non-markdown"},React.createElement("thead",null,React.createElement("tr",null,_.map(headers,function(header,i){return _this.props.editableHeaders?React.createElement("th",{key:i},React.createElement(_this.props.Editor,{ref:"columnHeader"+i,apiOptions:_this.props.apiOptions,content:header,widgetEnabled:!1,onChange:_.partial(_this.onHeaderChange,i)})):React.createElement("th",{key:i},React.createElement(Renderer,{content:header,linterContext:_this.props.linterContext}))}))),React.createElement("tbody",null,_(rows).times(function(r){return React.createElement("tr",{key:r},_(columns).times(function(c){return React.createElement("td",{key:c},React.createElement(InputComponent,{ref:getRefForPath(getInputPath(r,c)),type:"text",value:_this.props.answers[r][c],keypadElement:_this.props.keypadElement,disabled:_this.props.apiOptions.readOnly,onFocus:_.partial(_this._handleFocus,getInputPath(r,c)),onBlur:_.partial(_this._handleBlur,getInputPath(r,c)),onChange:_.partial(_this.onValueChange,r,c),style:inputStyle}))}))})))},getUserInput:function(){return _.map(this.props.answers,_.clone)},onValueChange:function(row,column,eventOrValue){var answers=_.map(this.props.answers,_.clone);answers[row][column]=eventOrValue.target?eventOrValue.target.value:eventOrValue,this.props.onChange({answers:answers}),this.props.trackInteraction()},onHeaderChange:function(index,e){var headers=this.props.headers.slice();headers[index]=e.content,this.props.onChange({headers:headers})},simpleValidate:function(rubric){return Table.validate(this.getUserInput(),rubric)},_handleFocus:function(inputPath){this.props.onFocus(inputPath)},_handleBlur:function(inputPath){this.props.onBlur(inputPath)},focus:function(){return this.focusInputPath(getInputPath(0,0)),!0},focusInputPath:function(path){var inputID=getRefForPath(path),inputComponent=this.refs[inputID];this.props.apiOptions.customKeypad?inputComponent.focus():this.props.apiOptions.staticRender?inputComponent.focus():ReactDOM.findDOMNode(inputComponent).focus()},blurInputPath:function(path){var inputID=getRefForPath(path),inputComponent=this.refs[inputID];this.props.apiOptions.customKeypad?inputComponent.blur():this.props.apiOptions.staticRender?inputComponent.blur():ReactDOM.findDOMNode(inputComponent).blur()},getDOMNodeForPath:function(path){var inputID=getRefForPath(path);return ReactDOM.findDOMNode(this.refs[inputID])},getInputPaths:function(){var rows=this._getRows(),columns=this._getColumns(),inputPaths=[];return _(rows).times(function(r){_(columns).times(function(c){var inputPath=getInputPath(r,c);inputPaths.push(inputPath)})}),inputPaths},getGrammarTypeForPath:function(inputPath){return"number"},setInputValue:function(path,newValue,cb){var row=getRowFromPath(path),column=getColumnFromPath(path),answers=_.map(this.props.answers,_.clone);answers[row][column]=newValue,this.props.onChange({answers:answers},cb)}});_.extend(Table,{validate:function(state,rubric){var filterNonEmpty=function(table){return _.filter(table,function(row){return _.some(row,_.identity)})},solution=filterNonEmpty(rubric.answers),supplied=filterNonEmpty(state);if(_.some(supplied,function(row){return _.some(row,function(cell){return""===cell})})||!supplied.length)return{type:"invalid",message:null};if(supplied.length!==solution.length)return{type:"points",earned:0,total:1,message:null};var createValidator=KhanAnswerTypes.number.createValidatorFunctional,message=null;return{type:"points",earned:_.every(solution,function(rowSolution){var i;for(i=0;i<supplied.length;i++){var rowSupplied=supplied[i];if(_.every(rowSupplied,function(cellSupplied,i){var cellSolution=rowSolution[i],result=createValidator(cellSolution,{simplify:!0})(cellSupplied);return result.message&&(message=result.message),result.correct}))return supplied.splice(i,1),!0}return!1})?1:0,total:1,message:message}}});module.exports={name:"table",displayName:"Table of values",accessible:!0,widget:Table,transform:function(editorProps){var rows=editorProps.answers.length,columns=editorProps.answers[0].length,blankAnswers=_(rows).times(function(){return Util.stringArrayOfSize(columns)});return _.extend({},editorProps,{answers:blankAnswers})},hidden:!0,isLintable:!0}},693:function(module,exports,__webpack_require__){(function(i18n,$_,$){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),Graph=__webpack_require__(645),InlineIcon=__webpack_require__(58),NumberInput=__webpack_require__(642),MathOutput=__webpack_require__(267),TeX=__webpack_require__(74),SimpleKeypadInput=__webpack_require__(158),ApiOptions=__webpack_require__(13).Options,keypadElementPropType=__webpack_require__(28).propTypes.keypadElementPropType,DEGREE_SIGN="",_require=__webpack_require__(72),iconPlus=_require.iconPlus,iconUndo=_require.iconUndo,deepEq=__webpack_require__(19).deepEq,getGridStep=__webpack_require__(19).getGridStep,captureScratchpadTouchStart=__webpack_require__(19).captureScratchpadTouchStart,knumber=__webpack_require__(9).number,kvector=__webpack_require__(9).vector,kpoint=__webpack_require__(9).point,kray=__webpack_require__(9).ray,kline=__webpack_require__(9).line,KhanMath=__webpack_require__(44),KhanColors=__webpack_require__(43),assert=__webpack_require__(34).assert,defaultBackgroundImage={url:null};var defaultTransformerProps={apiOptions:ApiOptions.defaults,gradeEmpty:!1,graphMode:"interactive",listMode:"dynamic",graph:{},tools:{translation:{enabled:!0,required:!1,constraints:{}},rotation:{enabled:!0,required:!1,constraints:{fixed:!1},coord:[1,6]},reflection:{enabled:!0,required:!1,constraints:{fixed:!1},coords:[[2,-4],[2,2]]},dilation:{enabled:!0,required:!1,constraints:{fixed:!1},coord:[6,6]}},drawSolutionShape:!0,starting:{shape:{type:"polygon-3",coords:[[2,2],[2,6],[7,2]]},transformations:[]},correct:{shape:{type:"polygon-3",coords:[[2,2],[2,6],[7,2]]},transformations:[]}};function colorForTool(tool){return tool.constraints.fixed?KhanColors.DYNAMIC:KhanColors.INTERACTIVE}function stringFromDecimal(number){return String(KhanMath.roundTo(9,number))}function texFromPoint(point){return[React.createElement(TeX,null,"("),stringFromDecimal(point[0]),React.createElement(TeX,null,", {}"),stringFromDecimal(point[1]),React.createElement(TeX,null,")")]}function orderInsensitiveCoordsEqual(coords1,coords2){return coords1=_.clone(coords1).sort(kpoint.compare),coords2=_.clone(coords2).sort(kpoint.compare),_.all(_.map(coords1,function(coord1,i){var coord2=coords2[i];return kpoint.equal(coord1,coord2)}))}var inputComponentForApiOptions=function(apiOptions){return apiOptions.customKeypad?SimpleKeypadInput:apiOptions.staticRender?MathOutput:NumberInput},TransformOps={apply:function(transform){return Transformations[transform.type].isValid(transform)?Transformations[transform.type].apply(transform):_.identity},append:function(transformList,newTransform){var results=TransformOps._appendAndCollapseLastTwo(transformList,newTransform);return TransformOps._collapseFinalNoOps(results)},_collapseFinalNoOps:function(transforms){return transforms.length&&TransformOps.isNoOp(_.last(transforms))?_.initial(transforms):transforms},_appendAndCollapseLastTwo:function(transformList,newTransform){if(transformList.length){var collapsed=TransformOps.collapse(_.last(transformList),newTransform);return _.initial(transformList).concat(collapsed)}return[newTransform]},isNoOp:function(transform){return Transformations[transform.type].isNoOp(transform)},collapse:function(transform1,transform2){return transform1.type!==transform2.type?[transform1,transform2]:TransformOps.isEmpty(transform1)&&TransformOps.isEmpty(transform2)?[]:TransformOps.isValid(transform1)&&TransformOps.isValid(transform2)?TransformOps._collapseValidMonotypedTransforms(transform1,transform2):[transform1,transform2]},isValid:function(transform){return Transformations[transform.type].isValid(transform)},isEmpty:function(transform){return Transformations[transform.type].isEmpty(transform)},_collapseValidMonotypedTransforms:function(transform1,transform2){var collapsed=Transformations[transform1.type].collapse(transform1,transform2);return collapsed?(_.isArray(collapsed)||(collapsed=[collapsed]),_.each(collapsed,function(transform){transform.type=transform1.type}),collapsed):[transform1,transform2]},toTeX:function(transform){return Transformations[transform.type].toTeX(transform)},ListItem:React.createClass({displayName:"ListItem",render:function(){if("dynamic"===this.props.mode)return React.createElement("div",null,TransformOps.toTeX(this.props.transform));if("interactive"===this.props.mode){var TransformClass=Transformations[this.props.transform.type].Input;return React.createElement(TransformClass,_extends({ref:"transform",onChange:this.handleChange,onFocus:this.props.onFocus,onBlur:this.props.onBlur,keypadElement:this.props.keypadElement,apiOptions:this.props.apiOptions},this.props.transform))}throw new Error("Invalid mode: "+this.props.mode)},value:function(){return"interactive"===this.props.mode?_.extend({type:this.props.transform.type},this.refs.transform.value()):this.props.transform},handleChange:_.debounce(function(callback){this.props.onChange(this.value(),callback)},300),_getComponentAtPath:function(path){var transform=this.refs.transform,ref=_.head(path);return transform.refs[ref]},focus:function(){var transform=this.refs.transform,path=_.head(transform.getInputPaths());path&&this.focusInputPath(path)},focusInputPath:function(path){this._getComponentAtPath(path).focus()},blurInputPath:function(path){this._getComponentAtPath(path).blur()},getDOMNodeForPath:function(path){return ReactDOM.findDOMNode(this._getComponentAtPath(path))},getGrammarTypeForPath:function(path){return"number"},setInputValue:function(path,value,cb){value.length&&(value=parseFloat(value),isNaN(value))||this.refs.transform.setInputValue(path,value,cb)},getInputPaths:function(){return"dynamic"===this.props.mode?[]:this.refs.transform.getInputPaths()}})},Transformations={translation:{verbName:i18n._("Translate"),nounName:i18n._("Translation"),lowerNounName:i18n._("translation"),apply:function(transform){return function(coord){return kvector.add(coord,transform.vector)}},isValid:function(transform){return _.isFinite(transform.vector[0])&&_.isFinite(transform.vector[1])},isEmpty:function(transform){return null===transform.vector[0]&&null===transform.vector[1]},isNoOp:function(transform){return kvector.equal(transform.vector,[0,0])},collapse:function(transform1,transform2){return{vector:kvector.add(transform1.vector,transform2.vector)}},toTeX:function(transform){return $_({vector:(vector=transform.vector,[React.createElement(TeX,null,"\\langle"),stringFromDecimal(vector[0]),React.createElement(TeX,null,", {}"),stringFromDecimal(vector[1]),React.createElement(TeX,null,"\\rangle")])},"Translation by { vector }");var vector},Input:React.createClass({displayName:"Input",getInitialState:function(){return{vector:this.props.vector||[null,null]}},componentDidUpdate:function(prevProps){deepEq(this.props,prevProps)||this.setState({vector:this.props.vector})},render:function(){var _this=this,InputComponent=inputComponentForApiOptions(this.props.apiOptions),vector=[React.createElement(TeX,null,"\\langle"),React.createElement(InputComponent,{ref:"x",placeholder:0,value:this.state.vector[0],useArrowKeys:!0,onChange:function(val0){var val1=_this.state.vector[1];_this.setState({vector:[val0,val1]},function(){_this.props.onChange()})},onFocus:_.partial(this.props.onFocus,"x"),onBlur:_.partial(this.props.onBlur,"x"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,", {}"),React.createElement(InputComponent,{ref:"y",placeholder:0,value:this.state.vector[1],useArrowKeys:!0,onChange:function(val1){var val0=_this.state.vector[0];_this.setState({vector:[val0,val1]},function(){_this.props.onChange()})},onFocus:_.partial(this.props.onFocus,"y"),onBlur:_.partial(this.props.onBlur,"y"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,"\\rangle")];return React.createElement("div",null,$_({vector:vector},"Translation by { vector }"))},value:function(){return{vector:[this.refs.x.getValue(),this.refs.y.getValue()]}},setInputValue:function(path,value,cb){var _this2=this,id=_.first(path),vector=_.clone(this.state.vector);"x"===id?vector[0]=value:"y"===id&&(vector[1]=value),this.setState({vector:vector},function(){_this2.props.onChange(cb)})},getInputPaths:function(){return[["x"],["y"]]}})},rotation:{verbName:i18n._("Rotate"),nounName:i18n._("Rotation"),lowerNounName:i18n._("rotation"),apply:function(transform){return function(coord){return kpoint.rotateDeg(coord,transform.angleDeg,transform.center)}},isValid:function(transform){return _.isFinite(transform.angleDeg)&&_.isFinite(transform.center[0])&&_.isFinite(transform.center[1])},isEmpty:function(transform){return null===transform.angleDeg&&null===transform.center[0]&&null===transform.center[1]},isNoOp:function(transform){return knumber.equal(transform.angleDeg,0)},collapse:function(transform1,transform2){return!!kpoint.equal(transform1.center,transform2.center)&&{center:transform1.center,angleDeg:transform1.angleDeg+transform2.angleDeg}},toTeX:function(transform){return $_({degrees:(angleDeg=transform.angleDeg,stringFromDecimal(angleDeg)+DEGREE_SIGN),point:texFromPoint(transform.center)},"Rotation by { degrees } about { point }");var angleDeg},Input:React.createClass({displayName:"Input",getInitialState:function(){return{center:this.props.center||[null,null],angleDeg:this.props.angleDeg||null}},componentDidUpdate:function(prevProps){deepEq(this.props,prevProps)||this.setState({center:this.props.center,angleDeg:this.props.angleDeg})},render:function(){var _this3=this,InputComponent=inputComponentForApiOptions(this.props.apiOptions),point=[React.createElement(TeX,null,"("),React.createElement(InputComponent,{ref:"centerX",placeholder:0,value:this.state.center[0],useArrowKeys:!0,onChange:function(val0){var val1=_this3.state.center[1];_this3.setState({center:[val0,val1]},function(){_this3.props.onChange()})},onFocus:_.partial(this.props.onFocus,"centerX"),onBlur:_.partial(this.props.onBlur,"centerX"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,", {}"),React.createElement(InputComponent,{ref:"centerY",placeholder:0,value:this.state.center[1],useArrowKeys:!0,onChange:function(val1){var val0=_this3.state.center[0];_this3.setState({center:[val0,val1]},function(){_this3.props.onChange()})},onFocus:_.partial(this.props.onFocus,"centerY"),onBlur:_.partial(this.props.onBlur,"centerY"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,")")],degrees=[React.createElement(InputComponent,{ref:"angleDeg",placeholder:0,value:this.state.angleDeg,useArrowKeys:!0,onChange:function(val){_this3.setState({angleDeg:val},function(){_this3.props.onChange()})},onFocus:_.partial(this.props.onFocus,"angleDeg"),onBlur:_.partial(this.props.onBlur,"angleDeg"),keypadElement:this.props.keypadElement}),DEGREE_SIGN],text=$_({point:point,degrees:degrees},"Rotation about { point } by { degrees }");return React.createElement("div",null,text)},value:function(){return{angleDeg:this.refs.angleDeg.getValue(),center:[this.refs.centerX.getValue(),this.refs.centerY.getValue()]}},setInputValue:function(path,value,cb){var _this4=this,id=_.first(path),angleDeg=_.clone(this.state.angleDeg),center=_.clone(this.state.center);"angleDeg"===id?angleDeg=value:"centerX"===id?center[0]=value:"centerY"===id&&(center[1]=value),this.setState({angleDeg:angleDeg,center:center},function(){_this4.props.onChange(cb)})},getInputPaths:function(){return[["centerX"],["centerY"],["angleDeg"]]}})},reflection:{verbName:i18n._("Reflect"),nounName:i18n._("Reflection"),lowerNounName:i18n._("reflection"),apply:function(transform){return function(coord){return kpoint.reflectOverLine(coord,transform.line)}},isValid:function(transform){return _.all(_.flatten(transform.line),_.isFinite)&&!kpoint.equal(transform.line[0],transform.line[1])},isEmpty:function(transform){return _.all(_.flatten(transform.line),_.isNull)},isNoOp:function(transform){return!1},collapse:function(transform1,transform2){return!!kline.equal(transform1.line,transform2.line)&&[]},toTeX:function(transform){var point1=transform.line[0],point2=transform.line[1];return $_({point1:texFromPoint(point1),point2:texFromPoint(point2)},"Reflection over the line from { point1 } to { point2 }")},Input:React.createClass({displayName:"Input",getInitialState:function(){return{line:this.props.line||[[null,null],[null,null]]}},componentDidUpdate:function(prevProps){deepEq(this.props,prevProps)||this.setState({line:this.props.line})},render:function(){var InputComponent=inputComponentForApiOptions(this.props.apiOptions),point1=[React.createElement(TeX,null,"("),React.createElement(InputComponent,{ref:"x1",value:this.state.line[0][0],useArrowKeys:!0,onChange:this.changePoint.bind(this,0,0),onFocus:_.partial(this.props.onFocus,"x1"),onBlur:_.partial(this.props.onBlur,"x1"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,", {}"),React.createElement(InputComponent,{ref:"y1",value:this.state.line[0][1],useArrowKeys:!0,onChange:this.changePoint.bind(this,0,1),onFocus:_.partial(this.props.onFocus,"y1"),onBlur:_.partial(this.props.onBlur,"y1"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,")")],point2=[React.createElement(TeX,null,"("),React.createElement(InputComponent,{ref:"x2",value:this.state.line[1][0],useArrowKeys:!0,onChange:this.changePoint.bind(this,1,0),onFocus:_.partial(this.props.onFocus,"x2"),onBlur:_.partial(this.props.onBlur,"x2"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,", {}"),React.createElement(InputComponent,{ref:"y2",value:this.state.line[1][1],useArrowKeys:!0,onChange:this.changePoint.bind(this,1,1),onFocus:_.partial(this.props.onFocus,"y2"),onBlur:_.partial(this.props.onBlur,"y2"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,")")];return React.createElement("div",null,$_({point1:point1,point2:point2},"Reflection over the line from { point1 } to { point2 }"))},changePoint:function(i,j,val,cb){var _this5=this,line=_.map(this.state.line,_.clone);line[i][j]=val,this.setState({line:line},function(){_this5.props.onChange(cb)})},value:function(){return{line:[[this.refs.x1.getValue(),this.refs.y1.getValue()],[this.refs.x2.getValue(),this.refs.y2.getValue()]]}},setInputValue:function(path,value,cb){var j,i,id=_.first(path);"x"===id[0]?j=0:"y"===id[0]&&(j=1),"1"===id[1]?i=0:"2"===id[1]&&(i=1),this.changePoint(i,j,value,cb)},getInputPaths:function(){return[["x1"],["y1"],["x2"],["y2"]]}})},dilation:{verbName:i18n._("Dilate"),nounName:i18n._("Dilation"),lowerNounName:i18n._("dilation"),apply:function(transform){return function(coord){return point=coord,dilationCenter=transform.center,scale=transform.scale,pv=kvector.subtract(point,dilationCenter),pvScaled=kvector.scale(pv,scale),kvector.add(dilationCenter,pvScaled);var point,dilationCenter,scale,pv,pvScaled}},isValid:function(transform){return _.isFinite(transform.scale)&&_.isFinite(transform.center[0])&&_.isFinite(transform.center[1])},isEmpty:function(transform){return null===transform.scale&&null===transform.center[0]&&null===transform.center[1]},isNoOp:function(transform){return knumber.equal(transform.scale,1)},collapse:function(transform1,transform2){return!!kpoint.equal(transform1.center,transform2.center)&&{center:transform1.center,scale:transform1.scale*transform2.scale}},toTeX:function(transform){var number,frac,scaleString=(number=transform.scale,1===(frac=KhanMath.toFraction(number,knumber.DEFAULT_TOLERANCE))[1]?stringFromDecimal(number):stringFromDecimal(frac[0])+"/"+stringFromDecimal(frac[1]));return $_({scale:scaleString,point:texFromPoint(transform.center)},"Dilation of scale { scale } about { point }")},Input:React.createClass({displayName:"Input",getInitialState:function(){return{center:this.props.center||[null,null],scale:this.props.scale||null}},componentDidUpdate:function(prevProps){deepEq(this.props,prevProps)||this.setState({center:this.props.center,scale:this.props.scale})},render:function(){var _this6=this,InputComponent=inputComponentForApiOptions(this.props.apiOptions),point=[React.createElement(TeX,null,"("),React.createElement(InputComponent,{ref:"x",placeholder:0,value:this.state.center[0],useArrowKeys:!0,onChange:function(val0){var val1=_this6.state.center[1];_this6.setState({center:[val0,val1]},function(){_this6.props.onChange()})},onFocus:_.partial(this.props.onFocus,"x"),onBlur:_.partial(this.props.onBlur,"x"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,", {}"),React.createElement(InputComponent,{ref:"y",placeholder:0,value:this.state.center[1],useArrowKeys:!0,onChange:function(val1){var val0=_this6.state.center[0];_this6.setState({center:[val0,val1]},function(){_this6.props.onChange()})},onFocus:_.partial(this.props.onFocus,"y"),onBlur:_.partial(this.props.onBlur,"y"),keypadElement:this.props.keypadElement}),React.createElement(TeX,null,")")],scale=React.createElement(InputComponent,{ref:"scale",placeholder:1,value:this.state.scale,useArrowKeys:!0,onChange:function(val){_this6.setState({scale:val},function(){_this6.props.onChange()})},onFocus:_.partial(this.props.onFocus,"scale"),onBlur:_.partial(this.props.onBlur,"scale"),keypadElement:this.props.keypadElement});return React.createElement("div",null,$_({point:point,scale:scale},"Dilation about { point } by { scale }"))},value:function(){return{scale:this.refs.scale.getValue(),center:[this.refs.x.getValue(),this.refs.y.getValue()]}},setInputValue:function(path,value,cb){var _this7=this,id=_.first(path),scale=this.state.scale,center=_.clone(this.state.center);"x"===id?center[0]=value:"y"===id?center[1]=value:"scale"===id&&(scale=value),this.setState({scale:scale,center:center},function(){_this7.props.onChange(cb)})},getInputPaths:function(){return[["x"],["y"],["scale"]]}})}},ShapeTypes={getPointCountForType:function(type){var splitType=type.split("-");return"polygon"===splitType[0]?splitType[1]||3:"line"===splitType[0]||"lineSegment"===splitType[0]?2:"angle"===splitType[0]?3:"circle"===splitType[0]?2:"point"===splitType[0]?1:void 0},addMovableShape:function(graphie,options){if(options.editable&&options.translatable)throw new Error("It doesn't make sense to have a movable shape where you can stretch the points and translate them simultaneously. options: "+JSON.stringify(options));var shape,points=_.map(options.shape.coords,function(coord){var currentPoint,isMoving=!1,previousCoord=coord;return(currentPoint=graphie.addMovablePoint({coord:coord,normalStyle:options.normalPointStyle,highlightStyle:options.highlightPointStyle,constraints:{fixed:!options.translatable&&!options.editable},visible:options.showPoints,snapX:options.snap&&options.snap[0]||0,snapY:options.snap&&options.snap[1]||0,bounded:!1,onMove:function(x,y){isMoving||(previousCoord=currentPoint.coord,isMoving=!0);var moveVector=kvector.subtract([x,y],currentPoint.coord);options.onMove&&(moveVector=options.onMove(moveVector[0],moveVector[1])),options.translatable&&_.each(points,function(point){point!==currentPoint&&point.setCoord(kvector.add(point.coord,moveVector))});var oldCoord=currentPoint.coord,newCoord=kvector.add(currentPoint.coord,moveVector);return currentPoint.coord=newCoord,shape.update(),currentPoint.coord=oldCoord,newCoord},onMoveEnd:function(){if(options.onMoveEnd&&isMoving){isMoving=!1;var change=kvector.subtract(currentPoint.coord,previousCoord);options.onMoveEnd(change[0],change[1])}shape.update()}})).bounded=!0,currentPoint}),removeShapeWithoutPoints=(shape=ShapeTypes.addShape(graphie,options,points)).remove;return shape.remove=function(){removeShapeWithoutPoints.apply(shape),_.invoke(points,"remove")},shape},addShape:function(graphie,options,points){points=points||options.shape.coords;var types=ShapeTypes._typesOf(options.shape),typeOptions=options.shape.options||ShapeTypes.defaultOptions(types),shapes=ShapeTypes._mapTypes(types,points,function(type,points,i){var shapeOptions=_.extend({},options,typeOptions[i]);return ShapeTypes._addType(graphie,type,points,shapeOptions)}),updateFuncs=_.filter(_.pluck(shapes,"update"),_.identity),removeFuncs=_.filter(_.pluck(shapes,"remove"),_.identity),getOptions=function(){return _.map(shapes,function(shape){return shape.getOptions?shape.getOptions():{}})};return{type:types,points:points,update:function(){_.invoke(updateFuncs,"call")},remove:function(){_.invoke(removeFuncs,"call")},toJSON:function(){var coords=_.map(points,function(pt){return _.isArray(pt)?pt:pt.coord});return{type:types,coords:coords,options:getOptions()}},getOptions:getOptions}},equal:function(shape1,shape2){var types1=ShapeTypes._typesOf(shape1),types2=ShapeTypes._typesOf(shape2);if(types1.length!==types2.length)return!1;var shapes1=ShapeTypes._mapTypes(types1,shape1.coords,ShapeTypes._combine),shapes2=ShapeTypes._mapTypes(types2,shape2.coords,ShapeTypes._combine);return _.all(_.map(shapes1,function(partialShape1,i){var partialShape2=shapes2[i];return partialShape1.type===partialShape2.type&&ShapeTypes._forType(partialShape1.type).equal(partialShape1.coords,partialShape2.coords)}))},_typesOf:function(shape){var types=shape.type;return _.isArray(types)||(types=[types]),_.map(types,function(type){return"polygon"===type?"polygon-3":type})},defaultOptions:function(types){return _.map(types,function(type){var typeDefaultOptions=ShapeTypes._forType(type).defaultOptions;return _.extend({},typeDefaultOptions)})},_forType:function(type){var baseType=type.split("-")[0];return ShapeTypes[baseType]},_mapTypes:function(types,points,func,context){return _.map(types,function(type,i){var pointCount=ShapeTypes.getPointCountForType(type),currentPoints=_.first(points,pointCount);return points=_.rest(points,pointCount),func.call(context,type,currentPoints,i)})},_addType:function(graphie,type,points,options){var lineCoords=_.isArray(points[0])?{coordA:points[0],coordZ:points[1]}:{pointA:points[0],pointZ:points[1]};if("polygon"===(type=type.split("-")[0])){var polygon=graphie.addMovablePolygon(_.extend({},options,{fixed:!options.editable,snapX:options.snap&&options.snap[0]||0,snapY:options.snap&&options.snap[1]||0,points:points,constrainToGraph:!1}));return{update:polygon.transform.bind(polygon),remove:polygon.remove.bind(polygon)}}if("line"===type||"lineSegment"===type){var line=graphie.addMovableLineSegment(_.extend({},options,lineCoords,{movePointsWithLine:!0,fixed:!0,constraints:{fixed:!0},extendLine:"line"===type}));return{update:line.transform.bind(line,!0),remove:line.remove.bind(line)}}if("angle"===type){var shouldChangeReflexivity=!!options.editable&&null,angle=graphie.addMovableAngle({angleLabel:"$deg0",fixed:!0,points:points,normalStyle:options.normalStyle,reflex:options.reflex});return _.isArray(points[0])||options.editable||(points[0].remove(),points[2].remove()),{update:angle.update.bind(angle,shouldChangeReflexivity),remove:angle.remove.bind(angle),getOptions:function(){return{reflex:angle.isReflex()}}}}if("circle"===type){var perimeter={remove:_.identity},redrawPerim=function(){var coord0=points[0].coord||points[0],coord1=points[1].coord||points[1],radius=kpoint.distanceToPoint(coord0,coord1);perimeter.remove(),perimeter=graphie.circle(coord0,radius,_.extend({stroke:KhanColors.DYNAMIC,"stroke-width":2},options.normalStyle))};return redrawPerim(),points[1].remove&&!options.editable&&points[1].remove(),{update:redrawPerim,remove:function(){perimeter.remove()}}}if("point"===type)return{update:null,remove:null};throw new Error("Invalid shape type "+type)},_combine:function(type,coords){return{type:type,coords:coords}},polygon:{equal:orderInsensitiveCoordsEqual},line:{equal:kline.equal},lineSegment:{equal:orderInsensitiveCoordsEqual},angle:{equal:function(points1,points2){if(!kpoint.equal(points1[1],points2[1]))return!1;var line1_0=[points1[1],points1[0]],line1_2=[points1[1],points1[2]],line2_0=[points2[1],points2[0]],line2_2=[points2[1],points2[2]],equalUnflipped=kray.equal(line1_0,line2_0)&&kray.equal(line1_2,line2_2),equalFlipped=kray.equal(line1_0,line2_2)&&kray.equal(line1_2,line2_0);return equalUnflipped||equalFlipped},defaultOptions:{reflex:!1}},circle:{equal:function(points1,points2){var radius1=kpoint.distanceToPoint(points1[0],points1[1]),radius2=kpoint.distanceToPoint(points2[0],points2[1]);return kpoint.equal(points1[0],points2[0])&&knumber.equal(radius1,radius2)}},point:{equal:kpoint.equal}},TransformationListItem=TransformOps.ListItem,TransformationList=React.createClass({displayName:"TransformationList",render:function(){if("static"===this.props.mode)return React.createElement("span",null);var transformationList=_.map(this.props.transformations,function(transform,i){return React.createElement(TransformationListItem,{ref:"transformation"+i,key:"transformation"+i,transform:transform,mode:this.props.mode,onChange:this.handleChange,onFocus:_.partial(this.props.onFocus,""+i),onBlur:_.partial(this.props.onBlur,""+i),keypadElement:this.props.keypadElement,apiOptions:this.props.apiOptions})},this);return React.createElement("div",{className:"perseus-transformation-list"},transformationList)},_transformationRefs:function(){var _this8=this;return _.times(this.props.transformations.length,function(i){return _this8.refs["transformation"+i]})},value:function(){return _.invoke(this._transformationRefs(),"value")},handleChange:function(changed,callback){this.props.onChange(this.value(),callback)},focusLast:function(){var transformationRefs=this._transformationRefs();0!==transformationRefs.length&&_.last(transformationRefs).focus()}}),ToolButton=React.createClass({displayName:"ToolButton",render:function(){var classes=this.props.toggled?"simple-button exercise-orange toggled highlighted-tool-button":"simple-button";return React.createElement("button",{type:"button",className:classes,disabled:this.props.disabled,onClick:this.props.onClick,onTouchStart:captureScratchpadTouchStart},this.props.children)}}),ToolsBar=React.createClass({displayName:"ToolsBar",getInitialState:function(){return{selected:null}},render:function(){var tools=_.map(Transformations,function(tool,type){if(this.props.enabled[type])return React.createElement(ToolButton,{key:type,disabled:this.props.apiOptions.readOnly,toggled:this.state.selected===type,onClick:this.changeSelected.bind(this,type)},tool.verbName)},this);return React.createElement("div",{className:"transformer-tools-bar"},React.createElement("span",{className:"simple-button-group"},tools),React.createElement("button",{className:"transformer-undo-button simple-button",type:"button",disabled:this.props.apiOptions.readOnly,onClick:this.props.onUndoClick,onTouchStart:captureScratchpadTouchStart},React.createElement(InlineIcon,iconUndo)," "+i18n._("Undo")),React.createElement("div",{className:"clear"}))},changeSelected:function(tool){this.props.removeTool(this.state.selected),tool&&tool!==this.state.selected?(this.props.addTool(tool),this.setState({selected:tool})):this.setState({selected:null})}}),AddTransformBar=React.createClass({displayName:"AddTransformBar",render:function(){var tools=_.map(Transformations,function(tool,type){if(this.props.enabled[type])return React.createElement(ToolButton,{key:type,toggled:!1,disabled:this.props.apiOptions.readOnly,onClick:this.changeSelected.bind(this,type)},React.createElement(InlineIcon,iconPlus)," ",tool.nounName)},this);return React.createElement("div",{className:"transformer-tools-bar"},tools,React.createElement("button",{className:"transformer-undo-button simple-button",type:"button",onClick:this.props.onUndoClick,disabled:this.props.apiOptions.readOnly,onTouchStart:captureScratchpadTouchStart},React.createElement(InlineIcon,iconUndo)," "+i18n._("Undo")),React.createElement("div",{className:"clear"}))},changeSelected:function(tool){tool&&this.props.addTool(tool)}}),Transformer=React.createClass({displayName:"Transformer",propTypes:{apiOptions:ApiOptions.propTypes,keypadElement:keypadElementPropType,trackInteraction:React.PropTypes.func.isRequired},getDefaultProps:function(){return _.defaults({transformations:[]},defaultTransformerProps)},render:function(){var setProps,boxSize,labels,range,step,object,subKey,graph=_.extend((setProps=this.props.graph,boxSize=400,labels=(setProps=setProps||{}).labels||["x","y"],range=setProps.range||[[-10,10],[-10,10]],step=setProps.step||[1,1],{box:[boxSize,boxSize],labels:labels,range:range,step:step,gridStep:setProps.gridStep||getGridStep(range,step,boxSize),valid:!0,backgroundImage:defaultBackgroundImage,markings:"grid",showProtractor:!1}),this.props.graph),interactiveToolsMode="interactive"===this.props.graphMode,ToolsBarClass=interactiveToolsMode?ToolsBar:AddTransformBar,toolsBar=React.createElement("div",{style:{width:graph.box[0]}},React.createElement(ToolsBarClass,{ref:"toolsBar",enabled:(object=this.props.tools,subKey="enabled",_.object(_.map(object,function(value,key){return[key,value[subKey]]}))),apiOptions:this.props.apiOptions,addTool:this.addTool,removeTool:this.removeTool,onUndoClick:this.handleUndoClick}));return React.createElement("div",{className:"perseus-widget perseus-widget-transformer"},React.createElement(Graph,{ref:"graph",box:graph.box,range:graph.range,labels:graph.labels,step:graph.step,gridStep:graph.gridStep,markings:graph.markings,backgroundImage:graph.backgroundImage,showProtractor:graph.showProtractor,onGraphieUpdated:this.setupGraphie,setDrawingAreaAvailable:this.props.apiOptions.setDrawingAreaAvailable}),!interactiveToolsMode&&"Add transformations below:","static"===this.props.graphMode&&[React.createElement("br",{key:"static-br"}),React.createElement("em",{key:"static-nomove"}," ","Note: For this question, the shape will not move."," ")],interactiveToolsMode&&toolsBar,React.createElement(TransformationList,{ref:"transformationList",mode:this.props.listMode,transformations:this.props.transformations,onChange:this.setTransformationProps,onFocus:this._handleFocus,onBlur:this._handleBlur,keypadElement:this.props.keypadElement,apiOptions:this.props.apiOptions}),!interactiveToolsMode&&toolsBar)},componentDidMount:function(){this.setupGraphie(this.graphie())},componentDidUpdate:function(prevProps){this.shouldSetupGraphie(this.props,prevProps)?this.refs.graph.reset():deepEq(this.props.transformations,this.transformations)||this.setTransformations(this.props.transformations)},shouldSetupGraphie:function(nextProps,prevProps){return!deepEq(prevProps.starting,nextProps.starting)||prevProps.graphMode!==nextProps.graphMode||prevProps.listMode!==nextProps.listMode||prevProps.drawSolutionShape!==nextProps.drawSolutionShape||!(!nextProps.drawSolutionShape||deepEq(prevProps.correct.shape,nextProps.correct.shape))||!deepEq(this.tools,nextProps.tools)},graphie:function(){return this.refs.graph.graphie()},setupGraphie:function(graphie){this.props.drawSolutionShape&&this.props.correct.shape&&this.props.correct.shape.coords&&ShapeTypes.addShape(graphie,{fixed:!0,shape:this.props.correct.shape,normalStyle:{stroke:KhanColors.GRAY,"stroke-dasharray":"","stroke-width":2}}),this.currentTool=null,this.refs.toolsBar.changeSelected(null),this.addTransformerShape(this.props.starting.shape,!1),this.setTransformations(this.props.transformations),this.tools={translation:_.clone(this.props.tools.translation),rotation:_.clone(this.props.tools.rotation),reflection:_.clone(this.props.tools.reflection),dilation:_.clone(this.props.tools.dilation)}},setTransformations:function(transformations){this.resetCoords(),this.transformations=_.clone(transformations),_.each(this.transformations,this.applyTransform)},addTransformerShape:function(shape,translatable){var self=this,graphie=this.graphie();this.shape=ShapeTypes.addMovableShape(graphie,{shape:shape,editable:!1,showPoints:"static"!==this.props.graphMode,translatable:translatable,onMove:function(dX,dY){return dX=KhanMath.roundToNearest(graphie.snap[0],dX),dY=KhanMath.roundToNearest(graphie.snap[1],dY),self.addTransform({type:"translation",vector:[dX,dY]}),[dX,dY]},normalPointStyle:{fill:translatable?KhanColors.INTERACTIVE:KhanColors.DYNAMIC,stroke:translatable?KhanColors.INTERACTIVE:KhanColors.DYNAMIC},highlightPointStyle:{fill:KhanColors.INTERACTING,stroke:KhanColors.INTERACTING}})},addTool:function(toolId){var self=this;if("interactive"===this.props.graphMode)if("translation"===toolId)this.currentTool=this.addTranslationTool();else if("rotation"===toolId)this.currentTool=this.addRotationTool();else if("reflection"===toolId)this.currentTool=this.addReflectionTool();else{if("dilation"!==toolId)throw new Error("Invalid tool id: "+toolId);this.currentTool=this.addDilationTool()}else{var transform;if("translation"===toolId)transform={type:toolId,vector:[null,null]};else if("rotation"===toolId)transform={type:toolId,center:[null,null],angleDeg:null};else if("reflection"===toolId)transform={type:toolId,line:[[null,null],[null,null]]};else{if("dilation"!==toolId)throw new Error("Invalid tool id: "+toolId);transform={type:toolId,center:[null,null],scale:null}}this.doTransform(transform,function(){self.refs.transformationList.focusLast()})}},removeTool:function(toolId){this.currentTool&&this.currentTool.remove(),this.currentTool=null},addTranslationTool:function(){var self=this;return this.shape.remove(),this.addTransformerShape(this.shape.toJSON(),!0),{remove:function(){self.shape.remove(),self.addTransformerShape(self.shape.toJSON(),!1)}}},snapCoord:function(coord){var graphie=this.graphie();return _.map(coord,function(val,dim){return KhanMath.roundToNearest(graphie.snap[dim],val)})},normalizeReflectionCoords:function(messyCoords){var midpoint=this.snapCoord(kline.midpoint(messyCoords)),origDirectionPolar=kvector.polarDegFromCart(kvector.subtract(messyCoords[0],messyCoords[1])),directionPolar=[1,KhanMath.roundToNearest(45,origDirectionPolar[1])],direction=kvector.cartFromPolarDeg(directionPolar);return _.map([-1,1],function(directionCoefficient){var coord=kvector.add(midpoint,kvector.scale(direction,directionCoefficient*this.scaleToCurrentRange(2)));return this.snapCoord(coord)},this)},addReflectionTool:function(){var options=this.props.tools.reflection;if(options.enabled){var reflectLine,self=this,graphie=this.refs.graph.graphie(),updateReflectionTool=function(){self.changeTool("reflection",{coords:_.pluck(reflectPoints,"coord")})},coords=this.normalizeReflectionCoords(options.coords),reflectPoints=_.map(coords,function(coord){return graphie.addMovablePoint({coord:coord,visible:!1})},this),normalColor=colorForTool(options);graphie.style({},function(){reflectLine=graphie.addMovableLineSegment({fixed:options.constraints.fixed,constraints:options.constraints,pointA:reflectPoints[0],pointZ:reflectPoints[1],snapX:graphie.snap[0],snapY:graphie.snap[1],extendLine:!0,normalStyle:{stroke:normalColor,"stroke-width":2,"stroke-dasharray":"- "},highlightStyle:{stroke:KhanColors.INTERACTING,"stroke-width":2,"stroke-dasharray":"- "},movePointsWithLine:!0,onMoveEnd:updateReflectionTool})});var reflectButton=graphie.addReflectButton({fixed:options.constraints.fixed,line:reflectLine,size:this.scaleToCurrentRange(1),onClick:function(){self.doTransform({type:"reflection",line:_.pluck(reflectPoints,"coord")}),reflectRotateHandle&&(reflectRotateHandle.setCoord(kvector.add(reflectButton.coord,kvector.subtract(reflectButton.coord,reflectRotateHandle.coord))),reflectRotateHandle.update())},normalStyle:{stroke:normalColor,"stroke-width":2,fill:normalColor},highlightStyle:{stroke:KhanColors.INTERACTING,"stroke-width":3,fill:KhanColors.INTERACTING},onMoveEnd:updateReflectionTool}),reflectRotateHandle=null;if(!options.constraints.fixed){var initRotateHandleAngle=kvector.polarDegFromCart(kvector.subtract(reflectPoints[1].coord,reflectPoints[0].coord))[1]+90;reflectRotateHandle=graphie.addRotateHandle({center:reflectButton,radius:this.scaleToCurrentRange(2),angleDeg:initRotateHandleAngle,width:this.scaleToCurrentRange(.24),hoverWidth:this.scaleToCurrentRange(.4),lengthAngle:17,onMove:function(newAngle){return KhanMath.roundToNearest(45,newAngle)},onMoveEnd:updateReflectionTool})}return $(reflectLine).on("move",function(){reflectButton.update(),$(reflectButton).trigger("move")}),reflectRotateHandle&&$(reflectRotateHandle).on("move",function(){var rotateHandleApprox=self.snapCoord(reflectRotateHandle.coord),rotateVector=kvector.subtract(rotateHandleApprox,reflectButton.coord),flipped=reflectButton.isFlipped()?1:0;reflectPoints[flipped].setCoord(kvector.add(reflectButton.coord,kvector.rotateDeg(rotateVector,90))),reflectPoints[1-flipped].setCoord(kvector.add(reflectButton.coord,kvector.rotateDeg(rotateVector,-90))),reflectLine.transform(!0),reflectButton.update()}),{remove:function(){reflectButton.remove(),reflectRotateHandle&&reflectRotateHandle.remove(),reflectLine.remove(),reflectPoints[0].remove(),reflectPoints[1].remove()}}}},scaleToCurrentRange:function(dist){return function(dist,range){var spreadX=range[0][1]-range[0][0],spreadY=range[1][1]-range[1][0];return dist*Math.max(spreadX,spreadY)/20}(dist,this.refs.graph.props.range)},addRotationTool:function(){var options=this.props.tools.rotation;if(options.enabled){var self=this,graphie=this.refs.graph.graphie(),pointColor=colorForTool(options);return this.rotatePoint=graphie.addMovablePoint({constraints:options.constraints,coord:options.coord,snapX:graphie.snap[0],snapY:graphie.snap[1],normalStyle:{"stroke-dasharray":"",stroke:pointColor,fill:pointColor},highlightStyle:{"stroke-dasharray":"",stroke:KhanColors.INTERACTING,fill:KhanColors.INTERACTING}}),this.rotateHandle=graphie.addRotateHandle({center:this.rotatePoint,radius:this.scaleToCurrentRange(1.5),width:this.scaleToCurrentRange(.24),hoverWidth:this.scaleToCurrentRange(.4),onMove:function(newAngle,oldAngle){var transform=self.getRotationTransformFromAngle(self.rotatePoint.coord,newAngle-oldAngle);return self.doTransform(transform),oldAngle+transform.angleDeg}}),this.rotatePoint.onMoveEnd=function(x,y){self.changeTool("rotation",{coord:[x,y]})},{remove:function(){self.rotateHandle.remove(),self.rotatePoint.remove()}}}},addDilationTool:function(){var options=this.props.tools.dilation;if(options.enabled){var self=this,graphie=this.refs.graph.graphie(),pointColor=colorForTool(options);self.dilationCircle=graphie.addCircleGraph({centerConstraints:options.constraints,center:options.coord,radius:self.scaleToCurrentRange(2),snapX:graphie.snap[0],snapY:graphie.snap[1],minRadius:self.scaleToCurrentRange(1),snapRadius:self.scaleToCurrentRange(.5),onResize:function(newRadius,oldRadius){self.doTransform({type:"dilation",center:self.dilationCircle.centerPoint.coord,scale:newRadius/oldRadius})},circleNormalStyle:{stroke:pointColor,"stroke-width":2,"stroke-dasharray":"- ","fill-opacity":0},circleHighlightStyle:{stroke:KhanColors.INTERACTING,"stroke-width":2,"stroke-dasharray":"",fill:KhanColors.INTERACTING,"fill-opacity":.05},centerNormalStyle:{stroke:pointColor,fill:pointColor,"stroke-width":2,"stroke-dasharray":""},centerHighlightStyle:{stroke:pointColor,fill:pointColor,"stroke-width":2,"stroke-dasharray":""}});var origOnMoveEnd=this.dilationCircle.centerPoint.onMoveEnd;return this.dilationCircle.centerPoint.onMoveEnd=function(){origOnMoveEnd&&origOnMoveEnd.apply(this,_.toArray(arguments)),self.changeTool("dilation",{coord:self.dilationCircle.centerPoint.coord})},{remove:function(){self.dilationCircle.remove()}}}},getRotationTransformFromAngle:function(center,angleChanged){return(angleChanged=(angleChanged+360)%360)>180&&(angleChanged-=360),{type:"rotation",center:center,angleDeg:15*Math.round(angleChanged/15)}},doTransform:function(transform,callback){this.applyTransform(transform),this.addTransform(transform,callback)},applyTransform:function(transform){if("static"!==this.props.graphMode){var transformFunc=TransformOps.apply(transform);this.applyCoordTransformation(transformFunc)}},applyCoordTransformation:function(pointTransform){_.each(this.shape.points,function(point){var newCoord=pointTransform(point.coord);point.setCoord(newCoord)}),this.shape.update()},resetCoords:function(){var startCoords=this.props.starting.shape.coords;_.each(this.shape.points,function(point,i){point.setCoord(startCoords[i])}),this.shape.update()},handleUndoClick:function(){this.refs.toolsBar.changeSelected(null),this.props.transformations.length&&this.props.onChange({transformations:_.initial(this.props.transformations)})},setTransformationProps:function(newTransfomationList,callback){this.props.onChange({transformations:newTransfomationList},callback)},addTransform:function(transform,callback){this.transformations=TransformOps.append(this.transformations,transform),this.props.onChange({transformations:_.clone(this.transformations)},callback)},changeTool:function(tool,changes){var newTools=_.clone(this.props.tools);newTools[tool]=_.extend({},this.props.tools[tool],changes),this.tools[tool]=_.clone(newTools[tool]),this.props.onChange({tools:newTools}),this.props.trackInteraction()},simpleValidate:function(rubric){return Transformer.validate(this.getUserInput(),rubric)},getCoords:function(){var startCoords=this.props.starting.shape.coords,transforms=this.props.transformations;return _.reduce(transforms,function(coords,transform){return _.map(coords,TransformOps.apply(transform))},startCoords)},getEditorJSON:function(){var json=_.pick(this.props,"grading","starting","graphMode","listMode","tools","drawSolutionShape","gradeEmpty");return json.graph=this.refs.graph.toJSON(),json.version=1.2,json.answer=this.getUserInput(),json},getUserInput:function(){return{transformations:this.props.transformations,shape:{type:this.shape.type,coords:this.getCoords(),options:this.shape.getOptions()}}},_handleFocus:function(){var path=Array.prototype.slice.call(arguments);this.props.onFocus(path)},_handleBlur:function(){var path=Array.prototype.slice.call(arguments);this.props.onBlur(path)},_getTransformationForID:function(transformationID){var refPath=["transformationList","transformation"+transformationID],component=this;return _.each(refPath,function(ref){component=component.refs[ref]}),component},getInputPaths:function(){var _this9=this;if("static"===this.props.listMode)return[];var inputPaths=[];return _.each(this.props.transformations,function(transformation,i){var innerPaths=_this9._getTransformationForID(i).getInputPaths(),fullPaths=_.map(innerPaths,function(innerPath){return[""+i].concat(innerPath)});inputPaths=inputPaths.concat(fullPaths)}),inputPaths},_passToInner:function(functionName,path){if(path&&path.length){var innerPath=_.rest(path),args=[innerPath].concat(_.rest(arguments,2)),transformationID=_.head(path),caller=this._getTransformationForID(transformationID);return caller[functionName].apply(caller,args)}},focus:function(){var inputs=this.getInputPaths();return inputs.length>0&&(this.focusInputPath(inputs[0]),!0)},focusInputPath:function(path){return 0!==path.length&&(assert(path.length>=2),this._passToInner("focusInputPath",path))},blurInputPath:function(path){return 0!==path.length&&(assert(path.length>=2),this._passToInner("blurInputPath",path))},setInputValue:function(path,value,cb){return assert(path.length>=2),this._passToInner("setInputValue",path,value,cb)},getDOMNodeForPath:function(path){return assert(path.length>=2),this._passToInner("getDOMNodeForPath",path)},getGrammarTypeForPath:function(path){return assert(path.length>=2),this._passToInner("getGrammarTypeForPath",path)}});_.extend(Transformer,{validate:function(guess,rubric){for(var type in Transformations)if(rubric.tools[type].required){if(!_.any(_.map(guess.transformations,function(transform){return transform.type===type&&!TransformOps.isEmpty(transform)&&!TransformOps.isNoOp(transform)})))return{type:"invalid",message:i18n._("Your transformation must use a { type }.",{type:Transformations[type].lowerNounName})}}return ShapeTypes.equal(guess.shape,rubric.correct.shape)?{type:"points",earned:1,total:1,message:null}:!rubric.gradeEmpty&&deepEq(guess.shape.coords,rubric.starting.shape.coords)?{type:"invalid",message:i18n._("Use the interactive graph to define a correct transformation.")}:{type:"points",earned:0,total:1,message:null}}}),module.exports={name:"transformer",displayName:"Transformer",widget:Transformer}}).call(this,__webpack_require__(21),__webpack_require__(272),__webpack_require__(10))},694:function(module,exports,__webpack_require__){(function(i18n,$,KAS){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},lens=__webpack_require__(161),React=__webpack_require__(0),ReactDOM=__webpack_require__(7),_=__webpack_require__(1),ApiClassNames=__webpack_require__(13).ClassNames,ApiOptions=__webpack_require__(13).Options,Changeable=__webpack_require__(156),MathOutput=__webpack_require__(267),_require=__webpack_require__(695),SignificantFigures=_require.SignificantFigures,displaySigFigs=_require.displaySigFigs,countSigfigs=function(value){return new SignificantFigures(value).sigFigs},OldUnitInput=React.createClass({displayName:"OldUnitInput",propTypes:_extends({},Changeable.propTypes,{value:React.PropTypes.string}),getDefaultProps:function(){return{apiOptions:ApiOptions.defaults,value:""}},render:function(){var input=(this.props.apiOptions.staticRender?React.createFactory(MathOutput):React.DOM.input)({onChange:this.handleChange,ref:"input",className:ApiClassNames.INTERACTIVE,value:this.props.value,onFocus:this.handleFocus,onBlur:this.handleBlur});return React.createElement("div",{className:"old-unit-input"},input,React.createElement("div",{ref:"error",className:"error",style:{display:"none"}},i18n._("I don't understand that")))},_errorTimeout:null,_showError:function(){if(""!==this.props.value){var $error=$(ReactDOM.findDOMNode(this.refs.error));$error.is(":visible")||$error.css({top:50,opacity:.1}).show().animate({top:0,opacity:1},300)}},_hideError:function(){var $error=$(ReactDOM.findDOMNode(this.refs.error));$error.is(":visible")&&$error.animate({top:50,opacity:.1},300,function(){$(this).hide()})},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},componentDidUpdate:function(){clearTimeout(this._errorTimeout),KAS.unitParse(this.props.value).parsed?this._hideError():this._errorTimeout=setTimeout(this._showError,2e3)},componentWillUnmount:function(){clearTimeout(this._errorTimeout)},handleBlur:function(){this.props.onBlur([]),clearTimeout(this._errorTimeout),KAS.unitParse(this.props.value).parsed||this._showError()},handleChange:function(event){this._hideError(),this.props.onChange({value:event.target.value})},simpleValidate:function(rubric,onInputError){return onInputError=onInputError||function(){},OldUnitInput.validate(this.getUserInput(),rubric)},getUserInput:function(){return this.props.value},getInputPaths:function(){return[[]]},focusInputPath:function(inputPath){ReactDOM.findDOMNode(this.refs.input).focus()},handleFocus:function(){this.props.onFocus([])},blurInputPath:function(inputPath){ReactDOM.findDOMNode(this.refs.input).blur()},setInputValue:function(path,newValue,cb){this.props.onChange({value:newValue},cb)},getDOMNodeForPath:function(){return ReactDOM.findDOMNode(this.refs.input)},getGrammarTypeForPath:function(inputPath){return"unit"}}),primUnits=function(expr){return expr.simplify().asMul().partition()[1].flatten().simplify()};_.extend(OldUnitInput,{validate:function(state,rubric){var answer=KAS.unitParse(rubric.value).expr,guess=KAS.unitParse(state);if(!guess.parsed)return{type:"invalid",message:i18n._("I couldn't understand those units.")};var numericallyCorrect,kasCorrect,message=null,sigfigs=rubric.sigfigs,sigfigsCorrect=countSigfigs(guess.coefficient)===sigfigs;sigfigsCorrect||(message=i18n._("Check your significant figures."));try{var x=new KAS.Var("x"),conversion=new KAS.Eq(answer.simplify(),"=",new KAS.Mul(x,guess.expr.simplify())).solveLinearEquationForVariable(x);numericallyCorrect=Number(conversion.eval()).toPrecision(sigfigs)===Number(1).toPrecision(sigfigs)}catch(e){numericallyCorrect=!1}numericallyCorrect||(message=i18n._("That answer is numerically incorrect."));var guessUnit=primUnits(guess.expr.simplify()),answerUnit=primUnits(answer.simplify());if(!(kasCorrect="all"===rubric.accepting?KAS.compare(guessUnit,answerUnit).equal:_(rubric.acceptingUnits).any(function(unit){var thisAnswerUnit=primUnits(KAS.unitParse(unit).unit.simplify());return KAS.compare(thisAnswerUnit,guessUnit).equal})))message=i18n._("Check your units.");return{type:"points",earned:kasCorrect&&numericallyCorrect&&sigfigsCorrect?1:0,total:1,message:message}}}),module.exports={name:"unit-input",displayName:"Unit",defaultAlignment:"inline-block",widget:OldUnitInput,transform:function(x){return lens(x).del(["value"]).freeze()},version:{major:0,minor:1},countSigfigs:countSigfigs,sigfigPrint:function(num,sigfigs){return displaySigFigs(num,sigfigs,-10,!1)},hidden:!0}}).call(this,__webpack_require__(21),__webpack_require__(10),__webpack_require__(159))},695:function(module,exports){function trailingZeros(mantissa){for(var zeros=0,i=mantissa.length-1;i>=0;i--){if("0"!=mantissa.charAt(i))return zeros;zeros++}return zeros}function parseSign(s){for(var beginning=!0,seenDot=!1,seenSomething=!1,zeros="",all="",pos=!0,i=0;i<s.length;i++){var c=s.charAt(i);if(c>="1"&&c<="9")all+=zeros+c,zeros="",seenSomething=!0,seenDot||(0,0),beginning=!1;else if("0"==c)seenDot?seenSomething?(all+=zeros+c,zeros=""):(c,0):(0,seenSomething?(c,0,zeros+=c):c),beginning=!1;else if(seenDot||"."!=c)if("e"==c||"E"==c&&i+1<s.length){var raised=parseInt(s.substring(i+1,s.length));raised,raised,i=s.length}else!beginning||"+"!=c&&"-"!=c||"-"==c&&(pos=!pos);else all+=zeros,zeros="",seenDot=!0,beginning=!1}return""==all||pos}function parseMantissa(s){for(var beginning=!0,seenDot=!1,seenSomething=!1,zeros="",leadZeros="",all="",pos=!0,i=0;i<s.length;i++){var c=s.charAt(i);if(c>="1"&&c<="9")all+=zeros+c,zeros="",seenSomething=!0,seenDot||(0,0),beginning=!1;else if("0"==c)seenDot?seenSomething?(all+=zeros+c,zeros=""):(leadZeros+=c,0):(0,seenSomething?(leadZeros+=c,0,zeros+=c):leadZeros+=c),beginning=!1;else if(seenDot||"."!=c)if("e"==c||"E"==c&&i+1<s.length){var raised=parseInt(s.substring(i+1,s.length));raised,raised,i=s.length}else!beginning||"+"!=c&&"-"!=c||"-"==c&&(pos=!pos);else all+=zeros,zeros="",seenDot=!0,beginning=!1}return""==all?leadZeros:all}function parseOrder(s){for(var beginning=!0,seenDot=!1,seenSomething=!1,zeros="",all="",decPlaces=0,totalDecs=0,pos=!0,i=0;i<s.length;i++){var c=s.charAt(i);if(c>="1"&&c<="9")all+=zeros+c,zeros="",seenSomething=!0,seenDot||(totalDecs++,decPlaces++),beginning=!1;else if("0"==c)seenDot?seenSomething?(all+=zeros+c,zeros=""):(c,decPlaces--):(totalDecs++,seenSomething?(c,decPlaces++,zeros+=c):c),beginning=!1;else if(seenDot||"."!=c)if("e"==c||"E"==c&&i+1<s.length){var raised=parseInt(s.substring(i+1,s.length));decPlaces+=raised,totalDecs+=raised,i=s.length}else!beginning||"+"!=c&&"-"!=c||"-"==c&&(pos=!pos);else all+=zeros,zeros="",seenDot=!0,beginning=!1}return""==all?totalDecs:decPlaces}function round(mantissa,digits){var last=mantissa.length-digits-1;if(last<0)return"";if(last>=mantissa.length-1)return mantissa;var nextToLast=mantissa.charAt(last+1),lastChar=mantissa.charAt(last),roundUp=!1;if(nextToLast>"5")roundUp=!0;else if("5"==nextToLast){for(var j=last+2;j<mantissa.length;j++)"0"!=mantissa.charAt(j)&&(roundUp=!0);lastChar%2==1&&(roundUp=!0)}for(var result="",i=last;i>=0;i--){var c=mantissa.charAt(i);if(roundUp){var nextChar;if("9"==c)nextChar="0";else{switch(c){case"0":nextChar="1";break;case"1":nextChar="2";break;case"2":nextChar="3";break;case"3":nextChar="4";break;case"4":nextChar="5";break;case"5":nextChar="6";break;case"6":nextChar="7";break;case"7":nextChar="8";break;case"8":nextChar="9"}roundUp=!1}result=nextChar+result}else result=c+result}return roundUp&&(result="1"+result),result}module.exports={SignificantFigures:function(s){this.order=parseOrder(s),this.mantissa=parseMantissa(s),this.positive=parseSign(s),this.sigFigs=this.mantissa.length,this.sigDecs=this.order-this.mantissa.length},displaySigFigs:function(f,sigFigs,sigDecs,scientific){var add,decAdd,sigAdd,s=""+f,order=parseOrder(s),mantissa=parseMantissa(s),positive=parseSign(s),zeroScientific=!1;if(0==f||""==mantissa||"0"==mantissa){for(mantissa="",i=0;i<sigFigs;i++)mantissa+="0";order=sigFigs+sigDecs,sigDecs<0&&-sigDecs>=sigFigs&&(zeroScientific=!0)}else{if(decAdd=order-mantissa.length-sigDecs,sigAdd=sigFigs-mantissa.length,(add=Math.min(sigAdd,decAdd))<0){var rounded=round(mantissa,-add);rounded.length>mantissa.length+add&&(order++,decAdd>sigAdd&&(rounded=round(rounded,1))),mantissa=rounded}else if(add>0)for(i=0;i<add;i++)mantissa+="0";""!=mantissa&&"0"!=mantissa||(mantissa="0",positive=!0,0!=(order=1+sigDecs)&&(zeroScientific=!0))}var returnVal="";if(positive||(returnVal+="-"),scientific||mantissa.length>20||order>4||order<-2||order-mantissa.length>0&&trailingZeros(mantissa)>0||zeroScientific)returnVal+=mantissa.charAt(0),mantissa.length>1&&(returnVal+="."+mantissa.substring(1,mantissa.length)),order-1!=0&&(returnVal+=" x 10^"+(order-1));else{var wholePart="",fractPart="",needDot=!0;if(order>0)if(mantissa.length>order)wholePart=mantissa.substring(0,order),fractPart=mantissa.substring(order,mantissa.length);else{wholePart=mantissa,needDot=0!=trailingZeros(mantissa);for(var i=0;i<order-mantissa.length;i++)wholePart+="0"}else{for(i=0;i<-order;i++)fractPart+="0";fractPart+=mantissa}returnVal+=(""==wholePart?"0":wholePart)+(needDot?".":"")+fractPart}return returnVal}}},696:function(module,exports,__webpack_require__){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React=__webpack_require__(0),_=__webpack_require__(1),Changeable=__webpack_require__(156),FixedToResponsive=__webpack_require__(273),IS_URL=/^https?:\/\//,IS_KA_SITE=/khanacademy\.org/,Video=React.createClass({displayName:"Video",propTypes:_extends({},Changeable.propTypes,{alignment:React.PropTypes.string,location:React.PropTypes.string}),getUserInput:function(){return null},simpleValidate:function(rubric){return Video.validate(null,rubric)},change:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return Changeable.change.apply(this,args)},render:function(){var url,location=this.props.location;if(!location)return React.createElement("div",null);if(IS_URL.test(location))url=location;else{url="https://{hostname}/embed_video?slug={slug}&internal_video_only=1".replace("{slug}",location);var currentHostname=document.location.hostname,embedHostname="www.khanacademy.org";IS_KA_SITE.test(currentHostname)&&(embedHostname=currentHostname),url=url.replace("{hostname}",embedHostname)}return React.createElement(FixedToResponsive,{width:1280,height:720,key:location+this.props.alignment},React.createElement("iframe",{className:"perseus-video-widget",sandbox:"allow-same-origin allow-scripts",width:1280,height:720,src:url,allowFullScreen:!0}))}});_.extend(Video,{validate:function(state,rubric){return{type:"points",earned:0,total:0,message:null}}}),module.exports={name:"video",displayName:"Video",defaultAlignment:"block",supportedAlignments:["block","float-left","float-right","full-width"],widget:Video}}}]);
//# sourceMappingURL=kolibri_exercise_perseus_plugin.main-extra-widgets-1.3.3.js.map